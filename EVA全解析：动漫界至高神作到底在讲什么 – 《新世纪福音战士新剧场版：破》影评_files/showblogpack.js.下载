var FavoriteManagerClient=Class.create();Object.extend(FavoriteManagerClient.prototype,{name:"FavoriteManagerClient",type:1,server:{isFavorited:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","ListHasFavorited2",[f,e],d,"/database/databaseService.m?Ajax_CallBack=true","post","20000")}},options:{userId:0,container:"container",movieTagName:"li"},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeServerData();this.initializeDOM();this.initializeEvent();this.initializeControl();this.load();this.render()},initializeField:function(){this.favorites=[]},initializeServerData:function(){},initializeDOM:function(){this.container=$(this.container)},destroyDOM:function(){this.container=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},initializeControl:function(){if(this.container){var p=this.container.getElementsByTagName(this.movieTagName);var o=null,m=0,k=null;var q=[],n=[];if(p&&p.length>0){for(var l=0,j=p.length;l<j;l++){o=$(p[l]);if(o.readAttribute("movieid")){m=o.readAttribute("movieid");k=o.down('a[action="favorite"]');n.push(m);q.push({region:o,id:m,favoriteButton:k})}}}this.movies=q;this.movieIds=n}},destroyControl:function(){if(this.container&&this.favorites&&this.favorites.length>0){for(var d=0,c=this.favorites.length;d<c;d++){this.favorites[d].close()}}},load:function(){if(this.movieIds&&this.movieIds.length>0){this.server.isFavorited(this.type,this.movieIds.join("|"),function(){var q=listHasFavoritedResult;if(q&&q.value){var p=q.value;for(var m=0,j=p.length;m<j;m++){var o=p[m];var n=o.First;var l=o.Second;var k=this.initializeFavoriteControl(n,l);if(k){this.favorites.push(k)}}}}.bind(this))}},render:function(){},initializeFavoriteControl:function(f,d){var e=this.getMovie(f);if(e&&e.favoriteButton){return new Favorite({id:f,type:this.type,isLogin:true,favoriteButton:e.favoriteButton,hasFavorite:d})}return null},getMovie:function(f){if(this.movies.length>0){for(var e=0,d=this.movies.length;e<d;e++){if(this.movies[e].id==f){return this.movies[e]}}}return null},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var Favorite=Class.create();Favorite.prototype={MAX_FAVORITEREASON_COUNT:140,MAX_FAVORITEREASON_DESCRIPTION:"收藏理由字数不应该大于{0}字",server:{getFavoriteCategorys:function(h,g,f,e){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetFavoriteCategorys2",[h,g,f],e,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},addToFavorate:function(q,o,j,m,l,n,p,k){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","AddToFavorate2",[q,o,j,m,l,n,p],k,"/database/databaseService.m?Ajax_CallBack=true","post","20000")},createCategory:function(c,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","CreateFavoriteCategory2",[c],d,"/database/databaseService.m?Ajax_CallBack=true","post","20000")}},options:{isLogin:false,signInUrl:"",id:0,type:1,favoriteButton:"",hasFavorite:false,getStatusWhenCategory:false,isModifyFavoriteButton:true,okCallback:null,cancelCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.render()},initializeField:function(){this.favoriteCategorys=null},initializeDOM:function(){this.favoriteButton=$(this.favoriteButton);this.favoriteUsersLinkRegion=$("favoriteUsersLinkRegion")},destroyDOM:function(){this.favoriteButton=null;this.favoriteUsersLinkRegion=null},initializeEvent:function(){this.onClickFavoriteButtonHandler=this.onClickFavoriteButton.bind(this);this.favoriteButton.observe("click",this.onClickFavoriteButtonHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.favoriteButton.stopObserving("click",this.onClickFavoriteButtonHandler)},initializeControl:function(){},destroyControl:function(){},render:function(){this.renderFavoriteButton();this.renderFavoriteUsersLink()},renderFavoriteButton:function(){if(this.isModifyFavoriteButton&&this.hasFavorite){this.favoriteButton.removeClassName("btn_fav");if(!this.favoriteButton.hasClassName("c_green")){this.favoriteButton.addClassName("btn_favd")}if(this.favoriteButton.hasClassName("ext_enable")){this.favoriteButton.innerHTML="已收藏"}}},renderFavoriteUsersLink:function(){if(this.favoriteUsersLinkRegion){if(this.favoritedCount>0){var b=this.favoriteUsersLinkRegion.down("a");if(b){b.innerHTML=this.favoritedCount;if(!$visible(this.favoriteUsersLinkRegion)){$show(this.favoriteUsersLinkRegion)}}}else{if($visible(this.favoriteUsersLinkRegion)){$hide(this.favoriteUsersLinkRegion)}}}},onClickFavoriteButton:function(){if(!this.isLogin){$redirect(this.signInUrl)}else{if(this.favoriteCategorys===null){this.server.getFavoriteCategorys(this.type,this.id,this.getStatusWhenCategory,function(){var b=getFavoriteCategorysResult;if(b&&b.value){this.favoriteCategorys=b.value.categorys.List;if(this.getStatusWhenCategory){this.hasFavorite=b.value.hasFavorited}this.showFavoriteMovieDialog()}}.bind(this))}else{this.showFavoriteMovieDialog()}}},showFavoriteMovieDialog:function(){this.dialog=new Dialog({windowClassName:"w345",content:Builder.node("div",[Builder.node("div",{id:"createFavoriteCategoryWindow",className:"eject_outer",style:"visibility:hidden; position: absolute; width: 200px; left:105px; top: 100px;"},[Builder.node("div",{className:"eject"},[Builder.node("span",{className:"directiontr"}),Builder.node("h4",{className:"normal"},["分类名称："]),Builder.node("input",{id:"favoriteCategoryText",type:"text",className:"bor_a5 mt3",style:"width:150px;"}),Builder.node("p",{className:"mt10 tc"},[Builder.node("input",{id:"confirmCreateFavoriteCategoryButton",type:"button",value:"确 认",className:"btn_blue2 mr15"}),Builder.node("input",{id:"cancelCreateFavoriteCategoryButton",type:"button",value:"取 消",className:"btn_gray2"})])])]),Builder.node("div",[Builder.node("p",{id:"favoriteHint",className:"tl mtb10 c_red",style:"display:none;"}),Builder.node("p",[Builder.node("label",{htmlFor:"favoriteCategoryList"},["请选择收藏分类"]),this.getCategorySelect("favoriteCategorySelect"),Builder.node("a",{id:"createFavoriteCategoryButton",href:"#",onclick:"return false;"},["添加新分类"])]),Builder.node("p",{className:"mt9 "+(this.type===1?"":"none")},["我有",Builder.node("label",{htmlFor:"hasDvdCheckbox",className:"ml10"},[Builder.node("input",{type:"checkbox",id:"hasDvdCheckbox"}),"DVD"]),Builder.node("label",{htmlFor:"hasCdCheckbox",className:"ml10"},[Builder.node("input",{type:"checkbox",id:"hasCdCheckbox"}),"CD"]),Builder.node("label",{htmlFor:"hasPosterCheckbox",className:"ml10"},[Builder.node("input",{type:"checkbox",id:"hasPosterCheckbox"}),"海报"])]),Builder.node("p",{className:"mt15"},["收藏理由：",Builder.node("textarea",{id:"favoriteReasonText",className:"block bor_a5",style:"height: 85px; width:280px;",cols:"40",rows:"6"})])])]),buttonRegionClass:"mtb10 tc",buttons:[{title:"好了，收藏",buttonStyle:"btn_square_hover mr15",callback:this.onConfirmFavorite.bind(this)},{title:"取 消",buttonStyle:"btn_square",onmouseover:"this.className='btn_square_hover';",onmouseout:"this.className='btn_square';",callback:function(b){if(this.cancelCallback){this.cancelCallback(b)}b.close()}.bind(this)}],readyCallback:this.onDialogReady.bind(this),closeCallback:this.onDialogClose.bind(this)});document.body.style.position="relative"},onDialogReady:function(c){this.hint=c.getEl("favoriteHint");this.categorySelect=c.getEl("favoriteCategorySelect");this.hasDvdCheckbox=c.getEl("hasDvdCheckbox");this.hasCdCheckbox=c.getEl("hasCdCheckbox");this.hasPosterCheckbox=c.getEl("hasPosterCheckbox");this.favoriteReasonText=c.getEl("favoriteReasonText");if(this.hasFavorite){var d="";switch(this.type){case 1:d="此电影已在你的收藏列表中";break;case 2:d="此影人已在你的收藏列表中";break;case 5:d="此照片已在你的收藏列表中";break;case 6:d="此日志已在你的收藏列表中";break;case 10:d="此话题已在你的收藏列表中";break;case 11:d="此电影图片已在你的收藏列表中";break;case 21:d="此影人图片已在你的收藏列表中";break;case 33:d="此影院已在你的收藏列表中";break;case 51:d="此新闻已在你的收藏列表中";break;case 59:d="此专题已在你的收藏列表中";break;case 82:d="此电影节/颁奖典礼已在你的收藏列表中";break;case 83:d="此电影节/颁奖典礼已在你的收藏列表中";break;case 84:d="此时光话题已在你的收藏列表中";break;case 90:d="此特色榜单已在你的收藏列表中";break}this.setHint(d)}this.createCategoryButton=c.getEl("createFavoriteCategoryButton");this.createCategoryWindow=c.getEl("createFavoriteCategoryWindow");this.categoryText=c.getEl("favoriteCategoryText");this.confirmCreateCategoryButton=c.getEl("confirmCreateFavoriteCategoryButton");this.cancelCreateCategoryButton=c.getEl("cancelCreateFavoriteCategoryButton");this.onClickCreateCategoryButtonHandler=this.onClickCreateCategoryButton.bind(this);this.createCategoryButton.observe("click",this.onClickCreateCategoryButtonHandler);this.onClickConfirmCreateCategoryButtonHandler=this.onClickConfirmCreateCategoryButton.bind(this);this.confirmCreateCategoryButton.observe("click",this.onClickConfirmCreateCategoryButtonHandler);this.onClickCancelCreateCategoryButtonHandler=this.onClickCancelCreateCategoryButton.bind(this);this.cancelCreateCategoryButton.observe("click",this.onClickCancelCreateCategoryButtonHandler)},onDialogClose:function(b){this.hint=null;this.categorySelect=null;this.hasDvdCheckbox=null;this.hasCdCheckbox=null;this.hasPosterCheckbox=null;this.favoriteReasonText=null;this.createCategoryButton.stopObserving("click",this.onClickCreateCategoryButtonHandler);this.confirmCreateCategoryButton.stopObserving("click",this.onClickConfirmCreateCategoryButtonHandler);this.cancelCreateCategoryButton.stopObserving("click",this.onClickCancelCreateCategoryButtonHandler);this.createCategoryButton=null;this.createCategoryWindow=null;this.categoryText=null;this.confirmCreateCategoryButton=null;this.cancelCreateCategoryButton=null},onConfirmFavorite:function(){var g=this.categorySelect.value;var l=this.hasDvdCheckbox.checked;var k=this.hasCdCheckbox.checked;var m=this.hasPosterCheckbox.checked;var h=this.favoriteReasonText.value;var j=h.bytelength();if(j>this.MAX_FAVORITEREASON_COUNT*2){this.setHint(String.Format(this.MAX_FAVORITEREASON_DESCRIPTION,this.MAX_FAVORITEREASON_COUNT))}else{this.server.addToFavorate(this.type,this.id,g,l,k,m,h,this.onConfirmFavoriteCallback.bind(this))}},onConfirmFavoriteCallback:function(){var b=addToFavorateResult;if(b&&b.value){this.doConfirmFavoriteCallback(b.value);this.dialog.close()}else{this.setHint("添加收藏失败，请稍候重试")}},doConfirmFavoriteCallback:function(b){if(this.okCallback){this.okCallback(true)}this.hasFavorite=true;this.favoritedCount=b.favoritedCount;this.render()},onClickCreateCategoryButton:function(){if(this.createCategoryWindow.style.visibility!=="visible"){this.createCategoryWindow.style.visibility="visible"}},onClickConfirmCreateCategoryButton:function(){var b=this.categoryText.value.trim();if(b.length>0){if(b.bytelength()>50){this.setHint("分类名不要超过25个汉字！");return false}this.server.createCategory(b,function(){var a=createFavoriteCategoryResult;if(a&&a.value){this.doConfirmCreateCategoryCallback(a.value);this.createCategoryWindow.style.visibility="hidden"}else{this.setHint("添加分类失败，请稍候重试")}}.bind(this))}},doConfirmCreateCategoryCallback:function(k){var g=k.id;var h=k.name;if(this.favoriteCategorys!==null){this.favoriteCategorys.push({Id:g,Name:h});var m=this.categorySelect.options,l=0;var j=document.createElement("option");j.text=h;j.value=g;m[m.length]=j;m[m.length-1].selected=true}},onClickCancelCreateCategoryButton:function(){this.createCategoryWindow.style.visibility="hidden";this.categoryText.value=""},getCategorySelect:function(m){var h=this.favoriteCategorys;var j=new StringBuilder(),g=null;j.append('<select id="'+m+'" class="mlr10 w126">');j.append(String.Format('<option value="{0}">{1}</option>',"0","不放入任何分类"));for(var l=0,k=h.length;l<k;l++){g=h[l];j.append(String.Format('<option value="{0}">{1}</option>',g.Id,g.Name))}j.append("</select");return Builder.build(j.toString())},setHint:function(b){this.hint.innerHTML=b;this.hint.show()},closed:false,close:function(){if(!this.closed){if(this.dialog){this.dialog.close()}this.favoriteCategorys=null;this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}};var FavoriteTabType={favorites:{name:"myFavorites",text:"我的收藏"},lists:{name:"myLists",text:"我的专辑"}};var MyListsTabContent=Class.create();Object.extend(MyListsTabContent.prototype,{REASON_DEFAULT_TXT:"写一条什么收藏理由呢？",REASON_MAX_LENGTH:200,REASON_MAX_DESCRIPTION:"收藏理由字数不应该大于{0}字",LIST_NAME_DEFAULT_TXT:"新专辑名称",LIST_NAME_MAX_LENGTH:25,LIST_NAME_MAX_DESCRIPTION:"专辑名不能超过{0}个字",closed:false,lists:[],content:null,favoriteDialog:null,listRegion:null,addToListRegion:null,txtReason:null,addToListOKButton:null,addToListCancelButton:null,createListButton:null,createListRegion:null,txtListName:null,createListOKButton:null,createListCancelButton:null,onClickListRegionHandler:null,onClickAddToListOKButtonHandler:null,onClickAddToListCancelButtonHandler:null,onClickCreateListButtonHandler:null,onClickCreateListOKButtonHandler:null,onClickCreateListCancelButtonHandler:null,onFocusTXTReasonHandler:null,onBlurTXTReasonHandler:null,onFocusTXTListNameHandler:null,onBlurTXTListNameHandler:null,server:{getSpecials:function(d,c){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetSpecials2",[d],c,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},addToSpecial:function(m,h,k,l,j,g){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","AddToSpecial2",[m,h,k,l,j],g,"/database/databaseService.m?Ajax_CallBack=true","post","20000")},createSpecial:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","CreateSpecial2",[f,e],d,"/database/databaseService.m?Ajax_CallBack=true","post","20000")},removeListCache:function(b){return Mtime.Component.Ajax.request(siteMcUrl,"Mtime.MemberCenter.Pages.RemoveCacheService","RemoveCache_M08_List_GetListItemPage",[],b,"/service/removecache.mc","get","20000")},removeAddItemContentCache:function(d,c){return Mtime.Component.Ajax.request(siteMcUrl,"Mtime.MemberCenter.Pages.RemoveCacheService","RemoveCache_AddSpecialContent10",[d],c,"/service/removecache.mc","get","20000")}},initialize:function(b){this.favoriteDialog=b;this.server.getSpecials(this.favoriteDialog.relatedObjType,function(){var a=getSpecialsResult;if(a&&a.value){this.lists=a.value.List;this.buildListRegion()}}.bind(this));this.initializeDOM();this.initializeEvent();this.load()},initializeDOM:function(){this.createListButton=Builder.node("a",{href:"#",className:"add_c"},["添加新专辑"]);this.listRegion=Builder.node("ul",{className:"favlist"});this.txtListName=Builder.node("input",{type:"text",className:"unfocus",value:this.LIST_NAME_DEFAULT_TXT});this.createListOKButton=Builder.node("input",{type:"button",className:"btn_blue",value:"确 认"});this.createListCancelButton=Builder.node("input",{type:"button",className:"btn_gray",onmouseout:"this.className='btn_gray';",onmouseover:"this.className='btn_blue';",value:"取 消"});this.createListRegion=Builder.node("div",{className:"fav_msg mt6",style:"display: none"},[this.txtListName,Builder.node("p",{className:"mt6 tr pr12"},[this.createListOKButton," 或 ",this.createListCancelButton])]);this.content=Builder.node("div",{className:"mt15"},[this.listRegion,Builder.node("p",{className:"mt9 clearfix"},[this.createListButton]),this.createListRegion]);this.txtReason=Builder.node("textarea",{className:"unfocus"},[this.REASON_DEFAULT_TXT]);this.addToListOKButton=Builder.node("input",{type:"button",className:"btn_blue",value:"确 认"});this.addToListCancelButton=Builder.node("input",{type:"button",className:"btn_gray",onmouseout:"this.className='btn_gray';",onmouseover:"this.className='btn_blue';",value:"取 消"});this.addToListRegion=Builder.node("div",{className:"fav_msg"},[this.txtReason,Builder.node("p",{className:"mt6 tr pr12"},[this.addToListOKButton," 或 ",this.addToListCancelButton])])},destroyDOM:function(){this.favoriteDialog=this.content=this.addToListRegion=this.txtReason=null;this.addToListOKButton=this.addToListCancelButton=null;this.createListButton=this.createListRegion=this.txtListName=null;this.createListOKButton=this.createListCancelButton=null},initializeEvent:function(){this.onClickListRegionHandler=this.onClickListRegion.bindAsEventListener(this);Event.observe(this.listRegion,"click",this.onClickListRegionHandler);this.onFocusTXTReasonHandler=this.onFocusTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"focus",this.onFocusTXTReasonHandler);this.onBlurTXTReasonHandler=this.onBlurTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"blur",this.onBlurTXTReasonHandler);this.onClickAddToListOKButtonHandler=this.onClickAddToListOKButton.bindAsEventListener(this);Event.observe(this.addToListOKButton,"click",this.onClickAddToListOKButtonHandler);this.onClickAddToListCancelButtonHandler=this.onClickAddToListCancelButton.bindAsEventListener(this);Event.observe(this.addToListCancelButton,"click",this.onClickAddToListCancelButtonHandler);this.onClickCreateListButtonHandler=this.onClickCreateListButton.bindAsEventListener(this);Event.observe(this.createListButton,"click",this.onClickCreateListButtonHandler);this.onFocusTXTListNameHandler=this.onFocusTXTListName.bindAsEventListener(this);Event.observe(this.txtListName,"focus",this.onFocusTXTListNameHandler);this.onBlurTXTListNameHandler=this.onBlurTXTListName.bindAsEventListener(this);Event.observe(this.txtListName,"blur",this.onBlurTXTListNameHandler);this.onClickCreateListOKButtonHandler=this.onClickCreateListOKButton.bindAsEventListener(this);Event.observe(this.createListOKButton,"click",this.onClickCreateListOKButtonHandler);this.onClickCreateListCancelButtonHandler=this.onClickCreateListCancelButton.bindAsEventListener(this);Event.observe(this.createListCancelButton,"click",this.onClickCreateListCancelButtonHandler)},destroyEvent:function(){Event.stopObserving(this.listRegion,"click",this.onClickListRegionHandler);Event.stopObserving(this.txtReason,"focus",this.onFocusTXTReasonHandler);Event.stopObserving(this.txtReason,"blur",this.onBlurTXTReasonHandler);Event.stopObserving(this.addToListOKButton,"click",this.onClickAddToListOKButtonHandler);Event.stopObserving(this.addToListCancelButton,"click",this.onClickAddToListCancelButtonHandler);Event.stopObserving(this.txtListName,"focus",this.onFocusTXTListNameHandler);Event.stopObserving(this.txtListName,"blur",this.onBlurTXTListNameHandler);Event.stopObserving(this.createListButton,"click",this.onClickCreateListButtonHandler);Event.stopObserving(this.createListOKButton,"click",this.onClickCreateListOKButtonHandler);Event.stopObserving(this.createListCancelButton,"click",this.onClickCreateListCancelButtonHandler)},buildListItem:function(f,g,e,h){return Builder.node("li",{listId:f},[Builder.node("span",{className:"song"},["·"]),Builder.node("a",{href:"#",method:"selectList"},[(h==0?(g+"(未发布)"):g)]),Builder.node("span",{className:"c_666"},[(e>0?("("+e+"项内容)"):"")])])},buildListRegion:function(){this.lists.each(function(b){this.listRegion.appendChild(this.buildListItem(b.Id,b.Name,b.Count,b.Status))}.bind(this))},onClickListRegion:function(g){var f=Event.findElement(g,"a");if(!f||!f.readAttribute){return}var j=f.readAttribute("method");if(!j){return}if(j=="selectList"){Event.stop(g);var h=$(f.parentNode);if(h.hasClassName("active")){return}var k=this.addToListRegion.parentNode;if(k){$(k).removeClassName("active")}h.addClassName("active");h.appendChild(this.addToListRegion)}},onFocusTXTReason:function(b){if(this.txtReason.value==this.REASON_DEFAULT_TXT){this.txtReason.value="";this.txtReason.removeClassName("unfocus");this.txtReason.addClassName("focus")}},onBlurTXTReason:function(b){if(!this.txtReason.value){this.txtReason.value=this.REASON_DEFAULT_TXT;this.txtReason.removeClassName("focus");this.txtReason.addClassName("unfocus")}},onFocusTXTListName:function(b){if(this.txtListName.value==this.LIST_NAME_DEFAULT_TXT){this.txtListName.value="";this.txtListName.removeClassName("unfocus");this.txtListName.addClassName("focus")}},onBlurTXTListName:function(b){if(!this.txtListName.value){this.txtListName.value=this.LIST_NAME_DEFAULT_TXT;this.txtListName.removeClassName("focus");this.txtListName.addClassName("unfocus")}},addToListCallback:function(){var b=addToSpecialResult;if(b&&b.value){this.favoriteDialog.dialog.close()}else{$alert("添加到专辑失败，可能已存于该专辑 或 请稍候重试")}},onClickAddToListOKButton:function(e){var h=this.txtReason.value.trim();if(h===this.REASONDEFAULTTXT){h=""}if(h.bytelength()>this.REASON_MAX_LENGTH*2){$alert(String.format(this.REASON_MAX_DESCRIPTION,this.REASON_MAX_LENGTH));return}var f=parseInt($(this.addToListRegion.parentNode).readAttribute("listId"),10);var g=this.lists.find(function(a){return a.Id==f}).Name;this.server.addToSpecial(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,f,g,h,this.addToListCallback.bind(this));this.server.removeAddItemContentCache(f,null)},onClickAddToListCancelButton:function(b){this.favoriteDialog.dialog.close()},onClickCreateListButton:function(b){Event.stop(b);if($visible(this.createListRegion)){return}this.createListRegion.show()},createListCallback:function(){var k=createSpecialResult;if(k&&k.value){this.server.removeListCache(null);var g=k.value;var j=this.txtListName.value.trim();this.lists.push({Id:g,Name:j,Count:0,Status:0});var h=this.buildListItem(g,j,0,0);h.appendChild(Builder.node("span",{className:"c_red px11"},[" New!"]));var f=this.listRegion.getElementsBySelector("li");if(f&&f.length>0){this.listRegion.insertBefore(h,f[0])}else{this.listRegion.appendChild(h)}this.createListRegion.hide()}else{$alert("添加分类失败，请稍候重试")}},onClickCreateListOKButton:function(c){var d=this.txtListName.value.trim();if(d===this.LIST_NAME_DEFAULT_TXT){reason=""}if(!d){return}if(d.bytelength()>this.LIST_NAME_MAX_LENGTH*2){$alert(String.format(this.LIST_NAME_MAX_DESCRIPTION,this.LIST_NAME_MAX_LENGTH));return}else{this.server.createSpecial(this.favoriteDialog.relatedObjType,d,this.createListCallback.bind(this))}},onClickCreateListCancelButton:function(b){this.createListRegion.hide()},load:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var MyFavoritesTabContent=Class.create();Object.extend(MyFavoritesTabContent.prototype,{REASON_DEFAULT_TXT:"写一条什么收藏理由呢？",REASON_MAX_LENGTH:200,REASON_MAX_DESCRIPTION:"收藏理由字数不应该大于{0}字",FAVORITE_CATEGORY_NAME_DEFAULT_TXT:"新分类名称",FAVORITE_CATEGORY_NAME_MAX_LENGTH:25,FAVORITE_CATEGORY_NAME_MAX_DESCRIPTION:"分类名不能超过{0}个字",closed:false,favoriteCategories:[],content:null,favoriteDialog:null,favoriteCategoryListRegion:null,addToFavoriteRegion:null,txtReason:null,addToFavoriteOKButton:null,addToFavoriteCancelButton:null,createFavoriteCategoryButton:null,createFavoriteCategoryRegion:null,txtCategoryName:null,createFavoriteCategoryOKButton:null,createFavoriteCategoryCancelButton:null,onClickFavoriteCategoryListRegionHandler:null,onClickAddToFavoriteOKButtonHandler:null,onClickAddToFavoriteCancelButtonHandler:null,onClickCreateFavoriteCategoryButtonHandler:null,onClickCreateFavoriteCategoryOKButtonHandler:null,onClickCreateFavoriteCategoryCancelButtonHandler:null,onFocusTXTReasonHandler:null,onBlurTXTReasonHandler:null,onFocusTXTCategoryNameHandler:null,onBlurTXTCategoryNameHandler:null,server:{getFavoriteCategorys:function(h,g,f,e){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetFavoriteCategorys2",[h,g,f],e,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},addToFavorate:function(k,h,f,j,g){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","AddToFavorate102",[k,h,f,j],g,"/database/databaseService.m?Ajax_CallBack=true","post","20000")},createCategory:function(c,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","CreateFavoriteCategory2",[c],d,"/database/databaseService.m?Ajax_CallBack=true","post","20000")}},initialize:function(b){this.favoriteDialog=b;this.server.getFavoriteCategorys(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,true,function(){var a=getFavoriteCategorysResult;if(a&&a.value){this.favoriteCategories=a.value.categorys.List;this.favoriteCountWithoutCategory=a.value.favoriteCountWithoutCategory;this.hasFavorite=a.value.hasFavorited;this.buildFavoriteCategoryListRegion()}}.bind(this));this.initializeDOM();this.initializeEvent();this.load()},initializeDOM:function(){this.createFavoriteCategoryButton=Builder.node("a",{href:"#",className:"add_c"},["添加新分类"]);this.favoriteCategoryListRegion=Builder.node("ul",{className:"favlist"});this.txtCategoryName=Builder.node("input",{type:"text",className:"unfocus",value:this.FAVORITE_CATEGORY_NAME_DEFAULT_TXT});this.createFavoriteCategoryOKButton=Builder.node("input",{type:"button",className:"btn_blue",value:"确 认"});this.createFavoriteCategoryCancelButton=Builder.node("input",{type:"button",className:"btn_gray",onmouseout:"this.className='btn_gray';",onmouseover:"this.className='btn_blue';",value:"取 消"});this.createFavoriteCategoryRegion=Builder.node("div",{className:"fav_msg mt6",style:"display: none"},[this.txtCategoryName,Builder.node("p",{className:"mt6 tr pr12"},[this.createFavoriteCategoryOKButton," 或 ",this.createFavoriteCategoryCancelButton]),]);this.content=Builder.node("div",{className:"mt15"},[this.favoriteCategoryListRegion,Builder.node("p",{className:"mt9 clearfix"},[this.createFavoriteCategoryButton]),this.createFavoriteCategoryRegion]);this.txtReason=Builder.node("textarea",{className:"unfocus"},[this.REASON_DEFAULT_TXT]);this.addToFavoriteOKButton=Builder.node("input",{type:"button",className:"btn_blue",value:"确 认"});this.addToFavoriteCancelButton=Builder.node("input",{type:"button",className:"btn_gray",onmouseout:"this.className='btn_gray';",onmouseover:"this.className='btn_blue';",value:"取 消"});this.addToFavoriteRegion=Builder.node("div",{className:"fav_msg"},[this.txtReason,Builder.node("p",{className:"mt6 tr pr12"},[this.addToFavoriteOKButton," 或 ",this.addToFavoriteCancelButton])])},destroyDOM:function(){this.favoriteDialog=this.content=this.addToFavoriteRegion=this.txtReason=null;this.addToFavoriteOKButton=this.addToFavoriteCancelButton=null;this.createFavoriteCategoryButton=this.createFavoriteCategoryRegion=this.txtCategoryName=null;this.createFavoriteCategoryOKButton=this.createFavoriteCategoryCancelButton=null},initializeEvent:function(){this.onClickFavoriteCategoryListRegionHandler=this.onClickFavoriteCategoryListRegion.bindAsEventListener(this);Event.observe(this.favoriteCategoryListRegion,"click",this.onClickFavoriteCategoryListRegionHandler);this.onFocusTXTReasonHandler=this.onFocusTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"focus",this.onFocusTXTReasonHandler);this.onBlurTXTReasonHandler=this.onBlurTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"blur",this.onBlurTXTReasonHandler);this.onClickAddToFavoriteOKButtonHandler=this.onClickAddToFavoriteOKButton.bindAsEventListener(this);Event.observe(this.addToFavoriteOKButton,"click",this.onClickAddToFavoriteOKButtonHandler);this.onClickAddToFavoriteCancelButtonHandler=this.onClickAddToFavoriteCancelButton.bindAsEventListener(this);Event.observe(this.addToFavoriteCancelButton,"click",this.onClickAddToFavoriteCancelButtonHandler);this.onClickCreateFavoriteCategoryButtonHandler=this.onClickCreateFavoriteCategoryButton.bindAsEventListener(this);Event.observe(this.createFavoriteCategoryButton,"click",this.onClickCreateFavoriteCategoryButtonHandler);this.onFocusTXTCategoryNameHandler=this.onFocusTXTCategoryName.bindAsEventListener(this);Event.observe(this.txtCategoryName,"focus",this.onFocusTXTCategoryNameHandler);this.onBlurTXTCategoryNameHandler=this.onBlurTXTCategoryName.bindAsEventListener(this);Event.observe(this.txtCategoryName,"blur",this.onBlurTXTCategoryNameHandler);this.onClickCreateFavoriteCategoryOKButtonHandler=this.onClickCreateFavoriteCategoryOKButton.bindAsEventListener(this);Event.observe(this.createFavoriteCategoryOKButton,"click",this.onClickCreateFavoriteCategoryOKButtonHandler);this.onClickCreateFavoriteCategoryCancelButtonHandler=this.onClickCreateFavoriteCategoryCancelButton.bindAsEventListener(this);Event.observe(this.createFavoriteCategoryCancelButton,"click",this.onClickCreateFavoriteCategoryCancelButtonHandler)},destroyEvent:function(){Event.stopObserving(this.favoriteCategoryListRegion,"click",this.onClickFavoriteCategoryListRegionHandler);Event.stopObserving(this.txtReason,"focus",this.onFocusTXTReasonHandler);Event.stopObserving(this.txtReason,"blur",this.onBlurTXTReasonHandler);Event.stopObserving(this.addToFavoriteOKButton,"click",this.onClickAddToFavoriteOKButtonHandler);Event.stopObserving(this.addToFavoriteCancelButton,"click",this.onClickAddToFavoriteCancelButtonHandler);Event.stopObserving(this.txtCategoryName,"focus",this.onFocusTXTCategoryNameHandler);Event.stopObserving(this.txtCategoryName,"blur",this.onBlurTXTCategoryNameHandler);Event.stopObserving(this.createFavoriteCategoryButton,"click",this.onClickCreateFavoriteCategoryButtonHandler);Event.stopObserving(this.createFavoriteCategoryOKButton,"click",this.onClickCreateFavoriteCategoryOKButtonHandler);Event.stopObserving(this.createFavoriteCategoryCancelButton,"click",this.onClickCreateFavoriteCategoryCancelButtonHandler)},buildCategoryItem:function(e,f,d){return Builder.node("li",{categoryId:e},[Builder.node("span",{className:"song"},["·"]),Builder.node("a",{href:"#",method:"selectCategory"},[f]),Builder.node("span",{className:"c_666"},[(d>0?("("+d+"项内容)"):"")])])},buildFavoriteCategoryListRegion:function(){this.favoriteCategoryListRegion.appendChild(this.buildCategoryItem(0,"未分类",this.favoriteCountWithoutCategory));this.favoriteCategories.each(function(b){this.favoriteCategoryListRegion.appendChild(this.buildCategoryItem(b.Id,b.Name,b.Count))}.bind(this))},onClickFavoriteCategoryListRegion:function(g){var f=Event.findElement(g,"a");if(!f||!f.readAttribute){return}var j=f.readAttribute("method");if(!j){return}if(j=="selectCategory"){Event.stop(g);var h=$(f.parentNode);if(h.hasClassName("active")){return}var k=this.addToFavoriteRegion.parentNode;if(k){$(k).removeClassName("active")}h.addClassName("active");h.appendChild(this.addToFavoriteRegion)}},onFocusTXTReason:function(b){if(this.txtReason.value==this.REASON_DEFAULT_TXT){this.txtReason.value="";this.txtReason.removeClassName("unfocus");this.txtReason.addClassName("focus")}},onBlurTXTReason:function(b){if(!this.txtReason.value){this.txtReason.value=this.REASON_DEFAULT_TXT;this.txtReason.removeClassName("focus");this.txtReason.addClassName("unfocus")}},onFocusTXTCategoryName:function(b){if(this.txtCategoryName.value==this.FAVORITE_CATEGORY_NAME_DEFAULT_TXT){this.txtCategoryName.value="";this.txtCategoryName.removeClassName("unfocus");this.txtCategoryName.addClassName("focus")}},onBlurTXTCategoryName:function(b){if(!this.txtCategoryName.value){this.txtCategoryName.value=this.FAVORITE_CATEGORY_NAME_DEFAULT_TXT;this.txtCategoryName.removeClassName("focus");this.txtCategoryName.addClassName("unfocus")}},addToFavoriteCallback:function(){var b=addToFavorateResult;if(b&&b.value){if(this.favoriteDialog.onFavoriteOKCallback){this.favoriteDialog.onFavoriteOKCallback(b.value)}this.favoriteDialog.dialog.close()}else{$alert("添加收藏失败，请稍候重试")}},onClickAddToFavoriteOKButton:function(e){var f=this.txtReason.value.trim();if(f===this.REASON_DEFAULT_TXT){f=""}if(f.bytelength()>this.REASON_MAX_LENGTH*2){$alert(String.format(this.REASON_MAX_DESCRIPTION,this.REASON_MAX_LENGTH));return}var d=$(this.addToFavoriteRegion.parentNode).readAttribute("categoryId");this.server.addToFavorate(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,d,f,this.addToFavoriteCallback.bind(this))},onClickAddToFavoriteCancelButton:function(b){this.favoriteDialog.dialog.close()},onClickCreateFavoriteCategoryButton:function(b){Event.stop(b);if($visible(this.createFavoriteCategoryRegion)){return}this.createFavoriteCategoryRegion.show()},createFavoriteCategoryCallback:function(){var f=createFavoriteCategoryResult;if(f&&f.value){this.favoriteCategories.push(f.value);var d=this.buildCategoryItem(f.value.id,f.value.name,0);d.appendChild(Builder.node("span",{className:"c_red px11"},[" New!"]));var e=this.favoriteCategoryListRegion.getElementsBySelector("li");if(e.length>1){this.favoriteCategoryListRegion.insertBefore(d,e[1])}else{this.favoriteCategoryListRegion.appendChild(d)}this.createFavoriteCategoryRegion.hide()}else{$alert("添加分类失败，请稍候重试")}},onClickCreateFavoriteCategoryOKButton:function(d){var c=this.txtCategoryName.value.trim();if(c===this.FAVORITE_CATEGORY_NAME_DEFAULT_TXT){reason=""}if(!c){return}if(c.bytelength()>this.FAVORITE_CATEGORY_NAME_MAX_LENGTH*2){$alert(String.format(this.FAVORITE_CATEGORY_NAME_MAX_DESCRIPTION,this.FAVORITE_CATEGORY_NAME_MAX_LENGTH));return}else{this.server.createCategory(c,this.createFavoriteCategoryCallback.bind(this))}},onClickCreateFavoriteCategoryCancelButton:function(b){this.createFavoriteCategoryRegion.hide()},load:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var FavoriteControlDialog=Class.create();Object.extend(FavoriteControlDialog.prototype,{name:"FavoriteControlDialog",closed:false,dialog:null,tabHeaderRegion:null,tabContentRegion:null,tabContentControl:null,onClickTabHeaderRegionHandler:null,options:{currentTab:null,avaliableTabs:[FavoriteTabType.favorites,FavoriteTabType.lists],relatedObjId:0,relatedObjType:0,onFavoriteOKCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.tabHeaderRegion=Builder.node("ul",{className:"clearfix tab"});this.avaliableTabs.each(function(b){this.tabHeaderRegion.appendChild(Builder.node("li",[Builder.node("a",{href:"#",method:"switchTab",tabName:b.name},[b.text])]))}.bind(this));this.tabContentRegion=Builder.node("div");this.dialog=new Dialog({title:"请选择分类：",windowClassName:"w380",containerClassName:"p15",containerStyle:"margin-top: 0",content:Builder.node("div",[this.tabHeaderRegion,this.tabContentRegion]),closeCallback:this.close.bind(this)})},destroyDOM:function(){this.dialog=this.tabHeaderRegion=this.tabContentRegion=null},initializeControl:function(){},destroyControl:function(){if(this.tabContentControl){this.tabContentControl.close();this.tabContentControl=null}},initializeEvent:function(){this.onClickTabHeaderRegionHandler=this.onClickTabHeaderRegion.bindAsEventListener(this);Event.observe(this.tabHeaderRegion,"click",this.onClickTabHeaderRegionHandler)},destroyEvent:function(){Event.stopObserving(this.tabHeaderRegion,"click",this.onClickTabHeaderRegionHandler)},load:function(){this.switchTab()},switchTab:function(b){if(b){if(b.name==this.currentTab.name){return}this.currentTab=b}this.tabHeaderRegion.getElementsBySelector("a[method='switchTab']").each(function(a){var d=a.readAttribute("tabName");if(d==this.currentTab.name){$(a.parentNode).addClassName("on")}else{$(a.parentNode).removeClassName("on")}}.bind(this));if(this.tabContentControl){this.tabContentControl.close();this.tabContentControl=null}switch(this.currentTab){case FavoriteTabType.lists:this.tabContentControl=new MyListsTabContent(this);break;case FavoriteTabType.favorites:default:this.tabContentControl=new MyFavoritesTabContent(this);break}this.tabContentRegion.innerHTML="";this.tabContentRegion.appendChild(this.tabContentControl.content);this.dialog.setupDimensions()},onClickTabHeaderRegion:function(g){var f=Event.findElement(g,"a");if(!f||!f.readAttribute){return}var h=f.readAttribute("method");if(!h){return}if(h=="switchTab"){var k=f.readAttribute("tabName");var j=this.avaliableTabs.find(function(a){return a.name==k});this.switchTab(j);Event.stop(g)}},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var FavoriteButtonControl=Class.create();Object.extend(FavoriteButtonControl.prototype,{name:"FavoriteButtonControl",closed:false,relatedObjType:0,relatedObjId:0,hasFavorited:false,avaliableTabs:[FavoriteTabType.favorites,FavoriteTabType.lists],observer:null,favoriteButton:null,favoriteButtonText:null,options:{isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,hasFavorited:false,favoriteButton:"",avaliableTabs:[FavoriteTabType.favorites,FavoriteTabType.lists],onFavoriteOKCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);if(this.relatedObjType!=1&&this.relatedObjType!=2){this.avaliableTabs=[FavoriteTabType.favorites]}this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load();this.render();Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){},initializeDOM:function(){this.favoriteButton=$(this.favoriteButton);var b=[];b.push('<div class="ele_select"><a class="ele_select_a" method="favoriteButton" href="#"><span>收 藏</span></a>');b.push('<ul class="w80">');this.avaliableTabs.each(function(a){b.push('<li><a method="favoriteTab" tabName="'+a.name+'" href="#">'+a.text.escapeHTML()+"</a></li>")});b.push("</ul></div>");this.favoriteButton.innerHTML=b.join("");this.favoriteButtonText=this.favoriteButton.getElementsBySelector("a[method='favoriteButton']")[0]},destroyDOM:function(){this.favoriteButton=null;this.favoriteButtonText=null},initializeEvent:function(){this.onClickFavoriteButtonHandler=this.onClickFavoriteButton.bindAsEventListener(this);this.favoriteButton.observe("click",this.onClickFavoriteButtonHandler)},destroyEvent:function(){this.favoriteButton.stopObserving("click",this.onClickFavoriteButtonHandler)},initializeControl:function(){this.observer=new Observer({sourceElement:this.favoriteButton,onOverSourceCallback:this.showMenu.bind(this),onOutSourceCallback:this.hideMenu.bind(this),onOverTargetCallback:this.showMenu.bind(this),onOutTargetCallback:this.hideMenu.bind(this)})},destroyControl:function(){this.observer.close()},load:function(){},render:function(){if(this.hasFavorited){this.favoriteButton.addClassName("ele_select_fed");this.favoriteButtonText.innerHTML="<span>已收藏</span>"}else{this.favoriteButton.removeClassName("ele_select_fed");this.favoriteButtonText.innerHTML="<span>收 藏</span>"}},showMenu:function(){this.favoriteButton.addClassName("ele_select_g")},hideMenu:function(){this.favoriteButton.removeClassName("ele_select_g")},onClickFavoriteButton:function(f){var e=Event.findElement(f,"a");if(!e||!e.readAttribute){return}var g=e.readAttribute("method");if(!g){return}var h;if(g=="favoriteTab"){h=e.readAttribute("tabName")}if(!this.isLogin){$redirect(this.signInUrl)}else{this.showFavoriteDialog(h)}Event.stop(f)},onFavoriteControlDialogOKCallback:function(b){this.hasFavorited=b.success;this.favoritedCount=b.favoritedCount;this.render();if(this.onFavoriteOKCallback){this.onFavoriteOKCallback(b)}},showFavoriteDialog:function(d){var c=this.avaliableTabs.find(function(a){return a.name==d});if(!c){c=this.avaliableTabs[0]}new FavoriteControlDialog({currentTab:c,avaliableTabs:this.avaliableTabs,relatedObjId:this.relatedObjId,relatedObjType:this.relatedObjType,favorited:this.hasFavorited,onFavoriteOKCallback:this.onFavoriteControlDialogOKCallback.bind(this)})},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var TheaterFavorite10=Class.create();TheaterFavorite10.prototype={server:{addCinemaToFavorate:function(h,f,g,e){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.TheaterService","AddCinemaToFavorate11",[h,f,g],e,"/showtime08/theaterService.m?Ajax_CallBack=true","post","20000")},delFavorite:function(e,f,d){return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","DelFavorite",[e,f],d,"/service/showtime.ms","get","20000")},getFavoriteId:function(f,e,d){return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetFavoriteId",[f,e],d,"/service/showtime.ms","get","20000")}},options:{isLogin:false,signInUrl:"",id:0,type:33,favoriteButton:"",favRegion:"",favSpan:"",hasFavorite:false,favoriteId:0},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.render()},initializeField:function(){},initializeDOM:function(){this.favoriteButton=$(this.favoriteButton);this.favRegion=$(this.favRegion);this.favSpan=$(this.favSpan)},destroyDOM:function(){this.favoriteButton=null;this.favRegion=null;this.favSpan=null},initializeEvent:function(){this.onClickFavoriteButtonHandler=this.onClickFavoriteButton.bind(this);this.favoriteButton.observe("click",this.onClickFavoriteButtonHandler);this.onMouseoverFavRegionHandler=this.onMouseoverFavRegion.bindAsEventListener(this);this.favRegion.observe("mouseover",this.onMouseoverFavRegionHandler);this.onMouseoutFavRegionHandler=this.onMouseoutFavRegion.bindAsEventListener(this);this.favRegion.observe("mouseout",this.onMouseoutFavRegionHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.favoriteButton.stopObserving("click",this.onClickFavoriteButtonHandler);this.favRegion.stopObserving("mouseover",this.onMouseoverFavRegionHandler);this.favRegion.stopObserving("mouseout",this.onMouseoutFavRegionHandler)},initializeControl:function(){},destroyControl:function(){},render:function(){this.renderFavoriteButton()},renderFavoriteButton:function(){if(this.hasFavorite){this.favoriteButton.className="favon";this.favSpan.innerHTML="已收藏"}else{this.favoriteButton.className="";this.favSpan.innerHTML="收 藏"}},onClickFavoriteButton:function(){if(!this.isLogin){$redirect(this.signInUrl)}else{if(this.hasFavorite){if(this.id>0){this.server.delFavorite(this.id,33,function(){var c=delFavoritedIdResult;if(c&&c.value){var d=c.value.success;if(d){this.hasFavorite=0;this.renderFavoriteButton()}else{}}}.bind(this))}else{}}else{this.onConfirmFavorite()}}},showFavoriteTheaterDialog:function(){this.dialog=new Dialog({windowClassName:"w330",content:Builder.node("div",[Builder.node("div",[Builder.node("p",{id:"favoriteHint",className:"tl ml20 mtb10 c_red",style:"display:none;"}),Builder.node("h3",{className:"ml20"},["添加到我的电影院"]),Builder.node("p",{className:"ml20 mt6"},[Builder.node("label",{htmlfor:"favoriteReasonText"},["收藏理由："]),Builder.node("textarea",{id:"favoriteReasonText",className:"block bor_a5",cols:"40",rows:"6",style:"height:85px;width:280px;"})])]),Builder.node("div",{className:"line_dot mtb10"},[])]),buttonRegionClass:"mtb10 tc",buttons:[{title:"好了，收藏",buttonStyle:"btn_square_hover mr15",callback:this.onConfirmFavorite.bind(this)},{title:"取 消",buttonStyle:"btn_square",onmouseover:"this.className='btn_square_hover';",onmouseout:"this.className='btn_square';",callback:function(b){if(this.cancelCallback){this.cancelCallback(b)}b.close()}.bind(this)}],readyCallback:this.onDialogReady.bind(this),closeCallback:this.onDialogClose.bind(this)})},onDialogReady:function(c){this.hint=c.getEl("favoriteHint");this.favoriteReasonText=c.getEl("favoriteReasonText");if(this.hasFavorite){var d="此影院已在你的收藏列表中";this.setHint(d)}},onDialogClose:function(b){this.hint=null;this.favoriteReasonText=null},onConfirmFavorite:function(){var b="";this.server.addCinemaToFavorate(this.type,this.id,b,this.onConfirmFavoriteCallback.bind(this))},onConfirmFavoriteCallback:function(){var c=returObjAddCinemaToFavorate;if(c&&c.value){var d=c.value.success;this.hasFavorite=d;this.renderFavoriteButton()}else{}},onMouseoverFavRegion:function(){if(this.hasFavorite){if(this.favoriteButton&&Mtime.browser.ie&&Mtime.browser.ie<7){this.favoriteButton.addClassName("hover")}this.favSpan.innerHTML="取消收藏"}else{}},onMouseoutFavRegion:function(){if(this.hasFavorite){if(this.favoriteButton&&Mtime.browser.ie&&Mtime.browser.ie<7){this.favoriteButton.addClassName("hover")}this.favSpan.innerHTML="已收藏"}else{}},showfavSuccessDialog:function(b){this.dialog=new Dialog({windowClassName:"w330",content:Builder.node("div",{className:"mt15 plrb12"},[Builder.node("p",{className:"bold tc pt15"},["收藏成功！"]),Builder.node("p",{className:"tc mt9 pb15"},["已收藏到",Builder.node("a",{href:b,id:"favCinemaLink",target:"_blank"},["我的电影院"])])]),readyCallback:this.onFavSuccessDialogReady.bind(this),closeCallback:this.onFavSuccessDialogClose.bind(this)})},onFavSuccessDialogReady:function(b){this.favCinemaLink=b.getEl("favCinemaLink");this.onClickFavCinemaLinkHandler=function(){b.close()}.bind(this);this.favCinemaLink.observe("click",this.onClickFavCinemaLinkHandler)},onFavSuccessDialogClose:function(b){this.favCinemaLink.stopObserving("click",this.onClickFavCinemaLinkHandler);this.favCinemaLink=null},setHint:function(b){this.hint.innerHTML=b;this.hint.show()},closed:false,close:function(){if(!this.closed){if(this.dialog){this.dialog.close()}this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}};var MtimeShareRelatedObjectTypes={Movie:1,Person:2,UserPhoto:5,Blog:6,Group:9,ForumTopic:10,MoviePicture:11,PersonPicture:21,Activity:22,Cinema:33,Video:41,List:50,CMSNews:51,CMSGalleryImage:52,Twitter:54,CMSSpecialTopic:59,GameVote:63,Link:64,GameQuiz:67,Festival:82,FestivalEvent:83,CommunityFeature:84,TopList:90,DETSeatOrder:85};var ShareTabType={shareToMtimeFriend:{name:"shareToMtimeFriend",text:"时光好友"},shareToEMail:{name:"shareToEMail",text:"邮件地址"},shareToWeb:{name:"shareToWeb",text:"其他网站"},shareToURL:{name:"shareToURL",text:"复制链接"}};var ShareControlDialogBase=Class.create();Object.extend(ShareControlDialogBase.prototype,{name:"ShareControlDialogBase",title:"你将要转发给：",closed:false,dialog:null,tabContentRegion:null,options:{shareControl:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.tabContentRegion=Builder.node("div")},destroyDOM:function(){this.shareControl=this.dialog=this.tabHeaderRegion=this.tabContentRegion=null},initializeControl:function(){this.dialog=new Dialog({title:this.title,windowClassName:"w510",content:Builder.node("div",[this.tabContentRegion]),closeCallback:this.close.bind(this)})},destroyControl:function(){},initializeEvent:function(){},destroyEvent:function(){},load:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareToMtimeFriendDialog=Class.create();Object.extend(ShareToMtimeFriendDialog.prototype,ShareControlDialogBase.prototype);Object.extend(ShareToMtimeFriendDialog.prototype,{REASONDEFAULTTXT:"写一条什么转发理由呢？",REASONMAXLENGTH:210,title:"转发到时光微评：",dialogTemplate:new Template('<div><div>#{sharecontent}</div><div class="share_word mt12 clearfix"><a target="_blank" href="#{userlink}"><img width="32" alt="#{nickname}" class="img_box v_m" src="#{avatar}"></a><div class="fl w420 ml9 p_r"><img src="http://static1.mtime.cn/static/images08/submiting.gif" alt="loading" _type="loading" width="16" height="16" style="display:none;left:50%; top:25px; margin-left:-8px; position:absolute;"><div class="share_textarea"><textarea _type="txtreason">#{defaulttext}</textarea></div><div class="share_imgbox"><p class="share_num" _type="digit_feedback"></p><p _type="addition_region"></p></div></div></div><p style="display:none" _type="feedback" class="mt6 red">转发理由最多210个汉字</p></div>'),closed:false,selectFirstImage:false,content:null,shareDialog:null,txtReason:null,shareTip:null,okButton:null,cancelButton:null,onClickOKButtonHandler:null,onClickCancelButtonHandler:null,onFocusTXTReasonHandler:null,onBlurTXTReasonHandler:null,getShareInfoAdditionalInfo:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetShareInfoAdditionalInfo",[f,e],d,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},getShortenUrl:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","ShortenUrl",[d],c,"/Service/Twitter.msi","get","20000")},loadEditorJs:function(b){if(typeof(Weibo)!="undefined"&&Weibo.Face&&Weibo.Image&&Weibo.Sync&&Weibo.Syntax&&Weibo.Topic&&Weibo.Video){b&&b()}else{if(self.debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js"],function(){b&&b()})}else{$loadJs("/js/2011/weiboEditor.js",function(){b&&b()})}}},initializeDOM:function(){ShareControlDialogBase.prototype.initializeDOM.apply(this);var b=this.shareControl.shareInfo;this.content=Builder.build(this.dialogTemplate.evaluate({sharecontent:this.shareControl.getShareContentDOM().innerHTML,userlink:b.currentUserLink,avatar:b.currentUserAvatarUrl,nickname:b.currentUserNickName,defaulttext:this.REASONDEFAULTTXT}));this.okButton=$(Builder.node("input",{type:"button",className:"btn_square_hover mr15",value:"确 认"}));this.cancelButton=$(Builder.node("input",{type:"button",className:"btn_square",onmouseout:"this.className='btn_square';",onmouseover:"this.className='btn_square_hover';",value:"取 消"}));this.tabContentRegion.appendChild(this.content)},initializeControl:function(){ShareControlDialogBase.prototype.initializeControl.apply(this);if(this.dialog.buttonRegion){this.dialog.buttonRegion.appendChild(this.okButton);this.dialog.buttonRegion.appendChild(this.cancelButton)}this.txtReason=this.content.down('[_type="txtreason"]');this.editorTextbox=new Textbox({text:this.txtReason,watermarkText:this.REASONDEFAULTTXT});var f=this;this.loadEditorJs(function(){f.editor=new Weibo.Editor({editor:f.txtReason});new Weibo.Feedback({editor:f.editor,digitFeedback:{target:f.content.down('[_type="digit_feedback"]'),normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}})});var e=this.shareControl.shareInfo;var d=this.content.down('[_type="loading"]');if(e.needAdditionalInfo){d.show();this.getShareInfoAdditionalInfo(this.shareControl.relatedObjType,this.shareControl.getShareObjectId(),function(x){if(x&&x.value&&(x.value.picUrls||x.value.videoUrls||x.value.extPicUrls)){var u="",r="",A="";var t=['<ul class="clearfix share_imgtab" _type="nav">'];var a=x.value;if((a.picUrls&&a.picUrls.length>0)||(x.value.extPicUrls&&x.value.extPicUrls.length>0)){if(a.extPicUrls&&a.extPicUrls.length>0){if(a.picUrls){a.picUrls=a.extPicUrls.concat(a.picUrls)}else{a.picUrls=x.value.extPicUrls}}t.push('<li _type="image" class="on"><span class="select_image"></span>选择一张图片</li>');var c=['<div class="share_imglistout" _type="images">'];if(a.picUrls.length>4){c.push('<a href="#" onclick="return false;" _type="turnleft" class="turnleft">&nbsp;</a><a href="#" class="turnright" _type="turnright" onclick="return false;">&nbsp;</a>')}c.push('<div _type="slidesregion" class="share_imglistin">');a.picUrls.each(function(h,g){if(g%4==0){if(g/4!=0){c.push("</ul>");c.push('<ul class="share_imglist clearfix" style="display:none;">')}else{c.push('<ul class="share_imglist clearfix">')}}c.push('<li _imageurl="'+h+'" name="tab"><span class="ico_tright">&nbsp;</span><img src="'+h+'" width="75"></li>')});c.push("</ul></div></div>");r=c.join("")}if(a.videoUrls&&a.videoUrls.length>0){var z=[];if(t.length==1){t.push('<li _type="video" class="on"><span class="select_video"></span>选择一个视频</li>');z=['<div class="share_imglistout" _type="videos">']}else{t.push('<li _type="video"><span class="select_video"></span>选择一个视频</li>');z=['<div class="share_imglistout" style="display:none" _type="videos">']}if(a.videoUrls.length>4){z.push('<a href="#" onclick="return false;" _type="turnleft" class="turnleft">&nbsp;</a><a href="#" class="turnright" _type="turnright" onclick="return false;">&nbsp;</a>')}z.push('<div _type="slidesregion" class="share_imglistin">');a.videoCoverUrls.each(function(h,g){if(g%4==0){if(g/4!=0){z.push("</ul>");z.push('<ul class="share_imglist clearfix" style="display:none;">')}else{z.push('<ul class="share_imglist clearfix">')}}z.push('<li _videourl="'+a.videoUrls[g].url+'" title="'+a.videoUrls[g].title+'" name="tab"><span class="ico_tright">&nbsp;</span><strong>&nbsp;</strong><img src="'+h+'" width="75"></li>')});z.push("</ul></div></div>");A=z.join("")}t.push("</ul>");u=t.join("");var b=f.content.down('[_type="addition_region"]');u&&b.appendChild(Builder.build(u));r&&b.appendChild(Builder.build(r));A&&b.appendChild(Builder.build(A));f.navRegion=f.content.down('[_type="nav"]');if(f.navRegion.childElements().length<2){f.navRegion=null}f.imagesRegion=f.content.down('[_type="images"]');f.videosRegion=f.content.down('[_type="videos"]');if(f.selectFirstImage&&f.imagesRegion){var s=f.imagesRegion.down("li[_imageurl]");imgUrl=s.readAttribute("_imageurl");f.shareImageUrl=imgUrl;s.addClassName("on")}if(f.navRegion){f.navControlHandler=f.navControl.bind(f);Event.observe(f.navRegion,"click",f.navControlHandler)}if(f.imagesRegion||f.videosRegion){f.selectImageOrVideoHandler=f.selectImageOrVideo.bind(f);f.imagesRegion&&Event.observe(f.imagesRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&Event.observe(f.videosRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&(f.videoCheckTimeout=setTimeout(f.videoCheck.bind(f),500));if(a.picUrls&&a.picUrls.length>4){var w=f.imagesRegion.down('[_type="turnleft"]');var v=f.imagesRegion.down('[_type="turnright"]');var y=f.imagesRegion.down('[_type="slidesregion"]');f.buildSlidesControl(y,v,w)}if(a.videoUrls&&a.videoUrls.length>4){var w=f.videosRegion.down('[_type="turnleft"]');var v=f.videosRegion.down('[_type="turnright"]');var y=f.videosRegion.down('[_type="slidesregion"]');f.buildSlidesControl(y,v,w)}}}d.hide()})}this.shareTip=this.content.down('[_type="feedback"]')},buildSlidesControl:function(m,k,l){var g=m.childElements();if(g.length>1){var h=0;var j=g.length;Event.observe(k,"click",function(){$(g[h]).hide();if(h!=j-1){++h}else{h=0}$(g[h]).show()});Event.observe(l,"click",function(){$(g[h]).hide();if(h!=0){h=0}else{h=j-1}$(g[h]).show()})}},destroyDOM:function(){this.editor.destroy();ShareControlDialogBase.prototype.destroyDOM.apply(this);this.shareDialog=this.content=this.txtReason=this.shareTip=this.okButton=this.cancelButton=null},initializeEvent:function(){ShareControlDialogBase.prototype.initializeEvent.apply(this);this.onClickOKButtonHandler=this.onClickOKButton.bindAsEventListener(this);Event.observe(this.okButton,"click",this.onClickOKButtonHandler);this.onClickCancelButtonHandler=this.onClickCancelButton.bindAsEventListener(this);Event.observe(this.cancelButton,"click",this.onClickCancelButtonHandler)},destroyEvent:function(){this.navRegion&&Event.stopObserving(this.navRegion,"click",this.navControlHandler);this.imagesRegion&&Event.stopObserving(this.imagesRegion,"click",this.selectImageOrVideoHandler);this.videosRegion&&Event.stopObserving(this.videosRegion,"click",this.selectImageOrVideoHandler);this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);Event.stopObserving(this.okButton,"click",this.onClickOKButtonHandler);Event.stopObserving(this.cancelButton,"click",this.onClickCancelButtonHandler);ShareControlDialogBase.prototype.destroyEvent.apply(this)},navControl:function(k){var j=Event.findElement(k,"li");if(j!=document&&!j.hasClassName("on")){var l=j.up();var m=j.getAttribute("_type");var g=l.down(".on");var h=g.getAttribute("_type");g.removeClassName("on");j.addClassName("on");this.content.down('[_type="'+h+'s"]').hide();this.content.down('[_type="'+m+'s"]').show()}},videoCheck:function(){this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);this.videoCheckTimeout=null;var d=this.editorTextbox.getValue();if(this.shareVideoUrl&&d.indexOf(this.shareVideoUrl)==-1){var c=this.videosRegion.down('li[shortenurl="'+this.shareVideoUrl+'"]');if(c){c.removeClassName("on");this.shareVideoUrl=null}}this.videoCheckTimeout=setTimeout(this.videoCheck.bind(this),500)},selectImageOrVideo:function(l){var k=Event.findElement(l,"li");if(k!=document&&(k.hasAttribute("_imageurl")||k.hasAttribute("_videourl"))){if(k.hasClassName("on")){if(k.hasAttribute("_imageurl")){this.shareImageUrl=null}else{var p=this.shareVideoUrl;if(p){var q=this.editorTextbox.getValue().replace(new RegExp(p,"ig"),"");this.editor.editor.value="";this.editor.insertText(q)}this.shareVideoUrl=null}k.removeClassName("on")}else{if(k.hasAttribute("_imageurl")){this.shareImageUrl=k.getAttribute("_imageurl");var m=k.up('[_type="images"]').down(".on");m&&m.removeClassName("on");k.addClassName("on")}else{var p=this.shareVideoUrl;var q=this.editorTextbox.getValue().replace(new RegExp(p,"ig"),"");this.editor.editor.value="";this.editor.insertText(q);p=k.getAttribute("_videourl");var n=k.getAttribute("shortenurl");var o=this;var j=function(){o.editor.insertText(o.shareVideoUrl+" ");var a=k.up('[_type="videos"]').down(".on");a&&a.removeClassName("on");k.addClassName("on")};if(n){this.shareVideoUrl=n;j()}else{this.getShortenUrl(p,function(a){if(a&&a.value&&a.value.errorCode!=1){n=a.value.shortenUrl;k.setAttribute("shortenurl",n);o.shareVideoUrl=n;j()}})}}}}},saveShareCallback:function(c){if(c){var d=c.value;switch(d){case -2:$alert("您在时光网发布的内容违反互联网管理规定，对此帐户予禁言处理。",null,null,1);break;case -1:$alert("转发理由含有敏感词，请修改后再试",null,null,1);break;case 0:$alert("转发失败，请稍后再试",null,null,1);this.dialog.close();break;case 1:case 2:$alert("转发成功",null,null,1);this.dialog.close();break;default:this.dialog.close();break}}},onClickOKButton:function(f){var j=this.txtReason.value.trim();if(j===this.REASONDEFAULTTXT){j=""}var h=this.editor.getLength();if(h>this.editor.lengthExp.max){this.shareTip.show()}else{this.shareTip.hide();var g=this.shareImageUrl?this.shareImageUrl:"";var k="";this.shareControl.saveShare(j,this.saveShareCallback.bind(this),this.okButton,g,k)}},onClickCancelButton:function(b){this.dialog.close()}});var ShareToEMailDialog=Class.create();Object.extend(ShareToEMailDialog.prototype,ShareControlDialogBase.prototype);Object.extend(ShareToEMailDialog.prototype,{MAXEMAILCOUNT:10,EMAILINPUTDEFAULTTXT:"输入对方Email地址",REASONDEFAULTTXT:"写一条什么转发理由呢？",REASONMAXLENGTH:140,title:"通过邮件转发：",closed:false,content:null,shareDialog:null,friendEmailRegion:null,txtReason:null,shareTip:null,okButton:null,cancelButton:null,eMailNodeList:null,onFocusEMailNodeHandler:null,onBlurEMailNodeHandler:null,onClickFriendEmailRegionHandler:null,onClickOKButtonHandler:null,onClickCancelButtonHandler:null,onFocusTXTReasonHandler:null,onBlurTXTReasonHandler:null,server:{refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","RefreshVcode10",[],b,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},recommend:function(h,m,j,l,g,k){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","RecommendToFriend2",[h,m,j,l],g,"/database/databaseService.m?Ajax_CallBack=true","post","20000",k)},anonymousRecommend:function(q,n,o,s,p,r,t,u,l,m){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","AnonymousRecommendToFriend2",[q,n,o,s,p,r,t,u,l],m,"/database/databaseService.m?Ajax_CallBack=true","post","20000")}},initializeDOM:function(){ShareControlDialogBase.prototype.initializeDOM.apply(this);this.friendEmailRegion=Builder.node("div",[this.buildEmptyEmailNode(),this.buildEmptyEmailNode()]);this.txtReason=Builder.node("textarea",{className:"unfocus"},[this.REASONDEFAULTTXT]);this.shareTip=Builder.node("p",{className:"mt6 red",style:"display:none"});this.okButton=Builder.node("input",{type:"button",className:"btn_square_hover mr15",value:"确 认"});this.cancelButton=Builder.node("input",{type:"button",className:"btn_square",onmouseout:"this.className='btn_square';",onmouseover:"this.className='btn_square_hover';",value:"取 消"});this.content=Builder.node("div",[this.friendEmailRegion,Builder.node("div",{className:"share_word mt12"},[Builder.node("a",{href:this.shareControl.shareInfo.currentUserLink,target:"_blank"},[Builder.node("img",{width:32,src:this.shareControl.shareInfo.currentUserAvatarUrl,className:"img_box v_m",alt:this.shareControl.shareInfo.currentUserNickName})]),this.txtReason]),this.shareTip]);this.tabContentRegion.appendChild(this.content)},initializeControl:function(){ShareControlDialogBase.prototype.initializeControl.apply(this);if(this.dialog.buttonRegion){this.dialog.buttonRegion.appendChild(this.okButton);this.dialog.buttonRegion.appendChild(this.cancelButton)}},destroyDOM:function(){ShareControlDialogBase.prototype.destroyDOM.apply(this);this.shareDialog=this.content=this.txtReason=this.shareTip=this.okButton=this.cancelButton=null;this.friendEmailRegion=null},initializeEvent:function(){ShareControlDialogBase.prototype.initializeEvent.apply(this);this.onClickFriendEmailRegionHandler=this.onClickFriendEmailRegion.bindAsEventListener(this);Event.observe(this.friendEmailRegion,"click",this.onClickFriendEmailRegionHandler);this.onFocusTXTReasonHandler=this.onFocusTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"focus",this.onFocusTXTReasonHandler);this.onBlurTXTReasonHandler=this.onBlurTXTReason.bindAsEventListener(this);Event.observe(this.txtReason,"blur",this.onBlurTXTReasonHandler);this.onClickOKButtonHandler=this.onClickOKButton.bindAsEventListener(this);Event.observe(this.okButton,"click",this.onClickOKButtonHandler);this.onClickCancelButtonHandler=this.onClickCancelButton.bindAsEventListener(this);Event.observe(this.cancelButton,"click",this.onClickCancelButtonHandler)},destroyEvent:function(){if(this.eMailNodeList){this.eMailNodeList.each(function(b){Event.stopObserving(b,"focus",this.onFocusEMailNodeHandler);Event.stopObserving(b,"blur",this.onBlurEMailNodeHandler)}.bind(this))}this.eMailNodeList=null;Event.stopObserving(this.friendEmailRegion,"click",this.onClickFriendEmailRegionHandler);Event.stopObserving(this.txtReason,"focus",this.onFocusTXTReasonHandler);Event.stopObserving(this.txtReason,"blur",this.onBlurTXTReasonHandler);Event.stopObserving(this.okButton,"click",this.onClickOKButtonHandler);Event.stopObserving(this.cancelButton,"click",this.onClickCancelButtonHandler);ShareControlDialogBase.prototype.destroyEvent.apply(this)},setHint:function(b){this.shareTip.innerHTML=b;this.shareTip.show()},onClickFriendEmailRegion:function(g){var h=10;var f=Event.element(g);if(f.tagName&&f.tagName.toLowerCase()=="input"){var e=this.friendEmailRegion.getElementsByTagName("input");if(e.length<this.MAXEMAILCOUNT){if(e[e.length-1]==f){this.friendEmailRegion.appendChild(this.buildEmptyEmailNode())}}}},onFocusTXTReason:function(b){if(this.txtReason.value==this.REASONDEFAULTTXT){this.txtReason.value="";this.txtReason.removeClassName("unfocus");this.txtReason.addClassName("focus")}},onBlurTXTReason:function(b){if(!this.txtReason.value){this.txtReason.value=this.REASONDEFAULTTXT;this.txtReason.removeClassName("focus");this.txtReason.addClassName("unfocus")}},getEmails:function(){var k=[];var g=this.friendEmailRegion.getElementsByTagName("input");if(g.length>0){for(var m=0,h=g.length;m<h;m++){var l=g[m];var j=l.value.trim();if(j.length>0&&j!=this.EMAILINPUTDEFAULTTXT){k.push(j)}}}return k.uniq()},validEmails:function(g){for(var h=0,e=g.length;h<e;h++){var f=g[h];if(!Validator.validateEmail(f)){return false}}return true},onRecommendCallback:function(){if(this.closed){return}if(typeof recommendToFriendResult==="undefined"){return}var d=recommendToFriendResult;if(d&&d.value){this.dialog.close()}else{var c=d.value;switch(c){case -1:this.setHint("验证码错误，请重新输入");break;case -2:this.setHint("推荐用户错误，请检查");break;case -3:this.setHint("收件人错误，请检查");break;case -4:this.setHint("关联对象错误，请检查");break;default:this.setHint("推荐失败，请稍候重试");break}}},onClickOKButton:function(h){var m=true;var g=this.getEmails();if(g.length===0){m=false;this.setHint("请输入朋友的Email地址")}else{if(!this.validEmails(g)){m=false;this.setHint("Email地址的格式不对，请检查")}}var j=this.txtReason.value.trim();if(j===this.REASONDEFAULTTXT){j=""}if(j.length===0){j=this.shareControl.getShareObjectDefaultRecommendContent()}else{if(j.bytelength()>(this.REASONMAXLENGTH*2)){m=false;this.setHint(String.Format("对不起，你给朋友说的话不能超过{0}字",this.REASONMAXLENGTH))}}if(m){var k=this.shareControl;var l=k.getShareObjectDefaultRecommendSuffix();this.server.recommend(g.join("|"),k.recommentToFriendType,k.getShareObjectId(),j+l,this.onRecommendCallback.bind(this),this.okButton)}},onClickCancelButton:function(b){this.dialog.close()},onFocusEMailNode:function(f){var d=$(Event.element(f));if(d.value=="输入对方Email地址"){d.value="";d.removeClassName("unfocus");d.addClassName("focus")}var e=d.next("em");if(e){e.remove()}},onBlurEMailNode:function(f){var d=$(Event.element(f));if(!d.value){d.value="输入对方Email地址";d.removeClassName("focus");d.addClassName("unfocus");var e=d.next("em");if(e){e.remove()}}else{if(!Validator.validateEmail(d.value.trim())){$(d.parentNode).appendChild(Builder.node("em",["格式错误"]))}}},buildEmptyEmailNode:function(){if(!this.eMailNodeList){this.eMailNodeList=[];this.onFocusEMailNodeHandler=this.onFocusEMailNode.bindAsEventListener(this);this.onBlurEMailNodeHandler=this.onBlurEMailNode.bindAsEventListener(this)}var b=$(Builder.node("input",{type:"text",className:"input_tx unfocus",value:this.EMAILINPUTDEFAULTTXT}));Event.observe(b,"focus",this.onFocusEMailNodeHandler);Event.observe(b,"blur",this.onBlurEMailNodeHandler);this.eMailNodeList.push(b);return Builder.node("p",{className:"share_input mt12"},[b])}});var ShareToURLDialog=Class.create();Object.extend(ShareToURLDialog.prototype,ShareControlDialogBase.prototype);Object.extend(ShareToURLDialog.prototype,{title:"复制链接：",closed:false,content:null,shareControl:null,iptURL:null,onClickIPTURLHandler:null,initializeDOM:function(){ShareControlDialogBase.prototype.initializeDOM.apply(this);var b=this.shareControl.getShareObjectUrl();this.iptURL=Builder.node("input",{type:"text",className:"input_tx c_blue",value:b,readonly:"readonly"});this.content=Builder.node("div",{className:"mt15"},[Builder.node("p",["将此链接粘贴到电子邮件或即时消息中："]),Builder.node("p",{className:"share_input mt12"},[this.iptURL])]);this.tabContentRegion.appendChild(this.content)},destroyDOM:function(){ShareControlDialogBase.prototype.destroyDOM.apply(this);this.shareControl=this.content=this.iptURL=null},initializeEvent:function(){ShareControlDialogBase.prototype.initializeEvent.apply(this);this.onClickIPTURLHandler=this.onClickIPTURL.bindAsEventListener(this);Event.observe(this.iptURL,"click",this.onClickIPTURLHandler)},destroyEvent:function(){Event.stopObserving(this.iptURL,"click",this.onClickIPTURLHandler);ShareControlDialogBase.prototype.destroyEvent.apply(this)},onClickIPTURL:function(b){if(Globals.copyToClipboard(this.iptURL.value)){$alert("链接已复制成功，你可以按Ctrl+V 直接粘贴")}else{this.iptURL.select()}}});var ShareControlBase=Class.create();Object.extend(ShareControlBase.prototype,{name:"ShareControlBase",closed:false,EXCERPT_SIZE:50,REASON_TIP:"你可以输入转发理由...",MtimeShareRelatedObjectTypes:$H(MtimeShareRelatedObjectTypes),avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.shareToURL],relatedObjType:0,recommentToFriendType:-1,shareButton:null,shareInfo:null,buttonArrow:null,server:{saveShareInfo:function(l,k,j,g,h,m){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Community.Controls.CommunityPages.DatabaseService","SaveShareInfoCrossDomainByFlash",[l,k,j,h,m],g,"/database/databaseService.m","post","20000")},getShareInfo:function(g,f,e,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetShareInfo",[g,f],e,"/database/databaseService.m?Ajax_CallBack=true","get","20000",h)}},ButtonOutULCount:4,ButtonInfoMap:$H({toMtime:{name:"toMtime",spanClassName:"to_mtime",text:"时光好友",type:ShareTabType.shareToMtimeFriend},toSina:{name:"toSina",spanClassName:"to_sina",text:"新浪微博",type:ShareTabType.shareToWeb,urlFormat:"http://service.t.sina.com.cn/share/share.php?appkey=166678827&pic={2}&ralateUid=1663735900&url={0}&title={1}"},toQQ:{name:"toQQ",spanClassName:"to_qq",text:"腾讯微博",type:ShareTabType.shareToWeb,urlFormat:"http://v.t.qq.com/share/share.php?url={0}&appkey=351dd60cf63a48429932e971ca31e87c&site="+encodeURIComponent("http://www.mtime.com")+"&pic={2}&title={1}"},toKaiXin:{name:"toKaiXin",spanClassName:"to_kaixin",text:"开心",type:ShareTabType.shareToWeb,urlFormat:"http://www.kaixin001.com/repaste/share.php?rurl={0}&rtitle={1}"},toRenRen:{name:"toRenRen",spanClassName:"to_renren",text:"人人",type:ShareTabType.shareToWeb,urlFormat:"http://share.renren.com/share/buttonshare.do?link={0}&title={1}"},toTianYi:{name:"toTianYi",spanClassName:"to_tianyi",text:"天翼",type:ShareTabType.shareToWeb,urlFormat:"http://s.189share.com/interface.jsp?url={0}&title={1}"},to163:{name:"to163",spanClassName:"to_163",text:"网易微博",type:ShareTabType.shareToWeb,urlFormat:"http://t.163.com/article/user/checkLogin.do?link={0}&source="+encodeURIComponent("Mtime时光网")+"&info={1}{0}&images={2}&togImg=true"},toDouBan:{name:"toDouBan",spanClassName:"to_douban",text:"豆瓣",type:ShareTabType.shareToWeb,urlFormat:"http://www.douban.com/recommend/?url={0}&title={1}"},toQzone:{name:"toQzone",spanClassName:"to_qzone",text:"Qzone",type:ShareTabType.shareToWeb,urlFormat:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={0}"},toMSN:{name:"toMSN",spanClassName:"to_msn",text:"MSN",type:ShareTabType.shareToWeb,urlFormat:"http://profile.live.com/badge/?url={0}&title={1}&description=&screenshot={2}"},toEMail:{name:"toEMail",spanClassName:"to_email",text:"邮件地址",type:ShareTabType.shareToEMail,urlFormat:"mailto:?subject={3}&body={4}"},toURL:{name:"toURL",spanClassName:"to_link",text:"复制链接",type:ShareTabType.shareToURL}}),options:{shareButton:null,autoLoad:true},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);if(this.avaliableTabs.include(ShareTabType.shareToEMail)&&this.recommentToFriendType==-1){throw this.name+".recommentToFriendType must be assigned when avaliableTabs contain ShareTabType.shareToEMail."}this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load();this.render();Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){this.avaliableTabs=$A(this.avaliableTabs)},initializeDOM:function(){if(this.shareButton){this.shareButton=$(this.shareButton);if(this.autoLoad){this.shareButton.hide()}var q=[];var p=[];var k=0;var m=this.ButtonInfoMap.values();for(var o=0;o<m.length;++o){var l=m[o];if(this.avaliableTabs.indexOf(l.type)<0){continue}if(k<this.ButtonOutULCount){var j=(k==this.ButtonOutULCount-1)?"expec2":"expec";q.push('<a href="#" target="_blank" method="'+l.name+'" class="'+j+'" title="'+l.text+'"><span class="'+l.spanClassName+'"> </span></a>')}if(l.name==="toEMail"){p.push('<li><a method="'+l.name+'" href="###"><span class="'+l.spanClassName+'">&nbsp;</span> '+l.text+"</a></li>")}else{p.push('<li><a method="'+l.name+'" target="_blank" href="###"><span class="'+l.spanClassName+'">&nbsp;</span> '+l.text+"</a></li>")}k++}var n=[];n.push('<span class="fl">转发：</span>');n=n.concat(q);n.push('<div class="more_exp"><a class="expecon" method="buttonArrow" href="#">&nbsp;</a><ul>');n=n.concat(p);n.push("</ul></div>");this.shareButton.innerHTML=n.join("");this.shareButton.addClassName("new_share")}},destroyDOM:function(){if(this.shareButton){this.shareButton=null}},initializeEvent:function(){this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);if(this.shareButton){this.shareButton.observe("click",this.onClickShareButtonHandler)}},destroyEvent:function(){if(this.shareButton){this.shareButton.stopObserving("click",this.onClickShareButtonHandler);if(this.onClickHandler){Event.stopObserving(document.body,"click",this.onClickHandler)}}},initializeControl:function(){},destroyControl:function(){},load:function(){if(this.autoLoad){this.server.getShareInfo(this.relatedObjType,this.getShareObjectId(),this.getShareInfoCallback.bind(this),this.shareButton)}},render:function(){},renderWebShareLinks:function(){var m=encodeURIComponent(this.getShareObjectUrl());var l=encodeURIComponent(this.getShareObjectTitle());var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=encodeURIComponent(this.getShareObjectPicUrl())}var h=this.shareButton.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))},shareInfoLoaded:function(){},getShareInfoCallback:function(b){if(typeof getShareInfoResult!="undefined"&&getShareInfoResult.value){this.shareInfo=getShareInfoResult.value;this.shareInfoLoaded();this.renderWebShareLinks();if(this.autoLoad){this.shareButton.show()}this.showShareDialog(b)}else{$alert("加载对象信息出错，请刷新页面重试")}},onClick:function(d){var c=Event.findElement(d,"a");if(c!=this.buttonArrow){$(this.buttonArrow.parentNode).removeClassName("more_exp_hover");$(this.buttonArrow.parentNode).addClassName("more_exp");Event.stopObserving(document.body,"click",this.onClickHandler)}},onClickShareButton:function(g){var f=Event.findElement(g,"a");if(!f||!f.readAttribute){return}var h=f.readAttribute("method");if(!h){return}if(h=="buttonArrow"){this.buttonArrow=f;var e=$(this.buttonArrow.parentNode);if(e.hasClassName("more_exp")){e.removeClassName("more_exp");e.addClassName("more_exp_hover");if(!this.onClickHandler){this.onClickHandler=this.onClick.bindAsEventListener(this)}Event.observe(document.body,"click",this.onClickHandler)}else{e.removeClassName("more_exp_hover");e.addClassName("more_exp");Event.stopObserving(document.body,"click",this.onClickHandler)}Event.stopB(g)}else{if(this.shareInfo===null){this.server.getShareInfo(this.relatedObjType,this.getShareObjectId(),this.getShareInfoCallback.bind(this,h),this.shareButton);this.evt=g;Event.stopB(g)}else{this.showShareDialog(h,g)}}},getSignInUrl:function(){return siteUrl+"/member/signin/operation/?redirectUrl="+encodeURIComponent(location.href)},shareTrack:function(d){var f=null;this.MtimeShareRelatedObjectTypes.find(function(a){if(a.value===this.relatedObjType){f=a.key}return false}.bind(this));if(!f){return}var e=String.format("M11_Common_Share{0}_{1}",f,d);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackClick("M11_Common",e)}},showShareDialog:function(e,f){var d=this.ButtonInfoMap[e];if(!d){return}if(d.type==ShareTabType.shareToWeb||d.type==ShareTabType.shareToEMail){if(!f){window.open(this.shareButton.getElementsBySelector('a[method="'+e+'"]')[0].href)}this.shareTrack(e)}else{if(f){Event.stopB(f)}if(d.type==ShareTabType.shareToURL){new ShareToURLDialog({shareControl:this});return}if(!this.shareInfo.isLogin){$redirect(this.getSignInUrl());return}switch(d.type){case ShareTabType.shareToMtimeFriend:default:this.showShareToMtimeFriendDialog();break}}},showShareToMtimeFriendDialog:function(){new ShareToMtimeFriendDialog({shareControl:this})},getShareObjectUrl:function(){throw"ShareControl.getShareObjectUrl does not implemented!"},getShareObjectPicUrl:function(){return""},getShareObjectTitle:function(){throw"ShareControl.getShareObjectTitle does not implemented!"},getShareObjectId:function(){throw"ShareControl.getShareObjectId does not implemented!"},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},getShareObjectDefaultRecommendSuffix:function(){return""},getShareContentDOM:function(){var b=this.shareInfo.description;if(b.bytelength()>this.EXCERPT_SIZE*2){b=b.substr(0,this.EXCERPT_SIZE)+"..."}return Builder.node("div",[Builder.node("p",[Builder.node("a",{href:this.getShareObjectUrl(),target:"_blank",className:"link_line"},[this.getShareObjectTitle()])]),Builder.node("p",{className:"mt6 c_a5"},[b])])},saveShareInternal:function(h,f,j,g,k){this.server.saveShareInfo(this.relatedObjType,this.getShareObjectId(),h,f,g,k)},onSaveShareCallback:function(c,d){if(d){c(d)}},saveShare:function(h,f,j,g,k){this.saveShareInternal(h,this.onSaveShareCallback.bind(this,f),j,g,k)},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareVideoControl=Class.create();Object.extend(ShareVideoControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoControl.prototype,{name:"ShareVideoControl",avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],relatedObjType:MtimeShareRelatedObjectTypes.Video,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0}),getShareObjectUrl:function(){return this.shareInfo.videoUrl},getShareObjectTitle:function(){return this.shareInfo.title.unescapeHTML()},getShareObjectId:function(){return this.videoId},getShareObjectDefaultRecommendContent:function(f){var e="分享一个视频-"+this.getShareObjectTitle();var d="你好，这个视频很精彩，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareMovieControl=Class.create();Object.extend(ShareMovieControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieControl.prototype,{name:"ShareMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,recommentToFriendType:1,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectTitle()+"》";var d="你好，这个电影不错哦，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var SharePersonControl=Class.create();Object.extend(SharePersonControl.prototype,ShareControlBase.prototype);Object.extend(SharePersonControl.prototype,{name:"SharePersonControl",relatedObjType:MtimeShareRelatedObjectTypes.Person,recommentToFriendType:2,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{personId:0}),getShareObjectUrl:function(){return this.shareInfo.personLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.personId},getShareObjectDefaultRecommendContent:function(f){var e='分享影视人物"'+this.getShareObjectTitle()+'"';var d="【"+this.getShareObjectTitle()+"】想看更多关于Ta的介绍和图片，快来这里："+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareListControl=Class.create();Object.extend(ShareListControl.prototype,ShareControlBase.prototype);Object.extend(ShareListControl.prototype,{name:"ShareListControl",avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],relatedObjType:MtimeShareRelatedObjectTypes.List,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{listId:0}),getShareObjectUrl:function(){return this.shareInfo.listUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.listId}});var ShareTopListControl=Class.create();Object.extend(ShareTopListControl.prototype,ShareControlBase.prototype);Object.extend(ShareTopListControl.prototype,{name:"ShareTopListControl",avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.shareToURL],relatedObjType:MtimeShareRelatedObjectTypes.TopList,recommentToFriendType:20,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{topListId:0}),getShareObjectUrl:function(){return this.shareInfo.topListUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.topListId},getShareObjectPicUrl:function(){return this.shareInfo.pic},showShareToMtimeFriendDialog:function(){new ShareToMtimeFriendDialog({shareControl:this,selectFirstImage:true})},getShareObjectDefaultRecommendContent:function(f){var e="分享一个特色榜单-"+this.getShareObjectTitle();var d="你好，这个电影榜单不错哦，我猜你会喜欢！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareNewsControl=Class.create();Object.extend(ShareNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareNewsControl.prototype,{name:"ShareNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,recommentToFriendType:17,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0}),getShareObjectUrl:function(){return this.shareInfo.newsUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.newsId},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareVideoNewsControl=Class.create();Object.extend(ShareVideoNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoNewsControl.prototype,{name:"ShareVideoNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,recommentToFriendType:17,initializeField:function(){ShareControlBase.prototype.initializeField.apply(this);this.ButtonInfoMap.toMtime={name:"toMtime",spanClassName:"to_mtime",text:"时光好友",type:ShareTabType.shareToWeb,urlFormat:"http://service.mtime.com/Utility/RecommendToShare.m4?url={0}&title={1}"}},load:function(){window.getShareInfoResult={value:{description:"",isLogin:this.isLogin,needAdditionalInfo:false,newsId:this.newsId,newsUrl:location.href,replyCount:this.replyCount,title:this.title}};this.getShareInfoCallback(this.shareButton)},options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0,title:"",description:"",newsUrl:"",replyCount:0}),getShareObjectUrl:function(){return this.shareInfo.newsUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.shareInfo.newsId},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareGroupEventControl=Class.create();Object.extend(ShareGroupEventControl.prototype,ShareControlBase.prototype);Object.extend(ShareGroupEventControl.prototype,{name:"ShareGroupEventControl",relatedObjType:MtimeShareRelatedObjectTypes.Activity,recommentToFriendType:12,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{groupEventId:0}),getShareObjectUrl:function(){return this.shareInfo.groupEventUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.groupEventId},getShareObjectDefaultRecommendContent:function(f){var e="分享一个热门活动-"+this.getShareObjectTitle();var d="你好，这个活动很热门哦，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareForumTopicControl=Class.create();Object.extend(ShareForumTopicControl.prototype,ShareControlBase.prototype);Object.extend(ShareForumTopicControl.prototype,{name:"ShareForumTopicControl",relatedObjType:MtimeShareRelatedObjectTypes.ForumTopic,recommentToFriendType:11,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{topicId:0}),getShareObjectUrl:function(){return this.shareInfo.topicUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.topicId},getShareObjectDefaultRecommendContent:function(f){var e="分享一个热门话题-"+this.getShareObjectTitle();var d="你好，这个话题很热门哦，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareUserPhotoControl=Class.create();Object.extend(ShareUserPhotoControl.prototype,ShareControlBase.prototype);Object.extend(ShareUserPhotoControl.prototype,{name:"ShareUserPhotoControl",relatedObjType:MtimeShareRelatedObjectTypes.UserPhoto,recommentToFriendType:4,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{photoId:0}),getShareObjectUrl:function(){return this.shareInfo.photoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.photoId},getShareObjectDefaultRecommendContent:function(f){var e="分享一张照片";var d="分享【"+this.shareInfo.ownerNickname+"的照片】，更多图片："+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareBlogControl=Class.create();Object.extend(ShareBlogControl.prototype,ShareControlBase.prototype);Object.extend(ShareBlogControl.prototype,{name:"ShareBlogControl",relatedObjType:MtimeShareRelatedObjectTypes.Blog,recommentToFriendType:3,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{blogId:0}),getShareObjectUrl:function(){return this.shareInfo.blogLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.blogId},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareMoviePictureControl=Class.create();Object.extend(ShareMoviePictureControl.prototype,ShareControlBase.prototype);Object.extend(ShareMoviePictureControl.prototype,{name:"ShareMoviePictureControl",relatedObjType:MtimeShareRelatedObjectTypes.MoviePicture,recommentToFriendType:5,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getShareObjectUrl:function(){return this.shareInfo.imageUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareObjectDefaultRecommendContent:function(f){var e="分享电影图片";var d="分享《"+this.getShareObjectTitle()+"》的剧照，更多图片："+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var SharePersonPictureControl=Class.create();Object.extend(SharePersonPictureControl.prototype,ShareControlBase.prototype);Object.extend(SharePersonPictureControl.prototype,{name:"SharePictureControl",relatedObjType:MtimeShareRelatedObjectTypes.PersonPicture,recommentToFriendType:6,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getShareObjectUrl:function(){return this.shareInfo.imageUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareObjectDefaultRecommendContent:function(f){var e="分享影视人物图片";var d="分享《"+this.getShareObjectTitle()+"》的剧照，更多图片："+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareCinemaControl=Class.create();Object.extend(ShareCinemaControl.prototype,ShareControlBase.prototype);Object.extend(ShareCinemaControl.prototype,{name:"ShareCinemaControl",relatedObjType:MtimeShareRelatedObjectTypes.Cinema,recommentToFriendType:14,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{cinemaId:0}),getShareObjectUrl:function(){return this.shareInfo.cinemaUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.cinemaId}});var ShareGameVoteControl=Class.create();Object.extend(ShareGameVoteControl.prototype,ShareControlBase.prototype);Object.extend(ShareGameVoteControl.prototype,{name:"ShareGameVoteControl",relatedObjType:MtimeShareRelatedObjectTypes.GameVote,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{gameVoteId:0}),getShareObjectUrl:function(){return this.shareInfo.voteUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.gameVoteId}});var ShareGroupControl=Class.create();Object.extend(ShareGroupControl.prototype,ShareControlBase.prototype);Object.extend(ShareGroupControl.prototype,{name:"ShareGroupControl",relatedObjType:MtimeShareRelatedObjectTypes.Group,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{groupId:0}),getShareObjectUrl:function(){return this.shareInfo.groupUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.groupId}});var ShareQuizControl=Class.create();Object.extend(ShareQuizControl.prototype,ShareControlBase.prototype);Object.extend(ShareQuizControl.prototype,{name:"ShareQuizControl",relatedObjType:MtimeShareRelatedObjectTypes.GameQuiz,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{gameId:0}),getShareObjectUrl:function(){return this.shareInfo.gameUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.gameId}});var ShareLinkControl=Class.create();Object.extend(ShareLinkControl.prototype,ShareControlBase.prototype);Object.extend(ShareLinkControl.prototype,{name:"ShareLinkControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",url:"",description:"",pic:""}),serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","RecommendLinkToShare",[j,k,h,g],f,"/database/databaseService.m?Ajax_CallBack=true","get","20000")}},getShareObjectUrl:function(){return this.shareInfo.url},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectId:function(){return 0},shareInfoLoaded:function(){this.shareInfo.title=this.title;this.shareInfo.url=this.url;this.shareInfo.description=this.description;this.shareInfo.pic=this.pic},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undifined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.shareInfo.title,this.shareInfo.url,e,this.shareInfo.description,d)}});var ShareCMSGalleryImageControl=Class.create();Object.extend(ShareCMSGalleryImageControl.prototype,ShareControlBase.prototype);Object.extend(ShareCMSGalleryImageControl.prototype,{name:"ShareCMSGalleryImageControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSGalleryImage,recommentToFriendType:18,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getShareObjectUrl:function(){return this.shareInfo.imageUrl},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareSpecialTopicControl=Class.create();Object.extend(ShareSpecialTopicControl.prototype,ShareControlBase.prototype);Object.extend(ShareSpecialTopicControl.prototype,{name:"ShareSpecialTopicControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSSpecialTopic,recommentToFriendType:19,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{specialTopicId:0}),getShareObjectUrl:function(){return this.shareInfo.specialTopicUrl},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.specialTopicId},getShareObjectDefaultRecommendContent:function(f){var e="分享一个专题-"+this.getShareObjectTitle();var d="你好，这个电影专题不错哦，我猜你会喜欢！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareFestivalControl=Class.create();Object.extend(ShareFestivalControl.prototype,ShareControlBase.prototype);Object.extend(ShareFestivalControl.prototype,{name:"ShareFestivalControl",relatedObjType:MtimeShareRelatedObjectTypes.Festival,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{festivalId:0}),getShareObjectUrl:function(){return this.shareInfo.festivalLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.festivalId},getShareObjectDefaultRecommendContent:function(){return"分享电影节/颁奖典礼"}});var ShareFestivalEventControl=Class.create();Object.extend(ShareFestivalEventControl.prototype,ShareControlBase.prototype);Object.extend(ShareFestivalEventControl.prototype,{name:"ShareFestivalEventControl",relatedObjType:MtimeShareRelatedObjectTypes.FestivalEvent,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{festivalEventId:0}),getShareObjectUrl:function(){return this.shareInfo.festivalEventLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.festivalEventId},getShareObjectDefaultRecommendContent:function(){return"分享电影节/颁奖典礼"}});var ShareMovieShowtimeEventControl=Class.create();Object.extend(ShareMovieShowtimeEventControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieShowtimeEventControl.prototype,{name:"ShareMovieShowtimeEventControl",relatedObjType:-1,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{date:new Date(),movieTitle:"",cityName:"",imageUrl:"",imagePath:"",link:""}),shareInfoLoaded:function(){Object.extend(this.shareInfo,{title:String.format("《{0}》 {1}年{2}月{3}日 {4} 最新影讯",this.movieTitle,this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate(),this.cityName),imagePath:this.imagePath,imageUrl:this.imageUrl,link:this.link})},getImagePath:function(b){if(!this.shareInfo.imagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UploadPicByUrl",[this.shareInfo.imageUrl],function(a){if(a&&a.value&&a.value.ImagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetThumbnailImageUrlByImagePath",[a.value.ImagePath],function(d){if(d&&d.value&&d.value.ImageUrl){this.shareInfo.imagePath=a.value.ImagePath;this.shareInfo.imageUrl=d.value.ImageUrl;b&&b()}}.bind(this),"/Service/Twitter.msi","get","20000")}}.bind(this),"/Service/Twitter.msi","get","20000")}else{b&&b()}},shareTrack:function(c){var d=String.format("M11_TheaterMovieShowtimePage_Share_{0}",c);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackClick("M11_TheaterMovieShowtimePage",d)}},showShareToMtimeFriendDialog:function(){this.getImagePath(function(){var c={content:this.shareInfo.title+" "+this.shareInfo.link,imagePath:this.shareInfo.imagePath,imageUrl:this.shareInfo.imageUrl};if(typeof Weibo!="undefined"&&typeof(Weibo.TwitterDialog)!="undefined"&&typeof(Weibo.Editor)!="undefined"){var d=new Weibo.TwitterDialog(c)}else{if(debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/movieLinker.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js","/js/2011/weibo/popupDialog.js"],function(){var a=new Weibo.TwitterDialog(c)})}else{$loadJs("/js/2011/weiboEditor.js",function(){var a=new Weibo.TwitterDialog(c)})}}}.bind(this))},getShareObjectUrl:function(){return this.shareInfo.link},getShareObjectPicUrl:function(){return this.shareInfo.imageUrl},getShareObjectId:function(){return 0},getShareObjectTitle:function(){return this.shareInfo.title}});var ShareCinemaShowtimeEventControl=Class.create();Object.extend(ShareCinemaShowtimeEventControl.prototype,ShareControlBase.prototype);Object.extend(ShareCinemaShowtimeEventControl.prototype,{name:"ShareCinemaShowtimeEventControl",relatedObjType:-1,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{date:new Date(),cinemaName:"",imageUrl:"",imagePath:"",link:""}),shareInfoLoaded:function(){Object.extend(this.shareInfo,{title:String.format("{0} {1}年{2}月{3}日 最新影讯",this.cinemaName,this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate()),imagePath:this.imagePath,imageUrl:this.imageUrl,link:this.link})},getImagePath:function(b){if(!this.shareInfo.imagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UploadPicByUrl",[this.shareInfo.imageUrl],function(a){if(a&&a.value&&a.value.ImagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetThumbnailImageUrlByImagePath",[a.value.ImagePath],function(d){if(d&&d.value&&d.value.ImageUrl){this.shareInfo.imagePath=a.value.ImagePath;this.shareInfo.imageUrl=d.value.ImageUrl;b&&b()}}.bind(this),"/Service/Twitter.msi","get","20000")}}.bind(this),"/Service/Twitter.msi","get","20000")}else{b&&b()}},shareTrack:function(c){var d=String.format("M11_TheaterCinemaInfoPage_Share_{0}",c);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackClick("M11_TheaterCinemaInfoPage",d)}},showShareToMtimeFriendDialog:function(){this.getImagePath(function(){var c={content:this.shareInfo.title+" "+this.shareInfo.link,imagePath:this.shareInfo.imagePath,imageUrl:this.shareInfo.imageUrl};if(typeof Weibo!="undefined"&&typeof(Weibo.TwitterDialog)!="undefined"&&typeof(Weibo.Editor)!="undefined"){var d=new Weibo.TwitterDialog(c)}else{if(debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/movieLinker.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js","/js/2011/weibo/popupDialog.js"],function(){var a=new Weibo.TwitterDialog(c)})}else{$loadJs("/js/2011/weiboEditor.js",function(){var a=new Weibo.TwitterDialog(c)})}}}.bind(this))},getShareObjectUrl:function(){return this.shareInfo.link},getShareObjectPicUrl:function(){return this.shareInfo.imageUrl},getShareObjectId:function(){return 0},getShareObjectTitle:function(){return this.shareInfo.title}});var ShareCommunityFeatureControl=Class.create();Object.extend(ShareCommunityFeatureControl.prototype,ShareControlBase.prototype);Object.extend(ShareCommunityFeatureControl.prototype,{name:"ShareCommunityFeatureControl",relatedObjType:MtimeShareRelatedObjectTypes.CommunityFeature,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{featureId:0}),getShareObjectUrl:function(){return this.shareInfo.featureLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.featureId}});var ShareTop100Control=Class.create();Object.extend(ShareTop100Control.prototype,ShareControlBase.prototype);Object.extend(ShareTop100Control.prototype,{name:"ShareTop100Control",relatedObjType:-1,recommentToFriendType:21,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{top100Title:"",imageUrl:"",imagePath:"",link:""}),shareInfoLoaded:function(){Object.extend(this.shareInfo,{title:this.top100Title,imagePath:this.imagePath,imageUrl:this.imageUrl,link:this.link})},getImagePath:function(b){if(!this.shareInfo.imagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UploadPicByUrl",[this.shareInfo.imageUrl],function(a){if(a&&a.value&&a.value.ImagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetThumbnailImageUrlByImagePath",[a.value.ImagePath],function(d){if(d&&d.value&&d.value.ImageUrl){this.shareInfo.imagePath=a.value.ImagePath;this.shareInfo.imageUrl=d.value.ImageUrl;b&&b()}}.bind(this),"/Service/Twitter.msi","get","20000")}}.bind(this),"/Service/Twitter.msi","get","20000")}else{b&&b()}},showShareToMtimeFriendDialog:function(){this.getImagePath(function(){var c={content:this.shareInfo.title+" "+this.shareInfo.link,imagePath:this.shareInfo.imagePath,imageUrl:this.shareInfo.imageUrl};if(typeof Weibo!="undefined"&&typeof(Weibo.TwitterDialog)!="undefined"&&typeof(Weibo.Editor)!="undefined"){var d=new Weibo.TwitterDialog(c)}else{$loadJs("/js/2011/weiboEditor.js",function(){var a=new Weibo.TwitterDialog(c)})}}.bind(this))},getShareObjectUrl:function(){return this.shareInfo.link},getShareObjectPicUrl:function(){return this.shareInfo.imageUrl},getShareObjectId:function(){return 0},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectDefaultRecommendContent:function(f){var e="分享一个时光热榜-"+this.getShareObjectTitle();var d="你好，这个时光热榜不错哦，我猜你会喜欢！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},getShareObjectDefaultRecommendSuffix:function(){return"<br/>"+this.top100Title+"<br />"+this.link}});var DETSeatOrderSMSSendDialog=Class.create();Object.extend(DETSeatOrderSMSSendDialog.prototype,{server:{sendSMS:function(k,h,j,g,f){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","SMSShareDETSeatOrder",[k,h,j],g,"/database/databaseService.m?Ajax_CallBack=true","get","20000",f)}},options:{orderId:null,content:""},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeField:function(){},initializeDOM:function(){},initializeEvent:function(){this.sendSMSHandler=this.sendSMS.bind(this);Event.observe(this.$send,"click",this.sendSMSHandler)},initializeControl:function(){var c=new Template('<div class="t_f_pop"><p class="t_f_txt"> <span class="ico_yin_l">“</span><input type="text" value="" name="name" style="width:60px;padding:0 0 0 10px;" class="share_txt mr6 edit_share_txt" >#{first}<span class="ico_yin_r">”</span></p><p class=" tr mtb20"><input type="text" class="share_txt mr6" name="mobile" style="width:120px;" value="" /><input name="send" type="button" class="t_btn_blue_i" value="确认发送" style="height:39px;_height:41px; vertical-align:top;" /></p></div>'),d={first:this.content.substring(0)};this.dialog=new Dialog({windowStyle:"width: 585px;",content:c.evaluate(d),initializeDOMCallback:function(){this.buttonRegion=$(this.buttonRegionId);this.buttonRegion.hide()},title:"发给朋友",readyCallback:this.dialogReady.bind(this)})},dialogReady:function(d){var c=d.windowElement;this.$name=c.down('input[name="name"]');this.$mobile=c.down('input[name="mobile"]');this.$send=c.down('input[name="send"]');this.nameText=new Textbox({text:this.$name,watermarkText:"您的姓名"});this.mobileText=new Textbox({text:this.$mobile,watermarkText:"请输入手机号"});this.initializeEvent()},validate:function(){var e=this.nameText.getValue(),d=this.mobileText.getValue(),f=true;if(!e||Math.ceil(Validator.getChineseStringLength(e)/2)>5){this.$name.addClassName("input_false");f=false}else{this.$name.removeClassName("input_false")}if(!d||!Validator.MobilePhone.test(d)){this.$mobile.addClassName("input_false");f=false}else{this.$mobile.removeClassName("input_false")}return f},sendSMS:function(){var d=this.nameText.getValue(),c=this.mobileText.getValue();if(this.validate()){this.server.sendSMS(this.orderId,c,d,function(b){if(b&&b.value&&b.value.Success){$alert("发送成功");this.close()}else{var a=b&&b.value&&b.value.ErrorInfo?b.value.ErrorInfo:"发送失败";$alert(a)}}.bind(this),this.$send)}},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyControl();this.destroyEvent();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyField:function(){},destroyDOM:function(){},destroyEvent:function(){Event.stopObserving(this.$send,"click",this.sendSMSHandler)},destroyControl:function(){this.dialog&&this.dialog.close();this.dialog=null}});var ShareDETSeatOrderControl=Class.create();Object.extend(ShareDETSeatOrderControl.prototype,ShareControlBase.prototype);Object.extend(ShareDETSeatOrderControl.prototype,{name:"ShareDETSeatOrderControl",ButtonOutULCount:3,relatedObjType:MtimeShareRelatedObjectTypes.DETSeatOrder,avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToWeb,ShareTabType.shareToURL],options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{orderId:0}),initializeControl:function(){this.$sendSMS=Builder.build('<a title="短信" class="expec" method="toMtime" target="_blank" href="#"><span class="to_message"> </span></a>');this.shareButton.insertBefore(this.$sendSMS,this.shareButton.down('[method="toMtime"]'));Event.observe(this.$sendSMS,"click",function(b){Event.stop(b);new DETSeatOrderSMSSendDialog({orderId:this.orderId,content:this.shareInfo.smsContent})}.bind(this))},showShareToMtimeFriendDialog:function(){window.open("http://service.mtime.com/Utility/RecommendToShare.m4?url="+encodeURIComponent(this.shareInfo.movieShowtimeUrl)+"&title="+encodeURIComponent(this.shareInfo.title)+"&from=www.mtime.com")},getShareObjectUrl:function(){return this.shareInfo.movieShowtimeUrl},getShareObjectPicUrl:function(){return""},getShareObjectId:function(){return this.orderId},getShareObjectTitle:function(){return this.shareInfo.title}});var ShareControlManager=Class.create();Object.extend(ShareControlManager.prototype,{controls:null,initialize:function(){this.controls=[]},initShareControl:function(b){b.each(function(a){var d;switch(parseInt(a.relatedObjType,10)){case MtimeShareRelatedObjectTypes.CMSNews:d=new ShareNewsControl({newsId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.CMSGalleryImage:d=new ShareCMSGalleryImageControl({imageId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.CMSSpecialTopic:d=new ShareSpecialTopicControl({specialTopicId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Blog:d=new ShareBlogControl({blogId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Person:d=new SharePersonControl({personId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Movie:new ShareMovieControl({movieId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.ForumTopic:d=new ShareForumTopicControl({topicId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.MoviePicture:d=new ShareMoviePictureControl({imageId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.PersonPicture:d=new SharePersonPictureControl({imageId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.UserPhoto:d=new ShareUserPhotoControl({photoId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Activity:d=new ShareGroupEventControl({groupEventId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Video:d=new ShareVideoControl({videoId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Cinema:d=new ShareCinemaControl({cinemaId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.GameVote:d=new ShareGameVoteControl({gameVoteId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Group:d=new ShareGroupControl({groupId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.List:d=new ShareListControl({listId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.Festival:d=new ShareFestivalControl({festivalId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.FestivalEvent:d=new ShareFestivalEventControl({festivalEventId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;case MtimeShareRelatedObjectTypes.CommunityFeature:d=new ShareCommunityFeatureControl({featureId:a.relatedId,shareButton:a.shareButton,autoLoad:false});break;default:break}if(d){this.controls.push(d)}}.bind(this))},destroyControl:function(){this.controls.each(function(b){b.close()});this.controls=null},close:function(){if(!this.closed){this.closed=true;this.destroyControl()}}});var SwfToMp4Video=Class.create();Object.extend(SwfToMp4Video.prototype,{name:"SwfToMp4Video",server:{getVideoInfo:function(d,c){return Mtime.Component.Ajax.request(siteApiUrl,"Mtime.Api.Pages.VideoService","GetVideoInfo",[d],c,"/Service/Video.api?Ajax_CallBack=true","get","10000")}},options:{contentRegion:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent()},initializeField:function(){},initializeDOM:function(){var h=this.browserRedirect();if(h){this.newsContentRegion=$(this.contentRegion);if(this.newsContentRegion){var l=this.newsContentRegion.getElementsByTagName("object");var m=l.length;if(m>0){for(var j=0;j<m;j++){this.buildPlayer(l[j],0)}}l=this.newsContentRegion.getElementsByTagName("embed");m=l.length;if(m>0){for(var g=0;g<m;g++){var k=l[g].up();if(k.tagName!=="OBJECT"){this.buildPlayer(l[g],1)}}}}}},destroyDOM:function(){if(this.newsContentRegion){this.newsContentRegion=null}},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},buildPlayer:function(m,l){if(m){var k;this._height=375;if(l===0){var g=m.getElementsByTagName("embed");if(g[0]){k=g[0].readAttribute("src");this._height=g[0].getHeight();if(k.search("vid")>-1){this.buildHtml(m,k)}}else{g=m.getElementsByTagName("param");var j=g.length;for(var h=0;h<j;h++){k=g[h].value;if(k.search("vid")>-1){this.buildHtml(m,k)}}}}else{k=m.readAttribute("src");if(k.search("vid")>-1){this.buildHtml(m,k,true)}}}},buildHtml:function(h,l,j){var k=l.toQueryParams(),m=k.vid,g=h.getWidth();if(m){this.server.getVideoInfo(m,function(b){if(b&&b.value&&b.value.mp4URL){if(j){var a=h.up();var c=Builder.build('<video width="'+g+'" height="'+this._height+'" x-webkit-airplay="allow" controls="true" preload="none" src="'+b.value.mp4URL+'"></video>');a.insertBefore(c,h);h.remove()}else{h.innerHTML='<video width="'+g+'" height="'+this._height+'" x-webkit-airplay="allow" controls="true" preload="none" src="'+b.value.mp4URL+'"></video>'}}}.bind(this))}},browserRedirect:function(){var m=navigator.userAgent.toLowerCase();var h=m.match(/ipad/i)=="ipad";var j=m.match(/iphone/i)=="iphone";var k=m.match(/iphone/i)=="ipod";var g=m.match(/android/i)=="android";var l=m.match(/windows mobile/i)=="windows mobile";if(h||j||k||g||l){return true}return false},close:function(){this.destroyEvent();this.destroyDOM()}});var noHomeUrlAvatarHTML='<img class="box auto" height="48" width="48" alt="" onerror="this.onerror=null;this.src=\'{1}\';" src="{1}"/><p class="tc">{0}</p>';var commentBodySize=4000;var ShowBlogClient=Mtime.Page.ShowBlogClient;ShowBlogClient=Class.create();Object.extend(ShowBlogClient.prototype,{name:"ShowBlogClient",pageIndex:1,returnUrl:"",isOwner:false,isLogin:false,userString:"",blogId:0,bloggerId:0,avatarHTML:"",userSign:"",anonymousAvatar:"",pageSize:10,totalCount:0,hasFavorited:false,vcode:"",vcodeId:"",server:{deleteBlog:function(f,g,j,k,h){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","DeleteBlog",[f,g,j,k],h,applicationUrl+"/service/blog.mb","get","20000")},getCommentListHTML:function(e,f,h,g){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetCommentListHTML",[e,f,h],g,applicationUrl+"/service/blog.mb","get","20000")},refreshVcode:function(b){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","RefreshVcode",[],b,applicationUrl+"/service/blog.mb","get","20000")},deleteBlogComment:function(f,h,g,k,j){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","DeleteBlogComment",[f,h,g,k],j,applicationUrl+"/service/blog.mb","get","20000")},editBlogComment:function(l,k,p,j,m,o,q,n){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","EditBlogComment",[l,k,p,j,m,o],n,applicationUrl+"/service/blog.mb","post","20000",q)},createLoginedUserComment:function(q,p,x,s,v,r,y,z,w,B,C,u,A,t){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","CreateLoginedUserComment",[q,p,x,s,v,r,y,z,w,B,C,u],t,applicationUrl+"/service/blog.mb","post","20000",A)},createNotLoginedUserComment:function(r,q,w,p,t,C,v,y,s,z,A,x,B,u){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","CreateNotLoginedUserComment",[r,q,w,p,t,C,v,y,s,z,A,x],u,applicationUrl+"/service/blog.mb","post","20000",B)},getBlogVoteHtml:function(f,e,h,g){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetBlogVoteHtml",[f,e,h],g,applicationUrl+"/service/blog.mb","post","20000")},addUserVote:function(h,o,k,l,n,m,j){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","AddUserVote",[h,o,k,l,n],j,applicationUrl+"/service/blog.mb","post","20000",m)},getVoteDetail:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetVoteDetail",[d],c,applicationUrl+"/service/blog.mb","post","20000")},getBlogRecommendGroupHTML:function(d,f,e){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.GroupService","GetBlogRecommendGroupList",[d,f],e,applicationUrl+"/service/group.mb","get","20000")},getHiddenBlog:function(h,j,m,l,g,k){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetHiddenBlog",[h,j,m,l,g],k,applicationUrl+"/service/blog.mb","get","20000")}},initialize:function(){this.initializeServerData();this.initializeDOM();this.initializeEvent();this.initializeControl();this.load()},initializeField:function(){},initializeServerData:function(){this.pageIndex=showBlogVariables.pageIndex;this.pageSize=showBlogVariables.pageSize;this.returnUrl=showBlogVariables.returnUrl;this.blogId=showBlogVariables.blogId;this.bloggerId=blogVariables.ownerId;this.isOwner=this.bloggerId==blogVariables.visitorId;this.isLogin=blogVariables.isLogin;this.nickName=blogVariables.ownerNickname;this.userString=blogVariables.ownerName;this.anonymousAvatar=showBlogVariables.anonymousAvatar;this.articlePageIndex=showBlogVariables.articlePageIndex;this.signInUrl=blogVariables.signInUrl;this.signUpUrl=blogVariables.signUpUrl;this.blogTitle=blogInfoVariables.blogTitle;this.allowComment=blogInfoVariables.allowComment;this.blogType=blogInfoVariables.blogType;this.relatedId=blogInfoVariables.relatedId;this.relatedObjType=blogInfoVariables.relatedObjType;this.showBody=blogInfoVariables.showBody},initializeDOM:function(){this.blogActionRegion=$("blogActionRegion");this.blogInfoRegion=$("blogInfoRegion");this.positionNavRegion=$("positionNavRegion");this.groupRegion=$("groupRegion")},initializeDOMLazy:function(){this.commentListRegion=$("commentListRegion");this.replyMainEditRegion=$("replyMainEditRegion");this.pagerRegion=$("pagerRegion");this.blogVoteDetailRegion=$("blogVoteDetailRegion");this.favoriteButton=$("favoriteButton");this.favoriteCount=$("favoriteCount");this.totalComments=$("totalComments");this.viewCount=$("viewCount");this.shareButton=$("shareButton");this.shareButtonSplit=$("shareButtonSplit")},destroyDOM:function(){this.blogActionRegion=null;this.blogInfoRegion=null;this.commentBodyRegion=null;this.commentListRegion=null;this.replyMainEditRegion=null;this.blogVoteDetailRegion=null;this.favoriteButton=null;this.favoriteCount=null;this.shareButton=null;this.positionNavRegion=null;this.pagerRegion=null;this.groupRegion=null},initializeEvent:function(){if(this.blogActionRegion){this.onClickBlogActionRegionHandler=this.onClickBlogActionRegion.bindAsEventListener(this);this.blogActionRegion.observe("click",this.onClickBlogActionRegionHandler)}if(this.blogInfoRegion){this.onClickBlogInfoRegionHandler=this.onClickBlogInfoRegion.bindAsEventListener(this);this.blogInfoRegion.observe("click",this.onClickBlogInfoRegionHandler)}if(this.commentListRegion){this.onClickCommentListRegionHandler=this.onClickCommentListRegion.bindAsEventListener(this);this.commentListRegion.observe("click",this.onClickCommentListRegionHandler)}if(this.replyMainEditRegion){this.onClickReplyMainEditRegionHandler=this.onClickReplyMainEditRegion.bindAsEventListener(this);this.replyMainEditRegion.observe("click",this.onClickReplyMainEditRegionHandler)}if(this.blogVoteDetailRegion){this.onClickBlogVoteDetailRegionHandler=this.onClickBlogVoteDetailRegion.bindAsEventListener(this);this.blogVoteDetailRegion.observe("click",this.onClickBlogVoteDetailRegionHandler)}},initializeEventLazy:function(){if(this.commentListRegion){this.onClickCommentListRegionHandler=this.onClickCommentListRegion.bindAsEventListener(this);this.commentListRegion.observe("click",this.onClickCommentListRegionHandler)}if(this.replyMainEditRegion){this.onClickReplyMainEditRegionHandler=this.onClickReplyMainEditRegion.bindAsEventListener(this);this.replyMainEditRegion.observe("click",this.onClickReplyMainEditRegionHandler)}if(this.blogVoteDetailRegion){this.onClickBlogVoteDetailRegionHandler=this.onClickBlogVoteDetailRegion.bindAsEventListener(this);this.blogVoteDetailRegion.observe("click",this.onClickBlogVoteDetailRegionHandler)}},destroyEvent:function(){if(this.blogActionRegion){this.blogActionRegion.stopObserving("click",this.onClickBlogActionRegionHandler)}if(this.blogInfoRegion){this.blogInfoRegion.stopObserving("click",this.onClickBlogInfoRegionHandler)}if(this.commentListRegion){this.commentListRegion.stopObserving("click",this.onClickCommentListRegionHandler)}if(this.replyMainEditRegion){this.replyMainEditRegion.stopObserving("click",this.onClickReplyMainEditRegionHandler);this.replyMainEditRegion.stopObserving("focus",this.onFocusReplyMainEditRegionHandler)}if(this.vcodeInput){this.vcodeInput.stopObserving("focus",this.onFocusReplyMainEditRegionHandler)}if(this.blogVoteDetailRegion){this.blogVoteDetailRegion.stopObserving("click",this.onClickBlogVoteDetailRegionHandler)}},initializeControl:function(){UsersAvatars.register("favoriteUserList");$loadJs(["/js/2011/weibo/Card.js","/js/2011/weibo/Follow.js"],function(){if($("commentListRegion")){this.card1=new Card({mytimeContentRegion:"commentListRegion"})}if($("favoriteUserList")){this.card2=new Card({mytimeContentRegion:"favoriteUserList"})}});if($("right_content")){this.swfToMp4=new SwfToMp4Video({contentRegion:"right_content"})}},destroyControl:function(){if(this.commentHtmlEditorMain){this.commentHtmlEditorMain.close()}if(this.commentBodyRegion){this.commentBodyRegion.innerHTML="";this.commentBodyRegion=null}if(this.favoriteControl){this.favoriteControl.close();this.favoriteControl=null}if(this.shareBlogControl){this.shareBlogControl.close();this.shareBlogControl=null}if(this.swfToMp4){this.swfToMp4.close();this.swfToMp4=null}},load:function(){this.isTouchPad=isTouchPad;stat.viewBlog(this.blogId);this.setPostionHTML();if(this.groupRegion){var b=this.groupRegion.readAttribute("group");if(b&&b.length>0){this.server.getBlogRecommendGroupHTML(this.blogId,b,function(a){if(a&&a.value&&a.value.html){this.groupRegion.innerHTML=a.value.html}}.bind(this))}}this.showBlogOnwerAction();if(!this.showBody){this.getHiddenBlogContent()}else{this.initalizeLazy()}},showBlogOnwerAction:function(){if(this.isOwner){var b=this.blogActionRegion.down("span.mt_text");if(b){b.removeClassName("none")}this.blogInfoRegion.removeClassName("hiddenedit")}},getHiddenBlogContent:function(){this.server.getHiddenBlog(this.bloggerId,this.blogId,this.userString,this.nickName,this.articlePageIndex,function(d){if(d&&d.value){if(d.value.showBody){var c='<p class="line_dot mt9 mb9"></p><a name="Comments"></a><div id="commentListRegion"></div><div id="pagerRegion"></div><div class="module_area"><div id="replyMainEditRegion" class="restore"></div></div>';this.blogInfoRegion.down("div.hiddenBlog").innerHTML=d.value.html;this.blogInfoRegion.down("div.hiddenComment").innerHTML=c}else{this.blogInfoRegion.down("div.mt20").innerHTML=d.value.html}}this.initalizeLazy()}.bind(this))},initializeControlsLazy:function(){if(this.favoriteButton){this.favoriteControl=new Favorite({id:this.blogId,type:6,isLogin:this.isLogin,signInUrl:this.signInUrl,favoriteButton:this.favoriteButton,hasFavorite:this.hasFavorited,isModifyFavoriteButton:false,okCallback:function(d){this.hasFavorited=d;if(!this.hasFavorited){var c=parseInt(this.favoriteCount.innerHTML,10);this.favoriteCount.innerHTML=c+1}}.bind(this)})}if(this.replyMainEditRegion){this.getDefaultCommentHtml()}UsersAvatars.register("right_content");if(this.shareButton&&!this.isOwner){this.shareBlogControl=new ShareBlogControl({blogId:this.blogId,shareButton:this.shareButton})}},initalizeLazy:function(){this.initializeDOMLazy();this.initializeControlsLazy();this.initializeEventLazy();this.loadLazy()},loadLazy:function(){if(this.blogInfoRegion){new HTMLObject({container:this.blogInfoRegion})}this.getBlogVoteHtml();if(this.isOwner&&this.shareButtonSplit){this.shareButtonSplit.hide()}if(this.commentListRegion){this.getCommentListHtml()}if(this.pagerRegion){this.pager=new Pager({pageRegionId:"pagerRegion",pageSize:this.pageSize,totalRecord:this.totalCount,callback:function(c,d){this.pageIndex=c;this.getCommentListHtml(d)}.bind(this)})}},setPostionHTML:function(){var e=applicationUrl+"/"+this.userString+"/blog/";var d=String.format('<a href="{0}" >日志</a>',e);var f=this.positionNavRegion.innerHTML;f=f.toLowerCase().replace("<span>日志</span>",d);f+=String.format("&gt;&gt;{0}",this.blogTitle);this.positionNavRegion.innerHTML=f},getCommentListHtml:function(b){this.server.getCommentListHTML(this.bloggerId,this.blogId,this.pageIndex,function(o){if(o&&o.value){this.totalCount=o.value.totalCount;var m=o.value.html;if(m!==""){this.commentListRegion.innerHTML=o.value.html;new HTMLObject({container:this.commentListRegion});if(b){b.scrollToTop(this.commentListRegion);stat.viewBlog(this.blogId)}if(this.commentBodyRegion){if(window.location.href.toLowerCase().include("#comments")){this.commentBodyRegion.scrollIntoView()}}if(this.commentListRegion){var n=window.location.href.toLowerCase();var l="#comment_";var a=0;if(n.include(l)){a=n.split(l)[1]}var k=this.commentListRegion.getElementsBySelector('div[commentid="'+a+'"]');if(k&&k.length>0){k[0].scrollIntoView()}}}else{this.commentListRegion.hide();this.pagerRegion.hide()}this.pager.render(this.pageIndex,this.totalCount);if(o.value.favoriteCount){this.favoriteCount.innerHTML=o.value.favoriteCount}if(o.value.viewCount){this.viewCount.innerHTML=o.value.viewCount}if(o.value.totalComments){var j=this.totalComments.down("a");if(j){j.innerHTML=o.value.totalComments}else{this.totalComments.innerHTML=String.format("({0})",o.value.totalComments)}}this.avatarHTML=o.value.avatarHTML;this.userSign=o.value.userSign}}.bind(this))},getDefaultCommentHtml:function(){if(this.allowComment!==0){if(this.isLogin){if(this.isTouchPad){this.replyMainEditRegion.innerHTML=this.getTouchPadCommentEditorHTML(this.isOwner,true);this.mainWaterMarkText=new Textbox({text:"mainWaterMarkText",watermarkText:"请输入你的留言",focusClassName:"c_000",blurClassName:"c_a5"})}else{this.replyMainEditRegion.innerHTML=this.getLoginCommentEditorHTML(this.isOwner,true,false);this.commentBodyRegion=$("commentBodyRegion");this.createCommentHtmlEditorMain(this.commentBodyRegion)}}else{if(this.allowComment===1){this.replyMainEditRegion.innerHTML=this.getNotLoginCommentEditorHTML(false);this.commentBodyRegion=$("commentBodyRegion");if(this.commentBodyRegion){this.createCommentHtmlEditorMain(this.commentBodyRegion)}this.vcodeInput=this.replyMainEditRegion.down("input.replyVcodeInput");if(this.vcodeInput){this.onFocusReplyMainEditRegionHandler=this.onFocusReplyMainEditRegion.bindAsEventListener(this);this.vcodeInput.observe("focus",this.onFocusReplyMainEditRegionHandler)}}else{this.replyMainEditRegion.innerHTML=String.format("要回复"+this.nickName+'，请先<a href="{0}" title="登录">登录</a>或<a href="{1}" title="注册">注册</a>',this.signInUrl,this.signUpUrl)}}}else{this.replyMainEditRegion.innerHTML="很抱歉，作者没有开放回复权限，无法回复。"}},getBlogVoteHtml:function(){if(this.blogVoteDetailRegion){this.server.getBlogVoteHtml(this.blogId,this.bloggerId,this.userString,function(b){this.blogVoteDetailRegion.innerHTML=b.value}.bind(this))}},onClickBlogVoteDetailRegion:function(p){var m=Event.element(p);if(m){var n=m.name;if(n&&n!==""){if(!this.isLogin){$alert(String.format('请先 <a href="{0}">登录</a> 后再进行此操作',this.signInUrl))}else{switch(n){case"blogVoteInput":var o=m.type;if(o=="checkbox"){var l=this.blogVoteDetailRegion.getElementsBySelector('input[type="checkbox"]');var s=l.findAll(function(a){return a.checked}).size();var u=parseInt(this.blogVoteDetailRegion.getElementsByClassName("voteMaxCount")[0].innerHTML,10);if(s<u){l.each(function(a){a.disabled=false})}else{l.each(function(a){if(!a.checked){a.disabled=true}})}}break;case"blogVoteSubmit":var t=m.readAttribute("voteid");var r=this.blogVoteDetailRegion.getElementsBySelector('input[name="blogVoteInput"]');var q=r.findAll(function(a){return a.checked}).pluck("value").join("|");if(q!==""){this.server.addUserVote(this.blogId,t,q,this.isOwner,this.userString,m,function(a){if(a&&a.value&&a.value.success){this.blogVoteDetailRegion.innerHTML=a.value.voteHTML}else{$alert("话题投票失败")}}.bind(this))}else{$alert("请选择投票项目")}break;default:break}}}}},createCommentHtmlEditorMain:function(b){$loadJs("/js/editor.js",function(){this.commentHtmlEditorMain=new Editor({container:b,height:150,value:"",configName:"reply",addBottomButton:false})}.bind(this))},createCommentHtmlEditorReply:function(c,d){$loadJs("/js/editor.js",function(){this.commentHtmlEditorReply=new Editor({container:c,height:this.isOwner?215:150,value:d,configName:"reply",addBottomButton:false})}.bind(this))},getRadioObject:function(c){var d={OpinionId:0,SpanClass:"",Title:""};if(c){c.getElementsBySelector("li").each(function(a){var b=a.getElementsBySelector('input[type="radio"]');if(b[0].checked){d.OpinionId=b[0].value;var e=a.getElementsBySelector("span");d.SpanClass=e[0].className;d.Title=e[0].title}})}return d},setRadioValue:function(c,d){if(c){c.getElementsBySelector('input[type="radio"]').each(function(a){if(a.value==d){a.checked=true}})}},initRadioValue:function(b){if(b){b.getElementsBySelector('input[type="radio"]').each(function(a){a.checked=false})}},onClickBlogActionRegion:function(e){var d=Event.element(e);if(d){var f=d.readAttribute("method");if(f&&f!==""){switch(f){case"write":manager.show("写日志","写日志");break;case"comment":manager.show("写日志","写影评");break;case"manage":manager.show("写日志","管理日志");break;default:break}}}},onClickBlogInfoRegion:function(n){var m=Event.element(n);if(m){var o=m.readAttribute("method");var k=m.readAttribute("blogid");if(o&&o!==""){switch(o){case"edit":if(k&&k!==""){manager.show("写日志","编辑日志","?blogId="+k)}break;case"delete":var l=m.readAttribute("blogtype");var p=m.readAttribute("relatedid");var q=m.readAttribute("relatedobjid");if(k&&k!==""){new DialogBox({content:Builder.node("p",{className:"bold"},["你确定要删除吗？"]),element:m,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(a){this.server.deleteBlog(k,l,p,q,function(b){if(b&&b.value){location=this.returnUrl}else{$alert("删除失败, 请稍后重试！")}}.bind(this));a.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(a){if(this.cancelCallback){this.cancelCallback(a)}a.close()}.bind(this)}]})}break;case"reply":if(this.commentHtmlEditorMain){this.commentHtmlEditorMain.gotoView()}else{var r=this.replyMainEditRegion.getElementsBySelector("textarea")[0];if(r){this.replyMainEditRegion.scrollIntoView();r.focus()}}break;case"votelist":var s=m.readAttribute("voteid");this.server.getVoteDetail(s,function(a){if(a&&a.value){new Dialog({windowStyle:"width: 400px;",title:"投票详情",content:Builder.build(a.value.html),containerClassName:"pl12 pr12 pb12 tc",buttonRegionClass:"mt12 tc",element:m,buttons:[{title:"确定",buttonStyle:"btn_square_hover mr12",callback:function(b){b.close()}.bind(this)}]})}}.bind(this));break;default:break}}}},onClickCommentListRegion:function(u){var o=Event.element(u);if(o){var x=o.readAttribute("method");if(x&&x!==""){var p=o.up("div.commentInfo");var q=parseInt(o.readAttribute("commentid"),10);var y=parseInt(o.readAttribute("parentid"),10);if(p){switch(x){case"delete":new DialogBox({content:Builder.node("p",{className:"bold"},["你确定要删除该回复吗？"]),element:o,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(a){this.server.deleteBlogComment(q,this.blogId,this.bloggerId,y,function(f){if(f&&f.value){if(y===0){if(p.next()){p.next().remove()}p.remove();var c=this.commentListRegion.getElementsByClassName("commentInfo").length;if(this.pageIndex>1&&c===0){this.pageIndex--}this.getCommentListHtml()}else{var e=o.up("div.replyInfo");if(e){e.remove();var d=p.getElementsByClassName("replyInfo").length>0;if(!d){var b=p.getElementsByClassName("member_air")[0];if(b){b.remove()}}}}}else{$alert("删除失败, 请稍后重试！")}}.bind(this));a.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(a){if(this.cancelCallback){this.cancelCallback(a)}a.close()}.bind(this)}]});break;case"reply":var z={Action:"reply",CommentDiv:p,ClickElement:o,CommentId:q,ParentId:y};switch(this.allowComment){case 0:$alert("很抱歉，作者没有开放回复权限，无法回复。");break;case 1:this.preCloseDialog();this.showReplyDialog(z);break;case 2:if(!this.isLogin){$alert(String.format("要回复"+this.nickName+'，请先<a href="{0}" title="登录">登录</a>或<a href="{1}" title="注册">注册</a>',this.signInUrl,this.signUpUrl))}else{this.preCloseDialog();this.showReplyDialog(z)}break}break;case"edit":this.preCloseDialog();var w=y!==0;var s;var r;var z={Action:"",CommentDiv:p,ClickElement:o,CommentId:q,ContentRegion:null,ParentId:y,OpinionId:0,EditBody:""};if(w){var A=o.up("div.replyInfo");r=A.getElementsByClassName("editRegion")[0];z.Action="simpleEdit"}else{r=p.getElementsByClassName("editRegion")[0];z.OpinionId=o.readAttribute("opinionid");z.Action="edit"}var t=r.down("div");if(t){s=t.innerHTML}else{s=r.innerHTML}z.EditBody=s;z.ContentRegion=r;var v=(w||this.isTouchPad)?"":' style="height:265px;"';this.showEditDialog(String.format("<div{1}>{0}</div>",this.getCommentEditorHTML(this.isOwner,w),v),z);break;default:break}}}}},preCloseDialog:function(){if(this.replyDialogBox){this.replyDialogBox.close()}if(this.editDialogBox){this.editDialogBox.close()}},showEditDialog:function(c,d){this.createEditDialog(c,d)},createEditDialog:function(c,d){this.editDialogBox=this.createCommonDialog(c,d,this.onSubmitEditCallback,this.onEditDialogReady,this.onEditDialogClose)},onEditDialogReady:function(d){var e=d.dialogProcessObj.EditBody;if(d.dialogProcessObj.Action==="simpleEdit"){this.replyText=d.getEl("replyText");this.replyText.value=e.replace(/<(br|BR)\/?>/g,"\n")}else{if(!this.isTouchPad){this.commentBodyReplyRegion=d.getEl("commentBodyReplyRegion");this.createCommentHtmlEditorReply(this.commentBodyReplyRegion,e)}else{this.replyText=d.getEl("replyText");this.replyText.value=e.replace(/<(br|BR)\/?>/g,"\n")}this.opinionReplyRadioRegion=d.getEl("opinionReplyRadioRegion");var f=d.dialogProcessObj.OpinionId;this.setRadioValue(this.opinionReplyRadioRegion,f)}this.replyHint=d.getEl("replyHint")},onEditDialogClose:function(c,d){if(c.dialogProcessObj.Action==="simpleEdit"){this.replyText=null}else{this.commentBodyReplyRegion=null;if(this.commentHtmlEditorReply){this.commentHtmlEditorReply.close();this.commentHtmlEditorReply=null}this.opinionReplyRadioRegion=null}if(this.replyHint){this.replyHint=null}},onSubmitEditCallback:function(m,j,q){var o=m.dialogProcessObj;var k=o.CommentDiv;var l=o.ContentRegion;var p={OpinionId:0,SpanClass:"",Title:""};if(o.Action==="simpleEdit"){var n=this.replyText.value.Trim()}else{if(this.isTouchPad){var n=this.replyText.value.Trim()}else{var n=this.commentHtmlEditorReply.getValue()}if(this.opinionReplyRadioRegion){p=this.getRadioObject(this.opinionReplyRadioRegion)}}if(this.commentHtmlEditorReply&&this.commentHtmlEditorReply.isEmpty()||n.length===0){this.replyHint.show();this.replyHint.innerHTML="请输入回复内容";return}this.server.editBlogComment(this.blogId,this.bloggerId,o.ParentId,o.CommentId,n,p.OpinionId,j,function(e){if(e&&e.value&&e.value.errorString.length===0){if(e.value.editbody){n=e.value.editbody}if(o.Action=="simpleEdit"){l.innerHTML=String.format("<div>{0}</div>",n)}else{var b=k.getElementsByClassName("replyOpinion")[0];if(b){var c=b.getElementsBySelector("span")[0];var d=b.getElementsBySelector("span")[1]}if(b&&c&&d){c.className=p.SpanClass;d.innerHTML=p.Title}else{if(p.OpinionId>0&&b){b.innerHTML=String.format('<span class="{0}" title="{1}">&nbsp;</span><span class="bold">{1}</span>',p.SpanClass,p.Title)}}var a=k.getElementsByClassName("fr")[0];if(a){a.setAttribute("opinionid",p.OpinionId)}l.innerHTML=String.format("<div>{0}</div>",n)}if(this.commentHtmlEditorReply){this.commentHtmlEditorReply=null}m.close()}else{this.replyHint.show();this.replyHint.innerHTML=e.value.errorString}}.bind(this))},showReplyDialog:function(d){var c=String.format("<div>{0}</div>",this.getCommentEditorHTML(this.isOwner,true));this.createReplyDialog(c,d)},createCommonDialog:function(h,j,f,k,g){return new ReplyDialogBox({width:"500px",content:h,element:j.ClickElement,buttons:[{title:"写好了",buttonStyle:"btn_blue mr9",callback:f.bind(this)},{title:"取消",buttonStyle:"btn_gray",onmouseover:"this.className='btn_blue'",onmouseout:"this.className='btn_gray'",callback:function(a){a.close()}.bind(this)}],dialogProcessObj:j,readyCallback:k.bind(this),closeCallback:g.bind(this),isAutoClose:false})},createReplyDialog:function(c,d){this.replyDialogBox=this.createCommonDialog(c,d,this.onSubmitReplyCallback,this.onReplyDialogReady,this.onReplyDialogClose)},onReplyDialogReady:function(b){this.replyText=b.getEl("replyText");this.replyText.focus();this.replyRefresh=b.getEl("replyRefresh");if(this.replyRefresh){this.onClickReplyRefreshHandler=this.onClickReplyRefresh.bindAsEventListener(this);this.replyRefresh.observe("click",this.onClickReplyRefreshHandler)}this.vcodeSpan=b.getEl("vcodeSpan");this.replyName=b.getEl("replyName");this.replyUrl=b.getEl("replyUrl");this.replyVcode=b.getEl("replyVcode");if(this.replyVcode){this.onFocusReplyVcodeHandler=this.onFocusReplyVcode.bindAsEventListener(this);this.replyVcode.observe("focus",this.onFocusReplyVcodeHandler)}this.replyHint=b.getEl("replyHint")},onReplyDialogClose:function(c,d){this.replyText=null;if(this.replyRefresh){this.replyRefresh.stopObserving("click",this.onClickReplyRefreshHandler);this.replyRefresh=null}if(this.vcodeSpan){this.vcodeSpan=null}if(this.replyName){this.replyName=null}if(this.replyUrl){this.replyUrl=null}if(this.replyVcode){this.replyVcode.stopObserving("focus",this.onFocusReplyVcodeHandler);this.replyVcode=null}if(this.replyHint){this.replyHint=null}},onClickReplyRefresh:function(){if(this.vcodeSpan){var b=this.vcodeSpan.down("span").down("img");if(b){this.refreshVcode(b,function(){})}}},onFocusReplyVcode:function(f){var e=Event.element(f);if(e){var g=e.readAttribute("method");if(g&&g!==""){switch(g){case"showCode":var h=e.next();if(!h.visible()){this.genRefreshVcode(h,true)}break;default:break}}}},onSubmitReplyCallback:function(t,r,z){var u=this.replyText.value.Trim();var p=false;if(this.replyName){p=true;var x=this.replyName.value.Trim();var q=this.replyUrl.value.Trim();var C=this.replyVcode.value.Trim();var B=Element.extend(this.vcodeSpan.down("span").down("img")).readAttribute("vcodeid")}var w=this.validateInput(p,x,u,C);var y=t.dialogProcessObj;var s=y.CommentDiv;var A=y.CommentId;var v=s.getElementsByClassName("member_air").length>0;if(w===""){if(!p){this.server.createLoginedUserComment(this.blogId,this.bloggerId,A,u,0,this.blogType,this.relatedId,this.relatedObjType,this.pageIndex,this.vcode,this.vcodeId,false,r,function(c){if(c&&c.value){if(c.value.commentId&&c.value.commentId>0){if(this.vcodeDialog){this.vcodeDialog.close()}this.vcodeSrc="";this.vcodeId="";if(c.value.editbody){u=c.value.editbody}this.createReplyHTML(s,t,c.value.commentId,A,u,this.avatarHTML,v)}else{var b=c.value.isRobot;var a=c.value.errorString;if(b){if(c.value.vcodeSrc&&c.value.vcodeId){this.vcodeSrc=c.value.vcodeSrc;this.vcodeId=c.value.vcodeId;this.showValidDialog(true,null,r,z,t)}else{if(this.vcodeDialog){var d=this.vcodeDialog.getEl("tip");if(d){d.innerHTML=a}}}}else{replyHint.show();replyHint.innerHTML=a}}}}.bind(this))}else{this.server.createNotLoginedUserComment(this.blogId,this.bloggerId,x,q,u,C,B,A,this.blogType,this.relatedId,this.relatedObjType,this.pageIndex,r,function(b){if(b&&b.value&&b.value.errorString.length===0){if(q.Trim().toLowerCase()==="http://"||q.Trim()===""){var a=String.format(noHomeUrlAvatarHTML,x,this.anonymousAvatar)}else{var a=String.format(this.avatarHTML,x,q)}this.createReplyHTML(s,t,b.value.commentId,A,u,a,v)}else{this.replyHint.show();this.replyHint.innerHTML=b.value.errorString}}.bind(this))}}else{this.replyHint.show();this.replyHint.innerHTML=w}},validateInput:function(f,j,g,k){var h="";if(f&&j.length===0){h+="请输入昵称<br>"}if(g.length===0){h+="请输入回复内容<br>"}if(g.bytelength()>commentBodySize){h+="回复内容最多为2000个汉字"}if(f&&k===""){h+="请输入验证码"}return h},createReplyHTML:function(l,n,m,s,o,k,p){var q=this.handleOnclick(this.renderReplyInfo(m,s,o,k,p));if(p){var r=l.getElementsByClassName("ma_body")[0];if(r){r.appendChild(q)}}else{l.appendChild(q)}n.close()},onClickReplyMainEditRegion:function(w){var s=Event.element(w);if(s){var A=s.readAttribute("method");if(A&&A!==""){switch(A){case"submit":var t=this.replyMainEditRegion;var B="";var r="";var E="";var q=false;if(t.getElementsByClassName("replyNameInput")[0]){B=t.getElementsByClassName("replyNameInput")[0].value;r=t.getElementsByClassName("replyBlogInput")[0].value;E=t.getElementsByClassName("replyVcodeInput")[0].value;vcodeid=t.getElementsByClassName("vcodeImage")[0].readAttribute("vcodeid");q=true}var v="";if(q){v=t.getElementsByClassName("replyCommentInput")[0].value}else{if(this.isTouchPad){v=t.getElementsByClassName("replyCommentInput")[0].value}else{v=this.commentHtmlEditorMain.getValue()}}var y=this.validateInput(q,B,v,E);var D=t.getElementsByClassName("replyHint")[0];if(y===""){if(!q){var C={OpinionId:0,SpanClass:"",Title:""};var u=t.getElementsByClassName("commentRadioRegion")[0];if(u){C=this.getRadioObject(u)}var x=t.down("input.forwardtweet");var z=x?x.checked:false;this.server.createLoginedUserComment(this.blogId,this.bloggerId,0,v,C.OpinionId,this.blogType,this.relatedId,this.relatedObjType,this.pageIndex,this.vcode,this.vcodeId,z,s,function(c){if(c&&c.value){if(c.value.commentId&&c.value.commentId>0){if(this.vcodeDialog){this.vcodeDialog.close()}this.vcodeSrc="";this.vcodeId="";if(c.value.editbody){v=c.value.editbody}this.commentListRegion.appendChild(this.handleOnclick(this.renderCommentInfo(c.value.commentId,0,v,C.OpinionId,C.SpanClass,C.Title,this.avatarHTML)));this.commentListRegion.show();if(this.isTouchPad){t.getElementsByClassName("replyCommentInput")[0].value=""}else{this.commentHtmlEditorMain.setValue("")}if(u&&C.OpinionId>0){this.initRadioValue(u)}D.hide()}else{var b=c.value.isRobot;var a=c.value.errorString;if(b){if(c.value.vcodeSrc&&c.value.vcodeId){this.vcodeSrc=c.value.vcodeSrc;this.vcodeId=c.value.vcodeId;this.showValidDialog(false,w)}else{if(this.vcodeDialog){var d=this.vcodeDialog.getEl("tip");if(d){d.innerHTML=a}}}}else{D.show();D.innerHTML=a}}}}.bind(this))}else{this.server.createNotLoginedUserComment(this.blogId,this.bloggerId,B,r,v,E,vcodeid,0,this.blogType,this.relatedId,this.relatedObjType,this.pageIndex,s,function(b){if(b&&b.value&&b.value.errorString.length===0){if(r.Trim().toLowerCase()==="http://"||r.Trim()===""){var a=String.format(noHomeUrlAvatarHTML,B,this.anonymousAvatar)}else{var a=String.format(this.avatarHTML,B,r)}this.commentListRegion.show();this.commentListRegion.appendChild(this.handleOnclick(this.renderCommentInfo(b.value.commentId,0,v,0,"","",a)));t.getElementsByClassName("replyNameInput")[0].value="匿名";t.getElementsByClassName("replyBlogInput")[0].value="http://";t.getElementsByClassName("replyCommentInput")[0].value="";t.getElementsByClassName("replyVcodeInput")[0].value="";t.getElementsByClassName("replyVcodeInput")[0].next().hide();D.hide()}else{D.show();D.innerHTML=b.value.errorString}}.bind(this))}}else{D.show();D.innerHTML=y}break;case"refreshCode":this.refreshVcode(this.replyMainEditRegion.getElementsByClassName("vcodeImage")[0]);break;default:break}}}},showValidDialog:function(h,g,f,j,k){this.vcodeDialog=new Dialog({windowClassName:"w445",content:Builder.node("div",{className:"ml20 mr20"},[Builder.node("h3",{id:"tip"},["抱歉，连续回复次数过多，为了证明你不是机器人，请输入验证码后继续"]),Builder.node("p",{className:"mt10"},[Builder.node("input",{id:"vcodeText",type:"text",className:"w120"}),Builder.node("img",{id:"vcodeImage",src:""+this.vcodeSrc+"",alt:"验证码",className:"v_m mlr10"}),Builder.node("a",{href:"#",id:"changeVcodeLink",onclick:"return false;"},["看不清楚？换一张"])])]),buttonRegionClass:"mt10 pb15 ml20",buttons:[{title:"确定",buttonStyle:"btn_square_hover mr15",callback:function(a){var b=a.getEl("vcodeText").value;if(b.length>0){this.vcode=b;if(h){this.onSubmitReplyCallback(k,f,j)}else{this.onClickReplyMainEditRegion(g)}}}.bind(this)}],readyCallback:this.onShowValidDialogReady.bind(this),closeCallback:this.onShowValidDialogClose.bind(this)})},onShowValidDialogReady:function(b){this.changeVcodeLink=b.getEl("changeVcodeLink");this.vcodeImage=b.getEl("vcodeImage");this.onClickChangeVcodeLinkHandler=this.changeVcode.bind(this);this.changeVcodeLink.observe("click",this.onClickChangeVcodeLinkHandler)},changeVcode:function(){this.server.refreshVcode(function(b){if(b&&b.value){this.vcodeId=b.value.id;this.vcodeSrc=b.value.src;this.vcodeImage.src=this.vcodeSrc}}.bind(this))},onShowValidDialogClose:function(){this.changeVcodeLink.stopObserving("click",this.onClickChangeVcodeLinkHandler);this.changeVcodeLink=null;this.vcodeImage=null},onFocusReplyMainEditRegion:function(f){var e=Event.element(f);if(e){var g=e.readAttribute("method");if(g&&g!==""){switch(g){case"showCode":var h=e.next();if(!h.visible()){this.genRefreshVcode(h,false)}break;default:break}}}},genRefreshVcode:function(d,c){this.server.refreshVcode(function(a){if(a&&a.value){var b=d.down("span");b.innerHTML=String.format('<img {0} title="VcodeImg" alt="VcodeImg" src="{1}" vcodeid="{2}" class="mlr10 v_m vcodeImage">',c?'id="replyVcodeImg"':"",a.value.src,a.value.id);d.show()}}.bind(this))},refreshVcode:function(d,c){this.server.refreshVcode(function(a){if(a&&a.value){d.setAttribute("vcodeid",a.value.id);d.setAttribute("src",a.value.src);if(c){c()}}}.bind(this))},getCommentEditorHTML:function(e,f){var d="";if(this.isLogin){if(this.isTouchPad&&!f){d=this.getTouchPadCommentEditorHTML(e,false)}else{d=this.getLoginCommentEditorHTML(e,false,f)}}else{d=String.format("<div>{0}</div>",this.getNotLoginCommentEditorHTML(true))}return d},getLoginCommentEditorHTML:function(j,h,k){var g=h?"":'id="replyText"';var f=new StringBuilder();if(k){f.append(String.format('<textarea {0} class="txt_blue replyCommentInput" rows="6"></textarea>',g));f.append(String.format('<p {0} style="display:none;color:Red;" class="replyHint mt9"></p>',h?"":'id="replyHint"'))}else{if(!j){f.append('<div class="restore clearfix">');f.append(this.getOpinionHtml(0,h));f.append("</div>")}f.append(String.format('<div id="commentBody{0}Region" class="commentEditorRegion"></div>',!h?"Reply":""));f.append(String.format('<p {0} style="display:none;color:Red;" class="replyHint mt9"></p>',h?"":'id="replyHint"'))}if(h){f.append('<div class="mt9">');if(this.showBody){f.append('<input method="submit" class="btn_blue" type="button" value="写好了"/>&nbsp;&nbsp;<input type="checkbox" class="forwardtweet" />同时转发到我的微评')}else{f.append('<input method="submit" class="btn_blue" type="button" value="写好了"/>')}f.append("</div>")}return f.toString()},getNotLoginCommentEditorHTML:function(d){var c=new StringBuilder();c.append(String.format('<h4>昵称：</h4><p><input {0} size="40" value="匿名" class="txt_blue replyNameInput" type="text"></p>',d?'id="replyName"':""));c.append(String.format('<h4 class="mt9" style="display:none;">你的博客地址：</h4><p style="display:none;"><input {0} size="40" value="http://" class="txt_blue replyBlogInput" type="text" autocomplete="off" ></p>',d?'id="replyUrl"':""));c.append(String.format('<h4 class="mt9">回复内容：</h4><textarea {0} class="txt_blue replyCommentInput" rows="6"></textarea><h4 class="mt9">验证码：</h4><p>',d?'id="replyText"':""));c.append(String.format('<input {0} class="txt_blue replyVcodeInput" type="text" autocomplete="off" method="showCode" >',d?'id="replyVcode"':""));c.append('<span style="display:none" id="vcodeSpan"><span></span>');c.append(String.format('<a {0} class="ml9" title="刷新换一张" onclick="return false;" href="#" method="refreshCode">刷新</a></span></p>',d?'id="replyRefresh"':""));c.append(String.format('<p {0} style="display:none;color:Red;" class="replyHint mt9"></p>',d?'id="replyHint"':""));if(!d){c.append('<div class="mt9">');c.append('<input method="submit" class="btn_blue" type="button" value="写好了"/>');c.append("</div>")}return c.toString()},getTouchPadCommentEditorHTML:function(h,g){var f=g?"mainWaterMarkText":'id="replyWaterMarkText"';var e=new StringBuilder();if(!h){e.append('<div class="restore">');e.append(this.getOpinionHtml(0,g));e.append("</div>")}e.append(String.format('<textarea id="{0}" class="txt_blue replyCommentInput" rows="6"></textarea>',f));e.append(String.format('<p {0} style="display:none;color:Red;" class="replyHint mt9"></p>',g?"":'id="replyHint"'));if(g){e.append('<div class="mt9">');e.append('<input method="submit" class="btn_blue" type="button" value="写好了"/>');e.append("</div>")}return e.toString()},getOpinionHtml:function(q,p){var t='<ul id="opinion{1}RadioRegion" class="commentRadioRegion">{0}</ul>';var n='checked="checked"';var u='<li><input name="opinionRadio" value="{0}" type="radio" {1} /><span title="{3}" class="i-pr-{2} ele_inline_block mr6">&nbsp;</span><span>{3}</span></li>';var l=new StringBuilder();var s=["写的好","够专业","有想法","有个性"];var r=[6,7,8,9];for(i=0;i<r.length;i++){var m=q==r[i]?n:"";l.append(String.format(u,r[i],m,"0"+r[i],s[i]))}var o=!p?"Reply":"";return String.format(t,l.toString(),o)},renderCommentInfo:function(m,s,n,r,t,u,l){var o=Builder.node("div");o.innerHTML=n.replace(/\n/g,"<br/>");var p=Builder.node("a");if(this.isLogin){p=Builder.node("span",[Builder.node("a",{opinionid:r,parentid:s,commentid:m,method:"edit",href:"#",className:"fr"},["编辑"]),Builder.node("span",{className:"gray fr mlr5"},[" | "]),Builder.node("a",{parentid:s,commentid:m,method:"delete",href:"#",className:"fr"},["删除"])])}var q=Builder.node("span");if(r>0){q=Builder.node("span",{className:"replyOpinion"},[Builder.node("span",{title:u,className:t}),Builder.node("span",{className:"bold"},[u])])}else{q=Builder.node("span",{className:"replyOpinion"})}return Builder.node("div",{},[Builder.node("div",{className:"commentInfo"},[Builder.node("div",{className:"mt9"},[Builder.node("div",{className:"clearfix mb9"},[q,Builder.node("span",{className:"time"},[new Date().toString()]),p]),Builder.node("div",{className:"content_54"},[Builder.node("div",{className:"content"},[Builder.node("div",{className:"editRegion"},[o]),Builder.node("div",{className:"gray"},["--------------------",Builder.node("br"),this.userSign]),Builder.node("div",{className:"mt9"},[Builder.node("a",{title:"回复",parentid:s,commentid:m,method:"reply",href:"#"},["回复"])])])]),Builder.node("div",{className:"w_54"},[Builder.build(String.format("<div>{0}</div>",l))]),Builder.node("div",{className:"clear"})])]),Builder.node("p",{className:"line_dot mt9 mb9"},[])])},handleOnclick:function(d){if(d){var f=Element.extend(d);var e=f.getElementsBySelector("a");e.each(function(a){if(Prototype.Browser.IE){a.setAttribute("onclick",function(){return false})}else{a.setAttribute("onclick","return false;")}});return f}else{return Builder.node("div")}},renderReplyInfo:function(k,p,l,j,o){var m=Builder.node("div");m.innerHTML=l.replace(/\n/g,"<br/>");var n=Builder.node("a");if(this.isLogin){n=Builder.node("span",[Builder.node("a",{opinionid:"0",parentid:p,commentid:k,method:"edit",href:"#",className:"fr"},["编辑"]),Builder.node("span",{className:"gray fr mlr5"},[" | "]),Builder.node("a",{parentid:p,commentid:k,method:"delete",href:"#",className:"fr"},["删除"])])}var q=Builder.node("div",{className:"replyInfo"},[Builder.node("div",{className:"clearfix mb9"},[Builder.node("span",{className:"time"},[new Date().toString()]),n]),Builder.node("div",{className:"content_54"},[Builder.node("div",{className:"content"},[Builder.node("div",{className:"editRegion"},[m]),Builder.node("div",{className:"gray"},["--------------------",Builder.node("br"),this.userSign]),Builder.node("div",{className:"mt9"})])]),Builder.node("div",{className:"w_54"},[Builder.build(String.format("<div>{0}</div>",j))]),Builder.node("div",{className:"clear"})]);if(o){return q}else{return Builder.node("div",{className:"member_air"},[Builder.node("div",{className:"ma_head"},[Builder.node("div",{className:"ma_head_left"}),Builder.node("div",{className:"ma_head_right"}),Builder.node("div",{className:"clear"})]),Builder.node("div",{className:"ma_body"},[q]),Builder.node("div",{className:"ma_foot"},[Builder.node("div",{className:"ma_foot_left"}),Builder.node("div",{className:"ma_foot_right"}),Builder.node("div",{className:"clear"})])])}},getCommentPageIndex:function(){var c=this.getHash(),d=0;if(c.length>0){d=parseInt(c,10)}if(d>0){return d}return 1},getHash:function(){var b=document.location.hash;if(b===null||b===undefined){return""}else{if(b===""){return""}else{if(b.length===1&&b.charAt(0)==="#"){return""}else{if(b.length>1&&b.charAt(0)==="#"){return b.substring(1)}else{return b}}}}},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});