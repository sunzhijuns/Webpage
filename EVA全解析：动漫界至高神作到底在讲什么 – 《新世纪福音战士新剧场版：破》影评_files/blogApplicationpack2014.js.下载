var managerMenus={"用户昵称":{Name:"\u7528\u6237\u6635\u79F0",Title:"\u7528\u6237\u6635\u79F0",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","基本信息":{Name:"\u57FA\u672C\u4FE1\u606F",Title:"\u57FA\u672C\u4FE1\u606F",Url:"/Users/Manages/EditProfile08.m",AnchorName:"myBasic",RedirectUrl:siteMcUrl+"/profile/basic/",SaveState:false,ParentMenuName:""},"详细信息":{Name:"\u8BE6\u7EC6\u4FE1\u606F",Title:"\u8BE6\u7EC6\u4FE1\u606F",Url:"/Users/Manages/EditCharacter08.m",AnchorName:"myFeature",RedirectUrl:siteMcUrl+"/profile/detail/",SaveState:false,ParentMenuName:""},"教育职业":{Name:"\u6559\u80B2\u804C\u4E1A",Title:"\u6559\u80B2\u804C\u4E1A",Url:"/Users/Manages/EditEducation08.m",AnchorName:"myEducation",RedirectUrl:siteMcUrl+"/profile/education/",SaveState:false,ParentMenuName:""},"影迷档案":{Name:"\u5F71\u8FF7\u6863\u6848",Title:"\u5F71\u8FF7\u6863\u6848",Url:"/Users/Manages/EditMovieArchive08.m",AnchorName:"myProfile",RedirectUrl:siteMcUrl+"/profile/fans/",SaveState:false,ParentMenuName:""},"联系方式":{Name:"\u8054\u7CFB\u65B9\u5F0F",Title:"\u8054\u7CFB\u65B9\u5F0F",Url:"/Users/Manages/EditContact08.m",AnchorName:"myContact",RedirectUrl:siteMcUrl+"/profile/contact/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"修改头像":{Name:"\u4FEE\u6539\u5934\u50CF",Title:"\u4FEE\u6539\u5934\u50CF",Url:"/Users/Manages/ChangeAvatar08.m",AnchorName:"myFaceChange",RedirectUrl:siteMcUrl+"/profile/avatar/",SaveState:false,ParentMenuName:"\u7BA1\u7406\u5934\u50CF"},"管理头像":{Name:"\u7BA1\u7406\u5934\u50CF",Title:"\u7BA1\u7406\u5934\u50CF",Url:"/Users/Manages/ManageAvatars08.m",AnchorName:"myFace",RedirectUrl:siteMcUrl+"/profile/avatar/",SaveState:false,ParentMenuName:""},"修改密码":{Name:"\u4FEE\u6539\u5BC6\u7801",Title:"\u4FEE\u6539\u5BC6\u7801",Url:"/Users/Manages/ChangePassword08.m",AnchorName:"myPassword",RedirectUrl:siteMcUrl+"/profile/password/",SaveState:false,ParentMenuName:""}},"个人消息":{Name:"\u4E2A\u4EBA\u6D88\u606F",Title:"\u4E2A\u4EBA\u6D88\u606F",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","收件箱":{Name:"\u6536\u4EF6\u7BB1",Title:"\u6536\u4EF6\u7BB1",Url:"/Message/Manage/ReceiveBox.m",AnchorName:"messageReceiveBox",RedirectUrl:siteMcUrl+"/message/receivebox/",SaveState:false,ParentMenuName:""},"提醒":{Name:"提醒",Title:"提醒",Url:"/Message/Manage/SaveBox.m",AnchorName:"messageSaveBox",RedirectUrl:siteMcUrl+"/message/prompt/",SaveState:false,ParentMenuName:""},"通知":{Name:"\u901A\u77E5",Title:"\u901A\u77E5",Url:"/Message/Manage/InformBox.m",AnchorName:"messageInformBox",RedirectUrl:siteMcUrl+"/message/notice/",SaveState:false,ParentMenuName:""},"发件箱":{Name:"\u53D1\u4EF6\u7BB1",Title:"\u53D1\u4EF6\u7BB1",Url:"/Message/Manage/SendBox.m",AnchorName:"messageSendBox",RedirectUrl:siteMcUrl+"/message/sendbox/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"写消息":{Name:"\u5199\u6D88\u606F",Title:"\u5199\u6D88\u606F",Url:"/Message/Manage/WriteMessage.m",AnchorName:"messageWriteMessage",RedirectUrl:siteMcUrl+"/message/writemessage/",SaveState:false,ParentMenuName:""}},"写日志":{Name:"\u5199\u65E5\u5FD7",Title:"\u5199\u65E5\u5FD7",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","管理日志":{Name:"\u7BA1\u7406\u65E5\u5FD7",Title:"\u7BA1\u7406\u65E5\u5FD7",Url:"/Blogs/Manages/ManageBlogs08.m",AnchorName:"blogList",RedirectUrl:siteMcUrl+"/app/blog/",SaveState:false,ParentMenuName:""},"草稿箱":{Name:"\u8349\u7A3F\u7BB1",Title:"\u8349\u7A3F\u7BB1",Url:"/Blogs/Manages/ManageDrafts08.m",AnchorName:"blogDraftbox",RedirectUrl:siteMcUrl+"/app/blog/draft/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"编辑日志":{Name:"\u7F16\u8F91\u65E5\u5FD7",Title:"\u7F16\u8F91\u65E5\u5FD7",Url:"/Blogs/Manages/PostBlog08.m",AnchorName:"blogEdit",RedirectUrl:siteMcUrl+"/app/blog/edit/",SaveState:false,ParentMenuName:"\u5199\u65E5\u5FD7"},"编辑草稿":{Name:"\u7F16\u8F91\u8349\u7A3F",Title:"\u7F16\u8F91\u8349\u7A3F",Url:"/Blogs/Manages/PostBlog08.m",AnchorName:"blogDraft",RedirectUrl:siteMcUrl+"/app/blog/edit/",SaveState:false,ParentMenuName:"\u5199\u65E5\u5FD7"},"引用日志":{Name:"\u5F15\u7528\u65E5\u5FD7",Title:"\u5F15\u7528\u65E5\u5FD7",Url:"/Blogs/Manages/PostBlog08.m?PostBlogType=1",AnchorName:"blogQuote",RedirectUrl:siteMcUrl+"/app/blog/edit/",SaveState:false,ParentMenuName:"\u5199\u65E5\u5FD7"},"写日志":{Name:"\u5199\u65E5\u5FD7",Title:"\u5199\u65E5\u5FD7",Url:"/Blogs/Manages/PostBlog08.m",AnchorName:"blogWrite",RedirectUrl:siteMcUrl+"/app/blog/edit/",SaveState:false,ParentMenuName:""},"写影评":{Name:"\u5199\u5F71\u8BC4",Title:"\u5199\u5F71\u8BC4",Url:"/Blogs/Manages/PostBlog08.m",AnchorName:"movieCommentWrite",RedirectUrl:siteMcUrl+"/app/blog/edit/comment/",SaveState:false,ParentMenuName:""}},"发照片":{Name:"\u53D1\u7167\u7247",Title:"\u53D1\u7167\u7247",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","编辑照片":{Name:"\u7F16\u8F91\u7167\u7247",Title:"\u7F16\u8F91\u7167\u7247",Url:"/Albums/Manages/EditPhoto08.m",AnchorName:"photoManageEdit",RedirectUrl:siteMcUrl+"/app/album/edit/",SaveState:false,ParentMenuName:"\u7BA1\u7406\u7167\u7247"},"管理照片":{Name:"\u7BA1\u7406\u7167\u7247",Title:"\u7BA1\u7406\u76F8\u518C",Url:"/Albums/Manages/ManageAlbum08.m",AnchorName:"photoManage",RedirectUrl:siteMcUrl+"/app/album/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"发照片":{Name:"\u53D1\u7167\u7247",Title:"\u53D1\u7167\u7247",Url:"/Albums/Manages/UploadPhoto08.m",AnchorName:"uploadPhoto",RedirectUrl:siteMcUrl+"/app/album/upload/",SaveState:false,ParentMenuName:""}},"交朋友":{Name:"\u4EA4\u670B\u53CB",Title:"\u4EA4\u670B\u53CB",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","管理好友":{Name:"\u7BA1\u7406\u597D\u53CB",Title:"\u7BA1\u7406\u597D\u53CB",Url:"/Friends/Manages/ManageFriend08.m",AnchorName:"friendManage",RedirectUrl:siteMcUrl+"/friend/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"在Mtime的好友":{Name:"\u5728Mtime\u7684\u597D\u53CB",Title:"\u5728Mtime\u7684\u597D\u53CB",Url:"/Friends/Manages/FriendInMtime.m",AnchorName:"friendInMtime",RedirectUrl:"",ParentMenuName:"\u627E\u719F\u4EBA"},"不在Mtime的好友":{Name:"\u4E0D\u5728Mtime\u7684\u597D\u53CB",Title:"\u4E0D\u5728Mtime\u7684\u597D\u53CB",Url:"/Friends/Manages/FriendNotInMtime.m",AnchorName:"friendNotInMtime",RedirectUrl:"",ParentMenuName:"\u627E\u719F\u4EBA"},"找熟人":{Name:"\u627E\u719F\u4EBA",Title:"\u627E\u719F\u4EBA",Url:"/Friends/Manages/FindAcquaintance.m",AnchorName:"findAcquaintance",RedirectUrl:"http://my.mtime.com/invite/",SaveState:false,ParentMenuName:""},"邀请朋友":{Name:"\u9080\u8BF7\u670B\u53CB",Title:"\u9080\u8BF7\u670B\u53CB",Url:"/Friends/Manages/InviteFriend.m",AnchorName:"InviteFriend",RedirectUrl:"http://my.mtime.com/invite/",SaveState:false,ParentMenuName:""}},"去群组":{Name:"\u53BB\u7FA4\u7EC4",Title:"\u53BB\u7FA4\u7EC4",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","基本信息":{Name:"\u57FA\u672C\u4FE1\u606F",Title:"\u57FA\u672C\u4FE1\u606F",Url:"/Groups/Manages/BasicInfo08.m",AnchorName:"groupManageBasic",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"群组图标":{Name:"\u7FA4\u7EC4\u56FE\u6807",Title:"\u7FA4\u7EC4\u56FE\u6807",Url:"/Groups/Manages/EditAvatar08.m",AnchorName:"groupManageIcon",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"个性化":{Name:"\u4E2A\u6027\u5316",Title:"\u4E2A\u6027\u5316",Url:"/Groups/Manages/EditStyle08.m",AnchorName:"groupManageCustomize",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"群组分版":{Name:"\u7FA4\u7EC4\u5206\u7248",Title:"\u7FA4\u7EC4\u5206\u7248",Url:"/Groups/Manages/EditForum08.m",AnchorName:"groupManageDivision",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"编辑分版":{Name:"\u7F16\u8F91\u5206\u7248",Title:"\u7F16\u8F91\u5206\u7248",Url:"/Groups/Manages/EditForumEdit08.m",AnchorName:"groupManageDivisionEdit",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"新增分版":{Name:"\u65B0\u589E\u5206\u7248",Title:"\u65B0\u589E\u5206\u7248",Url:"/Groups/Manages/EditForumNew08.m",AnchorName:"groupManageDivisionAdd",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"友情链接":{Name:"\u53CB\u60C5\u94FE\u63A5",Title:"\u53CB\u60C5\u94FE\u63A5",Url:"/Groups/Manages/EditLink08.m",AnchorName:"groupManageLink",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"编辑友情链接":{Name:"\u7F16\u8F91\u53CB\u60C5\u94FE\u63A5",Title:"\u7F16\u8F91\u53CB\u60C5\u94FE\u63A5",Url:"/Groups/Manages/EditLinkEdit08.m",AnchorName:"groupManageLinkEdit",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"新增友情链接":{Name:"\u65B0\u589E\u53CB\u60C5\u94FE\u63A5",Title:"\u65B0\u589E\u53CB\u60C5\u94FE\u63A5",Url:"/Groups/Manages/EditLinkNew08.m",AnchorName:"groupManageLinkAdd",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"邀请朋友":{Name:"\u9080\u8BF7\u670B\u53CB",Title:"\u9080\u8BF7\u670B\u53CB",Url:"/Groups/Manages/EditFriend08.m",AnchorName:"groupManageInvite",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"发布公告":{Name:"\u53D1\u5E03\u516C\u544A",Title:"\u53D1\u5E03\u516C\u544A",Url:"/Groups/Manages/EditBulletin08.m",AnchorName:"groupManageAnnounce",RedirectUrl:"",ParentMenuName:"\u7BA1\u7406\u7FA4\u7EC4"},"管理群组":{Name:"\u7BA1\u7406\u7FA4\u7EC4",Title:"\u7BA1\u7406\u7FA4\u7EC4",Url:"/Groups/Manages/BasicInfo08.m",AnchorName:"groupManage",RedirectUrl:siteMcUrl+"/app/group/mygroup/",SaveState:false,ParentMenuName:""},"搜索群组":{Name:"\u641C\u7D22\u7FA4\u7EC4",Title:"\u641C\u7D22\u7FA4\u7EC4",Url:"/Groups/Manages/SearchGroup08.m",AnchorName:"groupSearch",RedirectUrl:"",ParentMenuName:"\u6211\u7684\u7FA4\u7EC4"},"我的群组":{Name:"\u6211\u7684\u7FA4\u7EC4",Title:"\u6211\u7684\u7FA4\u7EC4",Url:"/Groups/Manages/MyGroup08.m",AnchorName:"groupList",RedirectUrl:"",ParentMenuName:""},"我的同城":{Name:"我的同城",Title:"我的同城",Url:"",AnchorName:"groupCity",RedirectUrl:"/city/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"创建新群组":{Name:"\u521B\u5EFA\u65B0\u7FA4\u7EC4",Title:"\u521B\u5EFA\u65B0\u7FA4\u7EC4",Url:"/Groups/Manages/NewGroup08.m",AnchorName:"groupCreate",RedirectUrl:siteUrl+"/group/creategroup.html",SaveState:false,ParentMenuName:""},"发起新话题":{Name:"\u53D1\u8D77\u65B0\u8BDD\u9898",Title:"\u53D1\u8D77\u65B0\u8BDD\u9898",Url:"/Groups/Manages/NewTopic08.m",AnchorName:"groupTopicStep2",RedirectUrl:"",ParentMenuName:"\u9009\u62E9\u7FA4\u7EC4"},"搜索群组":{Name:"\u641C\u7D22\u7FA4\u7EC4",Title:"\u641C\u7D22\u7FA4\u7EC4",Url:"/Groups/Manages/SearchGroup08.m",AnchorName:"groupSearch",RedirectUrl:"",ParentMenuName:"\u9009\u62E9\u7FA4\u7EC4"},"选择群组":{Name:"\u9009\u62E9\u7FA4\u7EC4",Title:"\u53D1\u8D77\u65B0\u8BDD\u9898",Url:"/Groups/Manages/SelectGroup08.m",AnchorName:"groupTopic",RedirectUrl:"",ParentMenuName:""}},"玩游戏":{Name:"\u73A9\u6E38\u620F",Title:"\u73A9\u6E38\u620F",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","管理游戏":{Name:"\u7BA1\u7406\u6E38\u620F",Title:"\u7BA1\u7406\u6E38\u620F",Url:"/Game/Manages/08/MyGame.m",AnchorName:"gameList",RedirectUrl:siteMcUrl+"/app/quiz/myquiz/",SaveState:false,ParentMenuName:""},"创建问答":{Name:"\u521B\u5EFA\u95EE\u7B54",Title:"\u521B\u5EFA\u95EE\u7B54",Url:"/Game/Manages/08/NewGame.m",AnchorName:"gameCreate",RedirectUrl:siteMcUrl+"/app/quiz/create/",SaveState:false,ParentMenuName:""}},"收藏夹":{Name:"\u6536\u85CF\u5939",Title:"\u6536\u85CF\u5939",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","编辑收藏":{Name:"\u7F16\u8F91\u6536\u85CF",Title:"\u7F16\u8F91\u6536\u85CF",Url:"/Favorites/Manages/EditFavorite08.m",AnchorName:"manageFavoriteEdit",RedirectUrl:"http://my.mtime.com/favorite/",SaveState:false,ParentMenuName:"\u7BA1\u7406\u6536\u85CF"},"管理收藏":{Name:"\u7BA1\u7406\u6536\u85CF",Title:"\u7BA1\u7406\u6536\u85CF",Url:"/Favorites/Manages/ManageFavorites08.m",AnchorName:"manageFavorite",RedirectUrl:"http://my.mtime.com/favorite/",SaveState:false,ParentMenuName:""},line:{Name:"line",Title:"line",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:""},"编辑专辑":{Name:"\u7F16\u8F91\u4E13\u8F91",Title:"\u7F16\u8F91\u4E13\u8F91",Url:"/Favorites/Manages/EditList08.m",AnchorName:"manageListEdit",RedirectUrl:siteMcUrl+"/special/edit/",SaveState:false,ParentMenuName:"\u7BA1\u7406\u4E13\u8F91"},"管理专辑":{Name:"\u7BA1\u7406\u4E13\u8F91",Title:"\u7BA1\u7406\u4E13\u8F91",Url:"/Favorites/Manages/ManageLists08.m",AnchorName:"manageList",RedirectUrl:siteMcUrl+"/special/list/all/",SaveState:false,ParentMenuName:""}},"个性化":{Name:"\u4E2A\u6027\u5316",Title:"\u4E2A\u6027\u5316",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","开始":{Name:"\u5F00\u59CB",Title:"\u5F00\u59CB",Url:"/Manages/ConfigIndex.mb",AnchorName:"customize",RedirectUrl:"",ParentMenuName:""},"模板":{Name:"\u6A21\u677F",Title:"\u6A21\u677F",Url:"/Manages/SharedBoards.mb",AnchorName:"sharedBoards",RedirectUrl:"",ParentMenuName:""},"布局":{Name:"\u5E03\u5C40",Title:"\u5E03\u5C40",Url:"/Manages/ConfigStyleLayout.mb",AnchorName:"customizeLayout",RedirectUrl:"",ParentMenuName:"",buttons:[{title:"保存",style:"done",method:"save"},{title:"预览",style:"cancel",method:"preview"},{title:"取消",style:"cancel",method:"cancel"}]},"自定义":{Name:"\u81EA\u5B9A\u4E49",Title:"\u81EA\u5B9A\u4E49",Url:"/Manages/ConfigCustomStyle.mb",AnchorName:"customizeStyleDiy",RedirectUrl:"",ParentMenuName:"",buttons:[{title:"保存",style:"done",method:"save"},{title:"预览",style:"cancel",method:"preview"},{title:"取消",style:"cancel",method:"cancel"},{title:"存为模板",style:"cancel",method:"saveboard"}]},"模块":{Name:"\u6A21\u5757",Title:"\u6A21\u5757",Url:"/Manages/ConfigModules.mb",AnchorName:"customizeModules",RedirectUrl:"",ParentMenuName:"",buttons:[{title:"保存",style:"done",method:"save"},{title:"预览",style:"cancel",method:"preview"},{title:"取消",style:"cancel",method:"cancel"}]},"编辑代码":{Name:"编辑代码",Title:"编辑代码",Url:"/Manages/EditTemplate.mb",AnchorName:"editTemplate",RedirectUrl:"",SaveState:false,ParentMenuName:"\u5F00\u59CB"},"会员共享":{Name:"会员共享",Title:"会员共享",Url:"/Manages/SharedBoards.mb",AnchorName:"sharedBoards",RedirectUrl:"",SaveState:false,ParentMenuName:"\u6A21\u677F"},"我的模板":{Name:"我的模板",Title:"我的模板",Url:"/Manages/MyBoards.mb",AnchorName:"myBoards",RedirectUrl:"",SaveState:false,ParentMenuName:"\u6A21\u677F"},"我的共享":{Name:"我的共享",Title:"我的共享",Url:"/Manages/MySharedBoards.mb",AnchorName:"mySharedBoards",RedirectUrl:"",SaveState:false,ParentMenuName:"\u6A21\u677F"}},"其他管理":{Name:"\u5176\u4ED6\u7BA1\u7406",Title:"\u5176\u4ED6\u7BA1\u7406",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","管理标签":{Name:"\u7BA1\u7406\u6807\u7B7E",Title:"\u6807\u7B7E",Url:"/Tags/Manages/ManageTag.m",AnchorName:"manageTag",RedirectUrl:siteMcUrl+"/blog/tag/",SaveState:false,ParentMenuName:""},"添加音乐":{Name:"\u6DFB\u52A0\u97F3\u4E50",Title:"\u6DFB\u52A0\u97F3\u4E50",Url:"/UserLink/Manage/ManageMusic.m?initMode=1",AnchorName:"addMusic",RedirectUrl:siteMcUrl+"/custom/widget/music/edit/",SaveState:false,ParentMenuName:"\u6211\u7684\u97F3\u4E50"},"管理音乐":{Name:"\u7BA1\u7406\u97F3\u4E50",Title:"\u7BA1\u7406\u97F3\u4E50",Url:"/UserLink/Manage/ManageMusic.m",AnchorName:"manageMusic",RedirectUrl:siteMcUrl+"/custom/widget/music/",SaveState:false,ParentMenuName:"\u6211\u7684\u97F3\u4E50"},"我的音乐":{Name:"\u6211\u7684\u97F3\u4E50",Title:"\u6211\u7684\u97F3\u4E50",Url:"/UserLink/Manage/ManageMusic.m",AnchorName:"myMusic",RedirectUrl:siteMcUrl+"/custom/widget/music/",SaveState:false,ParentMenuName:""}},"设置":{Name:"\u8BBE\u7F6E",Title:"\u8BBE\u7F6E",Url:"",AnchorName:"",RedirectUrl:"",ParentMenuName:"","帐号设置":{Name:"\u5E10\u53F7\u8BBE\u7F6E",Title:"\u5E10\u53F7\u8BBE\u7F6E",Url:"/Users/Manages/SetAccount08.m",AnchorName:"setAccount",RedirectUrl:siteMcUrl+"/custom/widget/music/",SaveState:false,ParentMenuName:""},"通知设置":{Name:"\u901A\u77E5\u8BBE\u7F6E",Title:"\u901A\u77E5\u8BBE\u7F6E",Url:"/Users/Manages/SetMessage08.m",AnchorName:"setMessage",RedirectUrl:siteMcUrl+"/setting/message/",SaveState:false,ParentMenuName:""},"好友动态":{Name:"\u597D\u53CB\u52A8\u6001",Title:"\u597D\u53CB\u52A8\u6001",Url:"/Users/Manages/08/ConfigFriendFeed.m",AnchorName:"ConfigFriendFeed",RedirectUrl:siteMcUrl+"/setting/friendfeed/",SaveState:false,ParentMenuName:"\u6211\u7684\u52A8\u6001"},"我的动态":{Name:"\u6211\u7684\u52A8\u6001",Title:"\u6211\u7684\u52A8\u6001",Url:"/Users/Manages/08/ConfigUserFeed.m",AnchorName:"ConfigUserFeed",RedirectUrl:siteMcUrl+"/setting/feed/",SaveState:false,ParentMenuName:""}}};var History=Mtime.Component.History;History={historys:[],hash:"",isStart:false,check:function(){if(this.ignoreLocationChange){this.ignoreLocationChange=false;return}var b=this.getHash();if(b!=""&&b!=this.hash){this.hash=b;this.onHashChanged(b)}},initialize:function(){if(IE){var b=document.createElement("iframe");b.id="state-frame";b.style.display="none";$("managerHistoryRegion").appendChild(b);this.writeFrame("")}},start:function(){if(this.isStart){return}this.isStart=true;var b=this;if(IE){if("onpropertychange" in document&&"attachEvent" in document){document.attachEvent("onpropertychange",function(){if(event.propertyName=="location"){b.check()}})}}window.setInterval(function(){b.check()},100)},add:function(c,d){this.ignoreLocationChange=true;this.setHash(c);HistoryStorage.put(c,d);this.start()},setHash:function(b){if(IE){this.writeFrame(b)}this.hash=b;document.location.hash=b},getHash:function(){var b=document.location.hash;if(b==null||b==undefined){return""}else{if(b==""){return""}else{if(b.length==1&&b.charAt(0)=="#"){return""}else{if(b.length>1&&b.charAt(0)=="#"){return b.substring(1)}else{return b}}}}},writeFrame:function(f){var e=document.getElementById("state-frame");var d=e.contentDocument||e.contentWindow.document;d.open();d.write("<script>window._hash = '"+f+"'; window.onload = parent.History.syncHash;</script>");d.close()},syncHash:function(){var b=this._hash;if(typeof b!=="undefined"&&b!==null&&b.length!==0&&b!=document.location.hash){document.location.hash=b}},addListener:function(b){this.listener=b},onHashChanged:function(c){if(c!=""){var d=HistoryStorage.get(c);this.listener.call(null,c,d)}}};var HistoryStorage=Mtime.Component.HistoryStorage;HistoryStorage={storageHash:{},put:function(c,d){this.assertValidKey(c);if(this.hasKey(c)){this.remove(c)}this.storageHash[c]=d},get:function(c){this.assertValidKey(c);var d=this.storageHash[c];if(typeof d=="undefined"){return null}else{return d}},remove:function(b){this.assertValidKey(b);delete this.storageHash[b]},reset:function(){this.storageHash={}},hasKey:function(b){this.assertValidKey(b);if(typeof this.storageHash[b]=="undefined"){return false}else{return true}},isValidKey:function(b){return(typeof b=="string")},assertValidKey:function(b){if(!this.isValidKey(b)){throw"Key不合法, key= "+b}}};var ManagerExecuter=Class.create();Object.extend(ManagerExecuter.prototype,{StyleContainerId:"ManageContentStyleContainer",ScriptContainerId:"ManageContentScriptContainer",ContentContainerId:"ManageContentHtmlContainer",ScriptContentFragment:"<script.*?>((\n|\r|.)*?)</script>",ScriptSrcFragment:'<script.*?src="([:*%&?=/.A-Za-z0-9_]*)".*?></script>',StyleIdPrefix:"style_",TextareaRegex:/textareaReplace/g,ScriptIdPrefix:"script_",STATE_TOKEN:"ManageState",Timeout:20000,onLoadCallbacks:[],onCloseCallbacks:[],options:{user:null,urls:null,head:"head",managerRegion:"managerRegion",loading:"globalLoading",middleRegion:"m_manage_middleRegion",manageMenuRegion:"manage_menu",contentRegion:"m_manage_contentRegion",middleCloseButton:"m_manage_middleCloseButton",bottomCloseButton:"m_manage_bottomCloseButton",bottomRegion:"manage_bottom",bottomButtonRegion:"m_manage_bottomButtonRegion",successMessageRegion:"m_manage_successMessageRegion",successMessageTitle:"m_manage_successMessageTitle",successMessageContent:"m_manage_successMessageContent",closeSuccessMessageButton:"m_manage_closeSuccessMessageButton",failureMessageRegion:"m_manage_failureMessageRegion",failureMessageTitle:"m_manage_failureMessageTitle",failureMessageContent:"m_manage_failureMessageContent",closeFailureMessageButton:"m_manage_closeFailureMessageButton"},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeData();this.loadCookieState()},initializeField:function(){this.isLoad=false;this.processing=false;this.state=null;this.styleIds=[];this.scriptIds=[];this.requestQueue=[];this.MatchAllScriptSrc=new RegExp(this.ScriptSrcFragment,"img");this.MatchOneScriptSrc=new RegExp(this.ScriptSrcFragment,"im");this.MatchAllScriptContent=new RegExp(this.ScriptContentFragment,"img");this.MatchOneScriptContent=new RegExp(this.ScriptContentFragment,"im")},initializeData:function(){this.menus=managerMenus},loadCookieState:function(){var b=this.loadState();if(b!==null){manager=this;this.openManager(b.menuName,b.manageMenuName,b.params)}},load:function(){this.isLoad=true;this.initializeDOM();this.initializeEvent();this.initializeControl();this.loadMemberHistory()},initializeDOM:function(){this.head=$(this.head);this.managerRegion=$(this.managerRegion);this.loading=$(this.loading);this.addDOM();this.middleRegion=$(this.middleRegion);this.manageMenuRegion=$(this.manageMenuRegion);this.contentRegion=$(this.contentRegion);this.middleCloseButton=$(this.middleCloseButton);this.bottomCloseButton=$(this.bottomCloseButton);this.successMessageRegion=$(this.successMessageRegion);this.successMessageTitle=$(this.successMessageTitle);this.successMessageContent=$(this.successMessageContent);this.closeSuccessMessageButton=$(this.closeSuccessMessageButton);this.failureMessageRegion=$(this.failureMessageRegion);this.failureMessageTitle=$(this.failureMessageTitle);this.failureMessageContent=$(this.failureMessageContent);this.closeFailureMessageButton=$(this.closeFailureMessageButton);this.bottomRegion=$(this.bottomRegion);this.bottomButtonRegion=$(this.bottomButtonRegion)},addDOM:function(){var b=Builder.node("div",{id:"personality"},[Builder.node("div",{id:"m_manage_middleRegion",className:"manage_mt",style:"display:none"},[Builder.node("div",{id:"manage_area"},[Builder.node("div",{className:"manage_hide",style:"display:none"},[Builder.node("a",{id:"m_manage_middleCloseButton",href:"#",title:"关闭"},["关闭"])]),Builder.node("div",{id:"manage_menu",className:"clearfix"}),Builder.node("div",{className:"manage_content"},[Builder.node("div",{className:"clear"}),Builder.node("div",{id:"m_manage_successMessageRegion",className:"m_winsuc",style:"width:365px;display:none;"},[Builder.node("div",{id:"m_manage_closeSuccessMessageButton",className:"m_close"},[Builder.node("img",{src:"/images/transparent.gif",alt:"关闭",className:"icon_01",onmouseover:"this.className='icon_on12'",onmouseout:"this.className='icon_01'"})]),Builder.node("h4",{id:"m_manage_successMessageTitle"}),Builder.node("div",{id:"m_manage_successMessageContent"})]),Builder.node("div",{id:"m_manage_failureMessageRegion",className:"m_winerr",style:"display:none;width:365px;"},[Builder.node("div",{id:"m_manage_closeFailureMessageButton",className:"m_close"},[Builder.node("img",{src:"/images/transparent.gif",alt:"关闭",className:"icon_01",onmouseover:"this.className='icon_on02'",onmouseout:"this.className='icon_01'"})]),Builder.node("h4",{id:"m_manage_failureMessageTitle"}),Builder.node("div",{id:"m_manage_failureMessageContent"})]),Builder.node("div",{id:"m_manage_contentRegion"}),Builder.node("div",{className:"clear"})]),Builder.node("div",{className:"manage_hide"},[Builder.node("a",{id:"m_manage_bottomCloseButton",href:"#",title:"关闭"},["关闭"])])])]),Builder.node("div",{id:"manage_bottom",style:"display:none"},[Builder.node("div",{id:"m_manage_bottomButtonRegion",className:"m_button clearfix",style:"display:none"})]),Builder.node("div",{id:"m_manage_bottomWindowRegion",style:"display:none"}),Builder.node("div",{id:"m_manage_bottomHiddenRegion",style:"display:none"}),Builder.node("div",{id:"m_manage_DebugContentRegion",style:"display:none"}),Builder.node("div",{id:"m_manage_tempContentRegion",style:"display:none"})]);this.managerRegion.appendChild(b)},destroyDOM:function(){if(this.managerRegion){this.managerRegion.innerHTML=""}},initializeEvent:function(){this.onClickMenuRegionHandler=this.onClickMenuRegion.bindAsEventListener(this);this.onClickBottomButtonHandler=this.onClickBottomButton.bindAsEventListener(this);this.onClickCloseButtonHandler=this.closeManager.bind(this);Event.observe(this.middleCloseButton,"click",this.onClickCloseButtonHandler);Event.observe(this.bottomCloseButton,"click",this.onClickCloseButtonHandler);this.onClickSuccessMessageButtonHandler=function(){this.successMessageRegion.hide()}.bind(this);this.closeSuccessMessageButton.observe("click",this.onClickSuccessMessageButtonHandler);this.onClickFailureMessageButtonHandler=function(){this.failureMessageRegion.hide()}.bind(this);this.closeFailureMessageButton.observe("click",this.onClickFailureMessageButtonHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.middleCloseButton){this.middleCloseButton.stopObserving("click",this.onClickCloseButtonHandler)}if(this.bottomCloseButton){this.bottomCloseButton.stopObserving("click",this.onClickCloseButtonHandler)}if(this.closeSuccessMessageButton){this.closeSuccessMessageButton.stopObserving("click",this.onClickSuccessMessageButtonHandler)}if(this.closeFailureMessageButton){this.closeFailureMessageButton.stopObserving("click",this.onClickFailureMessageButtonHandler)}},initializeControl:function(){},destroyControl:function(){},loadMemberHistory:function(){History.initialize();History.addListener(function(d,c){if(c!=null){this.openManager(c.menuName,c.manageMenuName,c.params)}}.bind(this))},show:function(n,m,o,j,h){j=j||false;if(j){this.clearManageOnCloseEvent()}var k=m;var l=k.indexOf("|");if(l>0){k=k.substring(l+1)}if(typeof h!=="undefined"&&h!==null){this.afterShowCallback=h}else{this.afterShowCallback=null}this.openManager(n,k,o)},go:function(){if(!Mtime.isEmpty(this.state)){this.clearManageOnCloseEvent();var b=this.state;this.openManager(b.menuName,b.manageMenuName,b.params,b.redirectUrl)}else{this.directCloseManager()}},isLoadCss:false,openManager:function(g,f,h,k){var j=false;if(this.managerVisible()){j=this.runManageOnCloseEvent(g,f,h,k)}if(!j){if(!this.checkRedirect(g,f,h,k)){if(!this.isLoadCss){$loadCss("/css/personality.css",function(){this.isLoadCss=true;this.renderManager(g,f,h)}.bind(this))}else{this.renderManager(g,f,h)}}}return j},renderManager:function(e,d,f){if(!this.isLoad){this.load()}this.beginWaiting();this.showManagerMenu(e,d,f)},closeManager:function(f,e,g){f=f||"";e=e||"";g=g||"";var h=false;if(this.managerVisible()){h=this.runManageOnCloseEvent(f,e,g)}if(!h){this.closeActionMessage();this.directCloseManager()}return h},directCloseManager:function(){if(!Mtime.isEmpty(this.topMenus)){var e=null;for(var f=0,d=this.topMenus.length;f<d;f++){e=$(this.topMenus[f]);if(e.hasClassName("on")){e.removeClassName("on");break}}}this.middleRegion.hide();this.bottomRegion.hide();this.managerRegion.scrollTo()},buildManageMenu:function(r,p){Event.stopObserving(this.manageMenuRegion,"click",this.onClickMenuRegionHandler);this.manageMenuRegion.innerHTML="";var n=new StringBuilder();var k="";n.append('<ul class="clearfix">');for(var s in p){var q=p[s];if(q.Name&&q.Title&&q.ParentMenuName.length==0){n.append(String.Format('<li menu="{0}" manageMenu="{1}"><a href="#" onclick="return false;">{2}</a></li>',r,q.Name,q.Title))}}n.append("</ul>");if(this.customizeMenus&&this.customizeMenus[r]!==null){n.append('<a href="#" menu="个性化" manageMenu="编辑代码" class="fr" onclick="return false;">编辑代码</a>')}this.manageMenuRegion.innerHTML=n.toString();this.manageMenuRegion.setAttribute("menuName",r);Event.observe(this.manageMenuRegion,"click",this.onClickMenuRegionHandler);var o=this.manageMenuRegion.getElementsByTagName("li"),p=[];for(var m=0,l=o.length;m<l;m++){p[m]=Element.extend(o[m])}this.manageMenus=p},onClickMenuRegion:function(g){var f=Event.findElement(g,"li");if(!f||!f.readAttribute){f=Event.findElement(g,"a");if(!f||!f.readAttribute){return}}f=$(f);var j=f.readAttribute("menu");var h=f.readAttribute("manageMenu");var k=false;if(this.managerVisible()){k=this.runManageOnCloseEvent(j,h)}if(!k){if(f.hasClassName("on")){}else{if(!this.checkRedirect(j,h)){FunctionExt.defer(this.showManagerMenu,1,this,[j,h])}}}},checkRedirect:function(k,j,l,m){var o=this.getTopMenu(k);if(o&&o!=null){var n=true;m=m||"";m=o.RedirectUrl.length>0?o.RedirectUrl:m;if(m.length===0){var h=this.getMenu(k,j);if(h!==null){m=h.RedirectUrl;n=typeof h.SaveState==="undefined"?true:h.SaveState}}if(k==="个性化"&&m.length===0){m=this.user.blogUrl}if(m.length>0){return this.redirect(m,k,j,l,n)}}return false},redirect:function(m,k,j,l,n){l=l||"";n=typeof n==="undefined"?true:n;var h=location.pathname;if(m.startsWith("http://")){var o=location.href.indexOf("#");if(o>0){h=location.href.substr(0,o)}else{h=location.href}}if(h!=m){this.managerRegion.hide();if(n){this.saveState(k,j,l)}else{m+=l}if(this.isLoad){this.closeManager()}if(!m.startsWith("http://")){m=siteUrl+m}$Redirect(m);return true}return false},managerVisible:function(){if(typeof this.middleRegion==="string"){return false}return this.middleRegion.visible()},showManagerMenu:function(s,p,t){if(this.processing){this.alert("处理中请稍候！");return false}this.processing=true;this.beginWaiting();if(!this.middleRegion.visible()){this.middleRegion.show()}if(!this.bottomRegion.visible()){this.bottomRegion.show()}this.showContentRegion(s,p,t);this.renderManageBottomRegion(s,p);if(!Mtime.isEmpty(this.topMenus)){var n=null;for(var o=0,l=this.topMenus.length;o<l;o++){n=$(this.topMenus[o]);if(n){if(s.toLowerCase()!=n.readAttribute("menu").toLowerCase()){n.removeClassName("on")}else{n.addClassName("on")}}}}var m=this.manageMenuRegion.readAttribute("menuName");if(m!=s){var u=this.getTopMenu(s);this.buildManageMenu(s,u)}var r=this.getMenu(s,p);if(r.ParentMenuName.length!=0){p=r.ParentMenuName}if(!Mtime.isEmpty(this.manageMenus)){p=p.toLowerCase();var n=null,q=this.manageMenus;for(var o=0,l=q.length;o<l;o++){n=q[o];if(n!=null){if(p!=n.readAttribute("manageMenu").toLowerCase()){n.removeClassName("on")}else{n.addClassName("on")}}}}},renderManageBottomRegion:function(q,o){var p=this.getMenu(q,o);if(!Mtime.isEmpty(p)){var k=new StringBuilder(),l=p.buttons,j=null;if(l&&l.length>0){for(var n=0,m=l.length;n<m;n++){j=l[n];k.append(String.Format('<a onclick="return false;" href="#" class="{1} mr10" title="{0}" method={2}>{0}</a>',j.title,j.style,j.method))}}this.bottomButtonRegion.stopObserving("click",this.onClickBottomButtonHandler);if(!this.bottomButtonRegion.visible()){this.bottomButtonRegion.show()}this.bottomButtonRegion.innerHTML=k.toString();this.bottomButtonRegion.observe("click",this.onClickBottomButtonHandler)}},onClickBottomButton:function(e){if(!e.handled){e.handled=true;var d=Event.findElement(e,"a");Event.stop(e);d=$(d);if(d&&d.readAttribute){var f=d.readAttribute("method");if(f.length>0){this.beginWaiting();this.bottomButtonRegion.stopObserving("click",this.onClickBottomButtonHandler);this.runBottomButton(f);this.bottomButtonRegion.observe("click",this.onClickBottomButtonHandler);this.endWaiting()}}}},showContentRegion:function(h,f,j){this.closeActionMessage();j=j||"";var g=this.getMenu(h,f);if(!Mtime.isEmpty(g)){var k={menuName:h,manageMenuName:f,params:j};if(typeof(History)!="undefined"){if(g.AnchorName.length>0){History.add(g.AnchorName,k)}}if(g.Url&&g.Url.length>0){this.requestContent(g.Url,j)}}},requestContent:function(m,k){if(this.requestQueue.length>0){for(var j=0,h=this.requestQueue.length;j<h;j++){if(this.requestQueue[j]&&this.requestQueue[j].transport){this.requestQueue[j].transport.abort()}this.requestQueue.pop()}}k=k||"";var l=this.getUrl(m,k);this.console.clear();this.console.debug("requestUrl:"+l);this.requestBeginTime=new Date();var g=new Ajax.Request(l,{method:"get",timeout:this.Timeout,onFailure:function(){this.processing=false;this.requestQueue.pop();this.contentRegion.update('<p class="tc">请求超时，请<a id="m_refreshManager" href="#">刷新</a>重试！</p>');$("m_refreshManager").onclick=FunctionExt.createDelegate(this.requestContent,this,[m,k])}.bind(this),onComplete:function(a){if(!Mtime.isEmpty(a)){FunctionExt.defer(this.showManagePageContent,1,this,[a]);FunctionExt.defer(this.googleTrack,5000,this,[this.urls.SiteUrl+l])}else{}}.bind(this)});this.beforeShowManagePageContent();this.requestQueue.push(g)},beforeShowManagePageContent:function(){this.beginWaiting();this.clearManageOnLoadEvent();this.clearManageOnCloseEvent();this.clearManageBottomButtons()},showManagePageContent:function(z){if(typeof z=="undefined"||z==null||z.length==0||z.status==404){return}this.console.debug("requestTime:"+(new Date()-this.requestBeginTime));this.loadBeginTime=new Date();this.requestQueue.pop();this.removeHTML();var E=null,A=null;var F=this.scriptIds;for(var v=0,e=F.length;v<e;v++){E=F[v];if(E){A=$(E);if(A){this.head.removeChild(A)}}}this.scriptIds.clear();var x=z.responseText;var y=this.extractPageContent(x);this.contentRegion.innerHTML=y.html.replace(this.TextareaRegex,"textarea");var H=y.script;var G=this.extractScriptSrcs(H);var C=this.extractScriptContents(H);var w=0,D=null,B=null;for(var v=0,e=C.length;v<e;v++){B=C[v];if(B.trim().length!==0){E=this.ScriptIdPrefix+w;D=document.createElement("script");D.type="text/javascript";D.setAttribute("id",E);D.text=B;try{this.head.appendChild(D)}catch(u){if(debug){alert(u.message)}}this.scriptIds[w]=E;w++}}var K=[];for(var v=0,e=G.length;v<e;v++){if(G[v].length!=0){K.push(G[v])}}this.loadedScriptCount=0;this.totalScriptCount=K.length;var I=typeof managerJsServer!=="undefined"?managerJsServer:jsServer;for(var v=0,e=K.length;v<e;v++){var J=K[v];E=this.ScriptIdPrefix+w;var J=K[v];if(!J.startsWith("http://")){if(I.length>0){J=I+J}}$loadJs(J,this.loadScriptSrc.bind(this));this.scriptIds[w]=E;w++}if(this.totalScriptCount===0){this.runManageOnLoadEvent()}},extractPageContent:function(h){var n="<ManageContentScriptContainer>";var o="</ManageContentScriptContainer>";var m=h.extract(n,o);var k="<ManageContentHtmlContainer>";var l="</ManageContentHtmlContainer>";var j=h.extract(k,l);return{script:m,html:j}},loadScriptSrc:function(){this.loadedScriptCount++;if(this.loadedScriptCount>=this.totalScriptCount){this.runManageOnLoadEvent()}},focus:function(){if(this.managerRegion){this.managerRegion.scrollTo()}},hideBottomButton:function(){if(this.bottomButtonRegion){this.bottomButtonRegion.stopObserving("click",this.onClickBottomButtonHandler);this.bottomButtonRegion.hide()}},showBottomButton:function(){if(this.bottomButtonRegion){this.bottomButtonRegion.stopObserving("click",this.onClickBottomButtonHandler);this.bottomButtonRegion.observe("click",this.onClickBottomButtonHandler);this.bottomButtonRegion.show()}},dialog:function(m,l,k,q,p,n,r,o){var s;if(r){s="width:"+r}return new DialogBox({windowClassName:"w295",width:r,element:m,content:l||"",buttons:k,readyCallback:q||Prototype.emptyFunction,closeCallback:p||Prototype.emptyFunction,isInOverflowContainer:n||false,isToggleTroubleElement:o||false})},confirm:function(k,h,j,f,g){return new Dialog({windowClassName:"w295",title:k,content:'<div class="tc bold">'+h+"</div>",buttonRegionClass:"tc pb12 pt15",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){if(j){j(a)}a.close()}.bind(this)},{title:"取消",buttonStyle:"btn_square",callback:function(a){if(f){f(a)}a.close()}.bind(this)}],onClickCloseCallback:g||Prototype.emptyFunction})},confirmClose:function(f,d,e){return new Dialog({windowClassName:"w295",title:"还没有保存呢",content:'<div class="tc bold">点击”返回编辑“，留在当前页面<br />或点击”放弃并离开“继续切换页面</div>',buttonRegionClass:"tc pb12 pt15",buttons:[{title:"返回编辑",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){if(d){d(a)}a.close()}.bind(this)},{title:"放弃并离开",buttonStyle:"btn_square",callback:function(a){if(f){f(a)}a.close()}.bind(this)}],onClickCloseCallback:e||Prototype.emptyFunction})},alert:function(h,f,g,e){return new Dialog({windowClassName:"w295",title:f?h:"",content:'<div class="tc bold">'+(f||h)+"</div>",buttonRegionClass:"tc pb12 pt15",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){if(g){g(a)}a.close()}.bind(this)}],onClickCloseCallback:e||Prototype.emptyFunction})},successMessage:function(h,e,g,f){this.successMessageTitle.update(h);e=e||"";if(e!=""){this.successMessageContent.update(e)}if(g&&g.length>0){this.oldSuccessMessageRegionWidth=this.successMessageRegion.getStyle("width");this.successMessageRegion.setStyle({width:g})}else{if(this.oldSuccessMessageRegionWidth&&this.oldSuccessMessageRegionWidth.length>0){this.successMessageRegion.setStyle({width:this.oldSuccessMessageRegionWidth})}}this.showSuccessMessage(f);this.closeErrorMessage()},errorMessage:function(d,c){this.failureMessageTitle.update(d);c=c||"";if(c!=""){this.failureMessageContent.update(c)}this.showErrorMessage();this.closeSuccessMessage()},closeActionMessage:function(){this.closeSuccessMessage();this.closeErrorMessage()},showSuccessMessage:function(b){if(!this.successMessageRegion.visible()){this.successMessageRegion.show();if(!b){this.successMessageRegion.scrollTo()}}else{this.successMessageRegion.scrollTo()}},closeSuccessMessage:function(){if(this.successMessageRegion.visible()){this.successMessageTitle.innerHTML="";this.successMessageContent.innerHTML="";this.successMessageRegion.hide()}},showErrorMessage:function(b){if(!this.failureMessageRegion.visible()){this.failureMessageRegion.show();if(!b){this.failureMessageRegion.scrollTo()}}else{this.failureMessageRegion.scrollTo()}},closeErrorMessage:function(){if(this.failureMessageRegion.visible()){this.failureMessageTitle.innerHTML="";this.failureMessageContent.innerHTML="";this.failureMessageRegion.hide()}},console:{debug:function(b){if(debug){if(!$("m_manage_DebugContentRegion").visible()){$("m_manage_DebugContentRegion").show()}$("m_manage_DebugContentRegion").innerHTML+="<br/>"+b}},clear:function(){if(debug){if(!$("m_manage_DebugContentRegion").visible()){$("m_manage_DebugContentRegion").show()}$("m_manage_DebugContentRegion").innerHTML=""}}},refreshPresentation:function(){var d=window.location.href,c=d.indexOf("#");if(c>0){d=d.substr(0,c)}this.closeManager();$Redirect(d)},scrollToPresentation:function(){$("container2").scrollTo()},onReady:function(b){this.onLoadCallbacks.push(b)},onClose:function(b){this.onCloseCallbacks.push(b)},bottomButtons:[],clearManageBottomButtons:function(){if(this.bottomButtons.length>0){this.bottomButtons=[]}},addBottomButton:function(b){this.bottomButtons.push(b)},runBottomButton:function(h){var e=null;for(var g=0,f=this.bottomButtons.length;g<f;g++){if(this.bottomButtons[g].method==h){e=this.bottomButtons[g];break}}if(e!==null){e.callback()}},runManageOnLoadEvent:function(){try{for(var b=0;b<this.onLoadCallbacks.length;b++){this.onLoadCallbacks[b]()}this.onLoadCallbacks=[];if(typeof this.afterShowCallback!="undefined"&&this.afterShowCallback!=null){this.afterShowCallback();this.afterShowCallback=null}}finally{this.processing=false}this.console.debug("loadTime:"+(new Date()-this.loadBeginTime))},clearManageOnLoadEvent:function(){if(this.onLoadCallbacks.length>0){this.onLoadCallbacks=[]}},runManageOnCloseEvent:function(k,j,l,m){if(this.processing){return false}k=k||"";j=j||"";l=l||"";m=m||"";if(this.onCloseCallbacks.length>0){if(k.length!=0&&j.length!=0){this.state={menuName:k,manageMenuName:j,params:l,redirectUrl:m}}try{for(var h=0;h<this.onCloseCallbacks.length;h++){this.onCloseCallbacks[h]()}}catch(e){if(debug){alert(e)}this.onCloseCallbacks=[]}this.processing=false;return true}else{this.state=null}this.processing=false;return false},clearManageOnCloseEvent:function(){if(this.onCloseCallbacks.length>0){this.onCloseCallbacks=[]}},beginWaiting:function(){if(this.loading&&!this.loading.visible()){this.loading.show()}},endWaiting:function(){if(this.loading&&this.loading.visible()){this.loading.hide()}},addWindowNode:function(b){$("m_manage_bottomWindowRegion").appendChild(b)},removeWindowNode:function(b){$("m_manage_bottomWindowRegion").removeChild(b)},addHTML:function(b){$("m_manage_bottomHiddenRegion").innerHTML+=b},removeHTML:function(){$("m_manage_bottomHiddenRegion").innerHTML=""},signIn:function(){$Redirect(this.urls.signIn)},signUp:function(){$Redirect(this.urls.signUp)},signOut:function(){$Redirect(this.urls.signOut)},getUser:function(){return this.user},loadState:function(){var q=getCookie(this.STATE_TOKEN),o=null;if(typeof q!="undefined"&&q!=null&&q.length!=0){this.clearState();try{var p=q.split(",");var m=p[0],k=p[1],n=p[2];var l=this.getMenu(m,k);if(!Mtime.isEmpty(l)){return{menuName:m,manageMenuName:k,params:n}}}catch(e){}}return null},saveState:function(f,e,g){var h=new StringBuilder();h.append(f);h.append(",");h.append(e);h.append(",");h.append(g);setCookie(this.STATE_TOKEN,h.toString())},clearState:function(){setCookie(this.STATE_TOKEN,"")},getTopMenu:function(b){if(typeof this.menus[b]!=="undefined"){return this.menus[b]}return null},getMenu:function(f,d){var e=this.getTopMenu(f);if(typeof e[d]!="undefined"){return e[d]}else{if(this.customizeMenus&&this.customizeMenus[f]!=null){return this.customizeMenus[f][d]}}return null},getUrl:function(k,g){var h="";var j="t="+Random(10000);if(g!=""){var f=g.substr(0,1);if(f=="?"){g=g.substr(1)}else{if(f=="&"){g=g.substr(1)}}g+="&"+j}else{g=j}if(k.indexOf("?")>0){h=k+"&"+g}else{h=k+"?"+g}return h},googleTrack:function(d){if(typeof urchinTracker!=="undefined"){_uacct="UA-257914-4";try{urchinTracker(d)}catch(c){}}},extractScriptSrcs:function(b){return(b.match(this.MatchAllScriptSrc)||[]).map(function(a){return(a.match(this.MatchOneScriptSrc)||["",""])[1]}.bind(this))},extractScriptContents:function(b){return(b.match(this.MatchAllScriptContent)||[]).map(function(a){return(a.match(this.MatchOneScriptContent)||["",""])[1]}.bind(this))},extractStyleSrcs:function(b){return(b.match(this.MatchAllStyleSrc)||[]).map(function(a){return(a.match(this.MatchOneStyleSrc)||["",""])[1]}.bind(this))},extractSytleContents:function(b){return(b.match(this.MatchAllStyleContent)||[]).map(function(a){return(a.match(this.MatchOneStyleContent)||["",""])[1]}.bind(this))},isClosed:false,close:function(){if(!this.isClosed){this.isClosed=true;if(this.isLoad){this.destroyControl();this.destroyEvent();this.destroyDOM()}}}});var loadMiniCart=true;var TopMenu2016=Class.create();Object.extend(TopMenu2016.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")},getSuggestions:function(d,c){return Mtime.Component.Ajax.request(siteServiceUrl,"Mtime.Service.Pages.UtilityService","GetSuggestionKeywords",[d],c,"/service/utility.msi","get","20000")},addRegisterDayBonus:function(c,d){Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)}},MainNavPageType:{NotSet:0,Home:1,News:2,Theater:3,Community:4,Movie:5,Mall:6,Live:7},options:{type:1,mainNavPage:0,actionUrl:siteSearchUrl+"/search/",timer:1,showSearchBoxHrefs:["http://theater.mtime.com","http://news.mtime.com/pix","http://i.mtime.com","http://group.mtime.com","http://my.mtime.com","http://piao.mtime.com","http://mall.mtime.com"],pageSearchControlSearchTip:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeData();this.initializeEvent()},initializeField:function(){this.isInitialize=false;this.isInitializeManager=false;this.type=topMenuValues.mainNavType=="Channel"?0:1;this.mainNavPage=topMenuValues.mainNavPage;this.initScrollTop=document.documentElement.scrollTop||document.body.scrollTop},initializeDOM:function(){this.topMenuRegion=$("topMenuRegion");if(!this.topMenuRegion){this.topMenuRegion=$("topbar")}if(this.topMenuRegion){this.addDOM()}},destroyDOM:function(){this.removeDOM();if(this.topMenuRegion){this.topMenuRegion=null}},initializeData:function(){if(!this.topMenuRegion){return}this.topMenuValues=topMenuValues;this.server.getUser(function(g){if(g&&g.value){var h=g.value;this.isLogin=h.userId>0?true:false;this.user={isLogin:this.isLogin,id:h.userId,nickname:h.nickName,homeUrl:h.homeUrl,blogUrl:h.blogUrl,headSrc:h.headSrc,isSaveEmail:h.isSaveEmail,isAutoExit:h.isAutoExit,signupTime:h.signupTime,email:h.email,cityId:h.cityId,cityName:h.cityName,isAnniversary:h.isAnniversary,authorizeUrl:typeof h.authorizeUrl==="undefined"?"":h.authorizeUrl,isVirtual:typeof h.isVirtual==="undefined"?false:h.isVirtual,enableMobileLogin:true,customizeMenus:typeof h.CustomizeMenus==="undefined"?null:h.CustomizeMenus,headSrc128:typeof h.headSrc128==="undefined"?"":h.headSrc128,shortNickName:typeof h.shortNickName==="undefined"?"":h.shortNickName,currentXP:typeof h.currentXP==="undefined"?"0":h.currentXP,level:typeof h.level==="undefined"?"0":h.level,hasPassword:h.hasPassword};var f,e=Globals.getParam("redirectUrl");if(e&&e.trim().length>0){f=e}else{f=encodeURIComponent(location.href)}this.message={receiveCount:h.receiveCount,promptCount:h.promptCount,noticeCount:h.noticeCount,allCount:h.allCount,unreadCount:h.receiveCount+h.promptCount+h.noticeCount};this.urls={mytime:siteMcUrl,signIn:siteUrl+"/member/signin/?redirectUrl="+f,signUp:siteUrl+"/member/signup/?redirectUrl="+f,signOut:siteUrl+"/member/signout/?redirectUrl="+f,siteHelp:siteUrl+"/help/",forgetPasswordUrl:h.forgetPasswordUrl};this.unreadMsgCount=h.allCount;this.render()}}.bind(this))},render:function(){if(this.mainNavPage===this.MainNavPageType.Home&&this.bgLink&&this.topMenuValues&&this.topMenuValues.bgStartDate&&this.topMenuValues.bgEndDate){var d=new Date();var c=new Date(this.topMenuValues.bgEndDate.getFullYear(),this.topMenuValues.bgEndDate.getMonth(),this.topMenuValues.bgEndDate.getDate(),23,59,59);if(this.topMenuValues.bgStartDate<d&&d<c){if(this.topMenuValues.bgUrl){this.bgLink.href=this.topMenuValues.bgUrl;this.bgLink.target="_blank";this.bgLink.addClassName("linkpoint")}else{this.bgLink.href="javascript:void(0)";this.bgLink.removeClassName("linkpoint")}if(this.topMenuValues.bgSrc&&this.topMenuValues.bgSrc.length>0){this.topRegion.style.backgroundImage="url("+this.topMenuValues.bgSrc+")";this.topRegion.style.backgroundPosition="center top";this.topRegion.style.backgroundRepeat="no-repeat"}if(this.topMenuValues.bgHeight>0){this.topRegion.style.height=this.topMenuValues.bgHeight+"px"}if(this.topMenuValues.logoBGColor){this.logoRegion.style.backgroundColor=this.topMenuValues.logoBGColor}if(this.topMenuValues.searchTip){this.pageSearchControlSearchTip=this.topMenuValues.searchTip}}}this.initializeControl()},initializeEvent:function(){if(this.closeButton){this.onClickCloseButtonHandler=this.onClickCloseButton.bindAsEventListener(this);this.closeButton.observe("click",this.onClickCloseButtonHandler)}if(this.searchButton){this.onClickSearchButtonHandler=this.onClickSearchButton.bindAsEventListener(this);this.searchButton.observe("click",this.onClickSearchButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.closeButton){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler)}},initializeControl:function(){if(!this.miniCart&&this.miniCartRegion){this.miniCart=new MiniCart2016({container:this.miniCartRegion,isLogin:this.user.isLogin})}if(!this.userMenu&&this.userLoginRegion){this.userMenu=new UserMenu2016({container:this.userLoginRegion,menu:this.userLoginRegion,userInfo:this.user,urls:this.urls})}if(!this.messageMenu&&this.userMessageRegion){this.messageMenu=new MessageMenu2016({container:this.userMessageRegion,message:this.message,user:this.user,isLogin:this.user.isLogin})}if(!this.appdownloadMenu&&this.appDownloadRegion){this.appdownloadMenu=new AppDownloadMenu({container:this.appDownloadRegion})}var d=0;if(this.mainNavPage==3){d=2}else{if(this.mainNavPage==6){d=4}else{if(this.mainNavPage==2){d=5}}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl2016({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:d})}if(typeof ManagerExecuter!=="function"){var c=[]}else{manager=new ManagerExecuter({managerRegion:this.topMenuRegion,user:this.user,urls:this.urls,customizeMenus:this.user.customizeMenus})}},addDOM:function(){this.topMenuRegion.setAttribute("pn","M16_HeadNav");var q=Builder.node("dl",{className:"headbarnav"});var k="";var p="";var m="";var o="";var n="";var j="";var l="";if(this.type===0){if(this.mainNavPage==this.MainNavPageType.Home){k="cur"}if(this.mainNavPage==this.MainNavPageType.Theater){p="cur"}if(this.mainNavPage==this.MainNavPageType.Mall){m="cur"}if(this.mainNavPage==this.MainNavPageType.News){o="cur"}if(this.mainNavPage==this.MainNavPageType.Movie){n="cur"}if(this.mainNavPage==this.MainNavPageType.Community){j="cur"}if(this.mainNavPage==this.MainNavPageType.Live){l="cur"}}q.appendChild(Builder.node("dd",{className:k},[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Index')",pan:"M16_HeadNav_LeftNav_Index"},["首页",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:p},[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Theater')",pan:"M16_HeadNav_LeftNav_Theater"},["购票",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:m},[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Mall')",pan:"M16_HeadNav_LeftNav_Mall"},["正版商城",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:o},[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_News')",pan:"M16_HeadNav_LeftNav_News"},["新闻",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:l},[Builder.node("a",{href:"http://live.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Live')",pan:"M16_HeadNav_LeftNav_Live"},["直播",Builder.node("i"),Builder.node("em",["NEW"])])]));q.appendChild(Builder.node("dd",{className:n},[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Recent')",pan:"M16_HeadNav_LeftNav_Recent"},["发现",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:j},[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Community')",pan:"M16_HeadNav_LeftNav_Community"},["社区",Builder.node("i")])]));q.appendChild(Builder.node("dd",{className:j},[Builder.node("a",{href:"http://vip.mtime.com/",onclick:"headTrackClick('M17_HeadNav_LeftNav_Vip')",pan:"M17_HeadNav_LeftNav_Vip"},["会员",Builder.node("i")])]));this.headerTopLeftRegion=q;this.logoRegion=Builder.node("h1",{onclick:"headTrackClick('M16_HeadNav_MiddleNav')",pan:"M16_HeadNav_MiddleNav"},[Builder.node("a",{title:"Mtime时光网",href:"http://www.mtime.com"},["Mtime时光网"])]);this.searchTypeRegion=Builder.node("div",{className:"selctsearch"},[Builder.node("strong",["全部"]),Builder.node("i"),Builder.node("span",["|"])]);this.searchTypeListRegion=Builder.node("div",{className:"selectshow",style:"display:none;"},[Builder.node("ul",[Builder.node("li",{searchtype:"0",pan:"M16_HeadNav_Search_type0",className:"__r_c_"},["全部"]),Builder.node("li",{searchtype:"1",pan:"M16_HeadNav_Search_type1",className:"__r_c_"},["电影"]),Builder.node("li",{searchtype:"3",pan:"M16_HeadNav_Search_type3",className:"__r_c_"},["影人"]),Builder.node("li",{searchtype:"2",pan:"M16_HeadNav_Search_type2",className:"__r_c_"},["影院"]),Builder.node("li",{searchtype:"4",pan:"M16_HeadNav_Search_type4",className:"__r_c_"},["商品"]),Builder.node("li",{searchtype:"5",pan:"M16_HeadNav_Search_type5",className:"__r_c_"},["新闻"])])]);this.suggestRegion=Builder.node("div",{className:"showsearch",style:"display:none;"});this.bgLink=Builder.node("a",{href:"javascript:void(0)",className:"searchlink"},[]);this.searchRegion=Builder.node("div",{className:"topsearch"},[Builder.node("div",{className:"searchshadow"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:"",autocomplete:"off"}),Builder.node("a",{href:"javascript:void(0);",className:"button __r_c_",title:"搜索",pan:"M16_HeadNav_Search_Btn_0"},[Builder.node("i")])]),this.suggestRegion]);this.miniCartRegion=Builder.node("div",{className:"headcart",id:"shopbox",onclick:"headTrackClick('M16_HeadNav_MiniCart_Region')",pan:"M16_HeadNav_MiniCart_Region"});this.userLoginRegion=Builder.node("div",{className:"headtool none",id:"loginbox"});this.userMessageRegion=Builder.node("div",{className:"headtool",id:"emailbox",style:"display:none;"},[Builder.node("i",{className:"line"}),Builder.node("a",{href:"javascript:void(0)",className:"headmessage",id:"headmessage"},[Builder.node("i",{}),Builder.node("em",{className:"ico-message"})])]);this.appDownloadRegion=Builder.node("div",{className:"headtool",id:"appDownloadbox"});if(this.type===0){this.addChannelDOM()}else{this.addDetailDOM()}},removeDOM:function(){if(this.type===0){}else{}},addChannelDOM:function(){var d=this.buildSearchContainer();var c=Builder.node("div",{className:"headbar",id:"headbar"},[this.logoRegion,this.headerTopLeftRegion,this.miniCartRegion,this.userLoginRegion,this.userMessageRegion,this.appDownloadRegion,d]);this.topMenuRegion.appendChild(c);this.topMenuRegion.addClassName("fixed");document.body.style.paddingTop="60px";if(this.mainNavPage==this.MainNavPageType.Home){this.topRegion=Builder.node("div",{className:"tophead"},[this.bgLink,this.searchRegion]);d.hide()}this.topRegion&&this.topMenuRegion.appendChild(this.topRegion)},addDetailDOM:function(){var d=this.buildSearchContainer();var c=Builder.node("div",{className:"headbar head-mini",id:"headbar"},[this.logoRegion,this.headerTopLeftRegion,this.miniCartRegion,this.userLoginRegion,this.userMessageRegion,this.appDownloadRegion,d]);this.topMenuRegion.appendChild(c)},addChannelSearchDOM:function(){var b="";if(this.mainNavPage==this.MainNavPageType.Home){this.topRegion=Builder.node("div",{className:"tophead"},[this.bgLink,this.searchRegion])}else{b=this.buildSubChannelNavDOM();this.topRegion=Builder.node("div",{className:"topmenu"},[Builder.node("div",{className:"topmenuer fix"},[b,this.searchRegion])])}this.topMenuRegion.appendChild(this.topRegion)},buildSubChannelNavDOM:function(){var d=["","","新闻首页","购票首页","社区首页","发现首页","商城首页"];var c=Builder.node("dl",{className:"menunav",id:"submenunav"});c.appendChild(Builder.node("dd",{className:"on"},[Builder.node("a",{href:"javascript:void(0);"},[d[this.mainNavPage]])]));return c},buildSearchContainer:function(){this.searchButton=Builder.node("a",{href:"javascript:void(0)",className:"headzoom"},[Builder.node("em",{className:"zoom",title:"搜索",pan:"M16_HeadNav_Sreach_Tool_Zoom"})]);var b=Builder.node("div",{className:"headtool",id:"searchbox"},[this.searchButton,Builder.node("div",{className:"headsearch",style:"width:395px;display:none;"},[this.searchRegion])]);return b},onClickSearchButton:function(m){var l=Event.element(m);var j=l.up("div.headtool");var o=j.down("div.headsearch");var n=Position.page(this.logoRegion)[0];var k=Position.page(j)[0];var h=k-n;if(l.tagName.toUpperCase()=="EM"){if(l.hasClassName("cancel")){l.removeClassName("cancel");l.addClassName("zoom");l.title="搜索";l.setAttribute("pan","M16_HeadNav_Sreach_Tool_Zoom");o.hide();this.logoRegion.show();headTrackClick("M16_HeadNav_Sreach_Tool_Cancel")}else{if(l.hasClassName("zoom")){l.removeClassName("zoom");l.addClassName("cancel");l.title="取消";l.setAttribute("pan","M16_HeadNav_Sreach_Tool_Cancel");this.logoRegion.hide();o.show();$(o).setStyle({width:h+"px"});headTrackClick("M16_HeadNav_Sreach_Tool_Zoom")}}}},topscrollWindow:function(){var o=document.documentElement.scrollTop||document.body.scrollTop;var n=o>this.initScrollTop?"down":"up";this.initScrollTop=o;var h=this.topMenuRegion?this.topMenuRegion.getBoundingClientRect().top:NaN;var l=window.innerheight||document.documentElement.clientHeight;var m=false;if(h+l<0){m=false}else{m=true}var j=$$("div.headbar")[0];var k=j.getHeight();if(n==="up"&&!m){if(this.topMenuRegion.hasClassName("fixed")){}else{j.setStyle({position:"fixed",top:"0px"});this.topMenuRegion.addClassName("fixed")}if(j.hasClassName("head-mini")){}else{document.body.style.paddingTop=k+"px";j.addClassName("head-mini")}}if(j.hasClassName("head-mini")){if(n==="down"){this.topMenuRegion.removeClassName("fixed");j.removeClassName("head-mini");j.setStyle({position:"",top:""});document.body.style.paddingTop=""}else{if(o<=0){this.topMenuRegion.removeClassName("fixed");j.removeClassName("head-mini");j.setStyle({position:"",top:""});document.body.style.paddingTop=""}}}},removeChannelDOM:function(){},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var MessageMenu2016=Class.create();Object.extend(MessageMenu2016.prototype,{server:{getUnreadMessages:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","GetUnreadMessages",[true],b,"/Service/Message.msi","get","20000")},addRegisterDayBonus:function(c,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)},clearAllUnreadCount:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","ClearAllUnreadCount",[],b,"/Service/Message.msi","get","20000")}},options:{container:null,user:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeEvent();this.render()},initializeEvent:function(){Event.observe(this.container,"click",this.onClickContainer.bindAsEventListener(this))},render:function(){this.getUnReadMessage();if(this.isLogin){this.container.show()}},onClickContainer:function(h){var g=Event.element(h);var j=this.container.down("#headmessage");var k=this.container.down('[_type="message"]');if(g.tagName.toUpperCase()=="EM"&&g.hasClassName("close")){if(k){k.remove();j.removeClassName("cur");this.server.clearAllUnreadCount(null)}var m=getCookie("virtualuser");if(this.user.isVirtual&&(typeof(m)==="undefined"||m!=="virtualuser")){setCookie("virtualuser","virtualuser")}}else{if(!this.user.isAnniversary){var l=siteMcUrl+"/message/usermessage/";$redirect(l)}}},getUnReadMessage:function(){this.server.getUnreadMessages(function(w){var p=null;var r=this.user.isAnniversary;if(r){p=Builder.build('<p _type="anniversary"><em title="关闭"></em><a href="javascript:void(0);" onclick="return false;">注册周年积分奖励，点击领取</a></p>')}var s=this.user.isVirtual;var x=s;if(s){var z=getCookie("virtualuser");if(z&&z==="virtualuser"){x=false}}var t=this.container.down('[_type="message"]');t&&t.remove();t=null;if((!w||!w.value)&&!p&&!x){return}else{if(w&&w.value){t=Builder.build(w.value);var y='<em class="close" id="closeMessageTip"></em>'+t.innerHTML;t.addClassName("headtip");t.addClassName("message-tip");t.innerHTML=y;this.container.down(".headmessage").addClassName("cur")}else{t=Builder.build('<div class="headtip message-tip" _type="message"><em class="close" id="closeMessageTip"></em></div>')}this.container.appendChild(t);t.style.display="block";if(p){t.appendChild(p);var v=this.user.nickname;var q=this.closeMsg.bind(this);var u=this.container;var o=this.server.addRegisterDayBonus;Event.observe(p,"click",function(){var a=new Dialog({title:"注册周年积分奖励!",windowClassName:"w420",content:"<div>亲爱的"+v+"，感谢你对时光网一年的支持，时光网有你更精彩。</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"领取",buttonStyle:"btn_blue mr12",callback:function(){var b=u.down('[_type="anniversary"]');b&&b.remove();var c=u.down("#headmessage");var d=t.immediateDescendants();if(d.length===0){t.remove();c.removeClassName("cur")}o();a.close()}}]})}.bind(this))}if(x&&this.user.authorizeUrl){var A=Builder.build(String.format('<p><em title="关闭"></em>完善信息后，服务更安全 <a href="{0}">立即设置</a></p>',this.user.authorizeUrl));t.appendChild(A);this.container.down(".m_message_notice").remove()}}}.bind(this))},closeMsg:function(d){var e=Event.element(d);var f=e.up(0);if(e.tagName.toUpperCase()=="EM"&&f&&f.tagName.toUpperCase()=="P"){this.container.down('[_type="message"]').remove()}}});var UserMenu2016=Class.create();Object.extend(UserMenu2016.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(j,m,l,k,o,n,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[j,m,l,k,o,n],h,"/utility/managerservice.m","get","10000")},signOut:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","SignOut",[],b,"/Service/Manager.msi","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")},getXpAndLevel:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteGoodsServiceUrl,"Mtime.Ecommerce.Services","GetUserXpAndLevel",[d],c,"/Member.api","get","60000")},getCouponsForLogin:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetCouponsForLogin",[],b,"/Service/Manager.msi","get","10000","")}},options:{container:null,menu:null,userInfo:null,urls:null,onSignInCallback:null,hasLoadXpAndLevel:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeData();this.initializeDOM();this.render();this.initializeEvent()},initializeData:function(){this.useProtocol="https";this.findPwdHref="https://passport.mtime.com/findpwd/phone";this.bindMobileHref="https://passport.mtime.com/unitelogin/validationmobile"},initializeDOM:function(){this.loginNameText=Builder.node("input",{type:"text",value:"输入电子邮箱/手机号",className:"tip"});this.passwordText=Builder.node("input",{type:"password",value:"",className:"tip"});this.autoLoginCheckBox=Builder.node("i",{className:"ico_m_check"},[""]);this.signInButton=Builder.node("a",{href:"javascript:void(0);",className:"btnblue __r_c_",pan:"M16_HeadNav_User_SignInBtn"},["登录"]);this.registerButton=Builder.node("a",{href:"javascript:void(0);",className:"btngrey __r_c_",pan:"M16_HeadNav_User_RegBtn"},["成为会员"]);this.vcodeText=Builder.node("input",{type:"text",value:"输入验证码",className:"tip"});this.refreshVcodeButton=Builder.node("a",{href:"javascript:void(0);"},["刷新"]);this.signOutButton=Builder.node("a",{href:"javascript:void(0);",className:"btngrey __r_c_",pan:"M16_HeadNav_User_Signout"},["登出"])},initializeEvent:function(){Event.observe(this.menu,"click",this.onClickMenu.bind(this));if(this.userInfo.isLogin){this.initializeLoginEvent()}else{this.initializeUnloginEvent();this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},onClick:function(f){var g=Event.pointerX(f);var h=Event.pointerY(f);var e=Event.element(f);if(this.unloginRegion&&this.menu!==e.up("div#loginbox")&&this.unloginRegion!==e.up("div.login-tip")&&!Position.within(this.container,g,h)&&!Position.within(this.unloginRegion,g,h)){if(!this.userInfo.isLogin){if(this.unloginRegion.visible()){this.headLoginButton.removeClassName("cur");this.unloginRegion.hide()}}}},initializeLoginEvent:function(){this.signOutButton.observe("click",this.onClickSignOutButton.bind(this))},initializeUnloginEvent:function(){new Textbox({text:this.loginNameText,watermarkText:"输入电子邮箱/手机号"});new Textbox({text:this.passwordText,watermarkText:""});new Textbox({text:this.vcodeText,watermarkText:"输入验证码"});this.autoLoginCheckBox.observe("click",this.onClickAutoLoginCheckBox.bind(this));this.signInButton.observe("click",this.onClickSignInButton.bind(this));this.registerButton.observe("click",this.onClickRegisterButton.bind(this));this.headSigninButton.observe("click",this.onClickRegisterButton.bind(this));this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.loginNameText,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passwordText,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.refreshVcodeButton,"click",this.refreshVcodeHandler);document.onkeydown=function(){var b=window.event;if(typeof b!=="undefined"&&b.keyCode===13){this.onClickSignInButton()}}.bind(this)},render:function(){if(this.userInfo.isLogin){var j=Builder.node("i",{className:"line"});var m=Builder.node("a",{href:"javascript:void(0);",title:this.userInfo.nickname,onclick:"headTrackClick('M16_HeadNav_User_Nickname')",pan:"M16_HeadNav_User_Nickname"},[Builder.node("img",{height:"44",width:"44",src:this.userInfo.headSrc128,alt:this.userInfo.nickname}),Builder.node("em",[this.getShowNickName(this.userInfo.nickname)]),Builder.node("b",{}),Builder.node("i",{})]);this.userNickname=m;var l=Builder.node("div",{className:"headlogin"},[this.userNickname]);this.menu.appendChild(j);this.menu.appendChild(l);this.loginRegion=this.buildLoginDOM();this.loginRegion.hide();this.container.appendChild(this.loginRegion);if(!this.userInfo.isAutoExit){this.autoLoginCheckBox.addClassName("ico-checkend")}this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.menu,contentRegion:this.loginRegion,onOverCallback:this.onOverCallback.bind(this),onOutCallback:this.onOutCallback.bind(this),outTimeout:1});(function(){var a=document.createElement("script");a.src="http://static1.mtime.cn/components/1.x-latest/script/mtime/mtime-vip.js";a.onload=function(){new MtimeVIPComponent.VIPBootstrap().start()};document.getElementsByTagName("head")[0].appendChild(a)})()}else{var j=Builder.node("i",{className:"line"});var g=Builder.node("a",{href:"javascript:void(0);",onclick:"headTrackClick('M16_HeadNav_User_SignIn')",pan:"M16_HeadNav_User_SignIn"},["登录",Builder.node("i")]);var h=Builder.node("a",{href:"javascript:void(0);",onclick:"headTrackClick('M16_HeadNav_User_Reg')",pan:"M16_HeadNav_User_Reg"},["注册"]);this.headLoginButton=g;this.headSigninButton=h;var l=Builder.node("div",{className:"headunlogin"},[this.headLoginButton,Builder.node("em"),this.headSigninButton]);this.menu.appendChild(j);this.menu.appendChild(l);this.unloginRegion=this.buildUnloginDOM();var k=Builder.build('<dl class="otherlogin"><dt>使用第三方登录</dt><dd><a href="'+this.useProtocol+'://passport.mtime.com/unitelogin/dispatch/weibo/web/" title="新浪" class="ico-sina __r_c_" pan="M16_HeadNav_User_SignInSina"></a><a href="'+this.useProtocol+'://passport.mtime.com/unitelogin/dispatch/qq/web/" title="QQ" class="ico-qq __r_c_" pan="M16_HeadNav_User_SignInQq"></a></dd></dl>');this.unloginRegion.appendChild(k);this.unloginRegion.hide();this.container.appendChild(this.unloginRegion);this.loginNameText.value=this.userInfo.email}this.menu.removeClassName("none")},getShowNickName:function(o){var m=0,j=o.split(""),q=[];var n=5*2;var l=j.length;var p=o.replace(/[^\u0000-\u00ff]/g,"aa").length;if(p>n){for(var k=0;k<l;++k){if(j[k].charCodeAt(0)<299){m++;if(m<n-1){q.push(j[k])}}else{m+=2;if(m<=n-2){q.push(j[k])}}}o=q.join("")+"..."}return o},showVcodeRegion:function(){$(this.vcodeText.parentNode).show();if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down();this.vcodeImageRegion.show()}}.bind(this))}else{this.refreshVcode();this.vcodeImageRegion.show()}},hideVcodeRegion:function(){if(this.vcodeText){$(this.vcodeText.parentNode).hide()}if(this.vcodeImageRegion){this.vcodeImageRegion.hide()}},onOverCallback:function(){if(!this.userNickname.hasClassName("cur")){this.userNickname.addClassName("cur");if(this.userInfo.isLogin&&!this.hasLoadXpAndLevel){this.server.getXpAndLevel(this.userInfo.id,function(b){if(b&&b.value){$("topMenuLevelContainer").innerHTML="M"+b.value.level;this.hasLoadXpAndLevel=true}this.server.getCouponsForLogin(function(a){if(a&&a.value){if(a.value.totalCount==0){$("myCouponsCount").innerHTML="我的优惠券"}else{$("myCouponsCount").innerHTML="我的优惠券("+a.value.totalCount+")"}if(a.value.mtimeCardCount==0){$("myMtimeCardCount").innerHTML="我的礼品卡"}else{$("myMtimeCardCount").innerHTML="我的礼品卡("+a.value.mtimeCardCount+")"}if(a.value.willEndCount>0){$("couponWillEndContainer").show();$("urlEcommerceOrMovie").href=a.value.urlEcommerceOrMovie;$("willEndCount").innerHTML=a.value.willEndCount}else{$("couponWillEndContainer").hide()}}}.bind(this))}.bind(this))}}},onOutCallback:function(){if(this.userNickname.hasClassName("cur")){this.userNickname.removeClassName("cur")}},isShowing:function(){return this.loginRegion.style.display!="none"},onClickMenu:function(d){var c=Event.element(d);if(c.up("div.headtip")){return}if(this.userInfo.isLogin){if(this.isShowing()){this.loginRegion.hide();this.onOutCallback()}else{this.loginRegion.style.display="block";this.onOverCallback()}}else{if(this.unloginRegion.visible()){this.headLoginButton.removeClassName("cur");this.unloginRegion.hide()}else{this.unloginRegion.style.display="block";this.headLoginButton.addClassName("cur")}}},onClickRegisterButton:function(){if(typeof sitePassportUrl==="undefined"){sitePassportUrl="http://passport.mtime.com"}sitePassportUrl=this.useProtocol+"://passport.mtime.com";var b=sitePassportUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},onClickVcodeText:function(){if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down()}}.bind(this))}},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeText.value="";this.vcodeText.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var c=this.loginNameText.value.trim(),d=true;if(this.userInfo.enableMobileLogin){if(!Validator.Email.test(c)&&!Validator.MobilePhone.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}else{if(!Validator.Email.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}return d},checkPassword:function(){var c=this.passwordText.value,d=true;if(!Validator.Password.test(c)){$(this.passwordText.parentNode).addClassName("false");d=false}else{$(this.passwordText.parentNode).removeClassName("false")}return d},checkVcode:function(){var d=this.vcodeText.value.trim(),c=true;if(!d){$(this.vcodeText.parentNode).addClassName("false");c=false}else{$(this.vcodeText.parentNode).removeClassName("false")}return c},onClickSignInButton:function(){var e=this.loginNameText.value;var f=$encodePassword(this.passwordText.value);var d=!this.autoLoginCheckBox.hasClassName("ico-checkend");if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.server.signIn(e,f,true,d,this.vcodeId||"",this.vcodeId?this.vcodeText.value:"",function(a){this.lock=false;if(a&&a.value){if(a.value.success){this.callback&&this.callback(a.value);location.reload()}else{if(a.value.isShieldStatus){this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.showResetPasswordDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.showVcodeRegion();if(!a.value.vcodeValid){$(this.vcodeText.parentNode).addClassName("false")}return}else{this.hideVcodeRegion();this.vcodeId=null}$(this.loginNameText.parentNode).addClassName("false");$(this.passwordText.parentNode).addClassName("false")}}}}}}.bind(this))}},onClickSignOutButton:function(){this.server.signOut(function(b){if(b&&b.value){location.reload()}})},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPasswordDialog:function(b){this.needResetPwdDialog=new Dialog({title:"很抱歉，账户已被冻结",windowClassName:"w375",content:'<div class="yahei px14 tc bold">由于长时间未登录，账户已被临时冻结。<br/>请点击按钮，重新邮件激活。 </div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"立即激活",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onClickAutoLoginCheckBox:function(){if(this.autoLoginCheckBox.hasClassName("ico-checkend")){this.autoLoginCheckBox.removeClassName("ico-checkend")}else{this.autoLoginCheckBox.addClassName("ico-checkend")}},buildLoginDOM:function(){var j=Builder.node("div",{className:"headtip user-tip"});var f=Builder.node("div",{className:"my-name"});var g=Builder.node("dl",{className:"my-business fix"});var h=Builder.node("div",{className:"my-couptip",id:"couponWillEndContainer",style:"display:none;"});var k=Builder.node("ul",{className:"my-app"});f.appendChild(Builder.node("a",{className:"my-pic __r_c_",href:siteMcUrl,pan:"M16_HeadNav_User_UserHead"},[Builder.node("img",{src:this.userInfo.headSrc128,width:"96",height:"96"})]));f.appendChild(Builder.node("dl",[Builder.node("dt",[Builder.node("a",{href:siteMcUrl,pan:"M16_HeadNav_User_Nickname",className:"__r_c_"},[this.userInfo.shortNickName]),Builder.node("a",{href:"http://vip.mtime.com/myprivilege",pan:"M16_HeadNav_User_Vip",className:"__r_c_"},Builder.node("span",{id:"topMenuLevelContainer"},["M0"]))]),Builder.node("dd",[Builder.node("a",{href:"http://vip.mtime.com/myprivilege/",pan:"M16_HeadNav_User_Privilege",className:"__r_c_"},["我的特权"]),Builder.node("i",{className:"c_a5 mlr5"},["|"]),Builder.node("a",{href:"http://vip.mtime.com/gift/",pan:"M16_HeadNav_LoginBox_VipsuserPackage",className:"__r_c_"},["会员礼包"])])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/",pan:"M16_HeadNav_User_Ticket",className:"__r_c_"},["电影票订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/ecommerce/orderList/",pan:"M16_HeadNav_User_Order",className:"__r_c_"},["商品订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myCouponsCount",href:siteMcUrl+"/account/voucher/",pan:"M16_HeadNav_User_Voucher",className:"__r_c_"},["我的优惠券"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myMtimeCardCount",href:siteMcUrl+"/account/moviecard/",pan:"M16_HeadNav_User_Card",className:"__r_c_"},["我的礼品卡"])]));h.appendChild(Builder.node("i"));h.appendChild(Builder.node("p",{pan:"M16_HeadNav_User_Coupend",className:"__r_c_"},["您有",Builder.node("b",{id:"willEndCount"},["0"]),"张优惠券即将过期 ",Builder.node("a",{href:siteMcUrl+"/account/voucher/ecommerce/",id:"urlEcommerceOrMovie"},["点击查看"])]));k.appendChild(Builder.node("li",{pan:"M16_HeadNav_User_MyMtime",className:"__r_c_"},[Builder.node("p",["我的：",Builder.node("a",{href:siteMcUrl+"/app/blog/"},["博客"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/group/"},["群组"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/movie/"},["电影"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/favorite/"},["收藏"])]),Builder.node("p",["游戏：",Builder.node("a",{href:siteMcUrl+"/app/card/"},["卡片大富翁"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/quiz/"},["猜电影"])])]));if(this.userInfo.hasPassword==true){k.appendChild(Builder.node("li",{className:"fix"},[this.signOutButton,Builder.node("a",{href:siteMcUrl+"/profile/basic/",className:"__r_c_",pan:"M16_HeadNav_User_ChangeId"},["修改资料"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/profile/password/",className:"__r_c_",pan:"M16_HeadNav_User_ChangePw"},["密码"])]))}else{k.appendChild(Builder.node("li",{className:"fix"},[this.signOutButton,Builder.node("a",{href:siteMcUrl+"/profile/basic/",className:"__r_c_",pan:"M16_HeadNav_User_ChangeId"},["修改资料"])]))}j.appendChild(f);j.appendChild(g);j.appendChild(h);j.appendChild(k);return j},buildUnloginDOM:function(){var b=Builder.node("div",{className:"headtip login-tip"},[Builder.node("dl",{className:"logintool"},[Builder.node("dt",[Builder.node("strong",["为爱电影的人"])," For people who love movies"]),Builder.node("dd",{className:"userlogin"},[Builder.node("ul",[Builder.node("li",{className:""},[Builder.node("label",{className:"name"},["用户名："]),this.loginNameText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:""},[Builder.node("label",{className:"password"},["输入密码："]),this.passwordText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:"",style:"display:none"},[Builder.node("label",{className:"code"},["输入验证码："]),this.vcodeText,Builder.node("i",{className:"ico_false"},[])])]),Builder.node("p",{className:"usertip"},[Builder.node("a",{href:this.findPwdHref,target:"_blank",className:"fr"},["忘记密码"]),this.autoLoginCheckBox,"记住我"]),Builder.node("div",{className:"loginbtn"},[this.signInButton,this.registerButton])])])]);return b},buildVcodeImageDOM:function(c){var d=Builder.node("li",{className:"codetxt"},[Builder.node("span",{id:"img_vcode"},[Builder.node("img",{width:"90",height:"45",src:c,style:"cursor:pointer",className:"v_m mr6"})]),this.refreshVcodeButton]);return d}});var CityMenu=Class.create();Object.extend(CityMenu.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{userInfo:null,items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"热门",container:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){this.headPanel=$(this.container);this.closeNode=Builder.node("span",{className:"btn_close fr"},["关闭"]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"text"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on",_v:"热门"},["热门",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"A-G"},["A-G",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"H-L"},["H-L",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"M-T"},["M-T",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"W-Z"},["W-Z",Builder.node("b",[" "])])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip",style:"display:none;width: 560px; position: absolute; top: 35px; right: 0px;"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,Builder.node("div",{className:"citysearch"},[this.searchCityText]),this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));this.headPanel.appendChild(Builder.node("span",{className:"currcity"},["我在："+this.userInfo.cityName]));this.headPanel.appendChild(Builder.node("i",{className:"ico_city"}));this.headPanel.parentNode.insertBefore(this.bodyPanel,this.headPanel);var c=this.tab.childNodes;for(var d=0;d<c.length;d++){Event.observe(c[d],"click",function(e){var a=e.target||e.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(f){f.className=""});a.className="on";var b=a.readAttribute("_v");this.order=b;this.reload(b)}}.bind(this))}this.headPanel.style.display="block"},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler);Event.observe(this.closeNode,"click",this.onCloseHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onHeadPanelClickHandler&&Event.stopObserving(this.headPanel,"click",this.onHeadPanelClickHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.container,e,f)&&!Position.within(this.bodyPanel,e,f)){if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}}},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(k){this.contentBox.update();var f=null;switch(k){case"热门":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);break;case"A-G":if(!this.content.AG){f=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(f,this.content.regRxpAG)}this.contentBox.update(this.content.AG);break;case"H-L":if(!this.content.HL){f=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(f,this.content.regRxpHL)}this.contentBox.update(this.content.HL);break;case"M-T":if(!this.content.MT){f=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(f,this.content.regRxpMT)}this.contentBox.update(this.content.MT);break;case"W-Z":if(!this.content.WZ){f=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(f,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);break;default:break}var j=this.contentBox.getElementsByTagName("li");for(var h=0,g=j.length;h<g;h++){Event.observe(j[h],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(h,k){var o=new StringBuilder();for(var l=0,j=k.length;l<j;l++){var n=k[l];var m=h.findAll(function(a){return a.initial===n}).sortBy(function(a){return -a.VisitedTimes});if(m.length>0){o.append(this.createOptions(m,n))}}return o.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("热门");this.cityAutoComplete=new CityAutoComplete({text:this.searchCityText,textWatermarkText:"直接输入城市或城市拼音",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(f){var h=this.contentBox.getElementsByTagName("li");for(var g=0,e=h.length;g<e;g++){if(h[g].className==="on"){this.command(h[g].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(k,h,j){var l=Builder.node("div");var m=new StringBuilder();m.append('<div class="city_list2 clearfix">');m.append('<span class="fl w30 bold mt5">'+h+"</span>");m.append("<ul>");for(var g=0;g<k.length;g++){if(j&&g!==0&&(g%this.HOTROWSIZE===0)){m.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}m.append(this.optionTemplate.evaluate(k[g]))}m.append("</ul>");m.append("</div>");return m.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(b){b&&Event.stop(b);if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}else{this.show();this.headPanel.addClassName("oncity")}},isShowing:function(){return(this.bodyPanel.style.display!="none")},show:function(){this.bodyPanel.show()},hide:function(){this.bodyPanel.hide()},command:function(f){if(f!==null){setCookie("DefaultCity-CookieKey",f);var h="http://theater."+mtimeCookieDomain+"/[^/]+";var k=["/","/cinema/","/movie/","/ecoupon/","/ticket/","/card/","/movie/\\d+/","/discount/","/discount/information/","/discount/coupon/","/movie/lastday/"];var j=null;var g=k.find(function(a){var b=new RegExp(("^"+h+"("+a+")$").replace(/\//g,"\\/"));j=(location.protocol+"//"+location.host+location.pathname).match(b);return j&&j.length==2});if(!g){location.reload()}this.server.getTheaterCityHomeURL(f,function(a){if(a&&a.value){if(g){$redirect(a.value.replace(/\/$/,"")+j[1])}else{if(callbackUrl){$redirect(callbackUrl)}else{$redirect(a.value)}}}})}},getCitys:function(o,l){var m=[];for(var n=0;n<l.length;n++){var k=l[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<l.length){var q=l.length-m.length;for(var p=0;p<o.length;p++){if(q===0){break}if(!l.include(o[p].Id)){m.push(o[p]);q--}}}return m},getCity:function(h,e){for(var f=0,g=h.length;f<g;f++){if(e==h[f].Id){return h[f]}}return null}});var CityAutoComplete=Class.create();Object.extend(Object.extend(CityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(e){this.active=false;var f=this.listRegion.getElementsByTagName("li");var d=f.length;if(d>e&&e>=0){return $(f[e])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="输入中文/拼音或按&uarr;&darr;选择"}else{if(d>0){this.listTipText=c+"，按拼音数排序"}else{this.listTipText="对不起，找不到："+c}}},renderList:function(l,o){var j='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+o+"</ul></div></div>";this.listRegion.update(j);var n=this.listRegion.getElementsByTagName("li");for(var k=0,h=n.length;k<h;k++){var m=n[k];m.style.cursor="pointer";Event.observe(m,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(m,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(m,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(n.length>0){n[0].className="on"}}});var TopMenuNavigationMenu=Class.create();Object.extend(TopMenuNavigationMenu.prototype,{options:{menuRegion:null,contentRegion:null,onOverCallback:null,onOutCallback:null,overTimeout:1,outTimeout:100},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent()},initializeField:function(){this.outMenuTimer=null;this.overMenuTimer=null},initializeEvent:function(){this.onOverMenuHandler=this.onOverMenu.bindAsEventListener(this);this.menuRegion.observe("mouseover",this.onOverMenuHandler);this.contentRegion.observe("mouseover",this.onOverMenuHandler);this.onOutMenuHandler=this.onOutMenu.bindAsEventListener(this);this.menuRegion.observe("mouseout",this.onOutMenuHandler);this.contentRegion.observe("mouseout",this.onOutMenuHandler);this.onClickMenuHandler=this.onClickMenu.bindAsEventListener(this);this.menuRegion.observe("click",this.onClickMenuHandler)},destroyEvent:function(){this.menuRegion.stopObserving("mouseover",this.onOverMenuHandler);this.menuRegion.stopObserving("mouseout",this.onOutMenuHandler);this.menuRegion.stopObserving("click",this.onClickMenuHandler)},onOverMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.overMenuTimer=FunctionExt.defer(function(){this.onMenuOverCallback()},this.overTimeout,this)},onOutMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.outMenuTimer=FunctionExt.defer(function(){this.onMenuOutCallback()},this.outTimeout,this)},handleOverMenuTimer:function(){if(this.overMenuTimer!==null){clearTimeout(this.overMenuTimer);this.overMenuTimer=null}},handleOutMenuTimer:function(){if(this.outMenuTimer!==null){clearTimeout(this.outMenuTimer);this.outMenuTimer=null}},onClickMenu:function(b){this.onOverMenu()},onMenuOverCallback:function(){if(!this.contentRegion.visible()){this.contentRegion.show()}if(this.onOverCallback){this.onOverCallback()}},onMenuOutCallback:function(){if(this.contentRegion.visible()){this.contentRegion.hide()}if(this.onOutCallback){this.onOutCallback()}}});var SearchAutoComplete=Class.create();Object.extend(Object.extend(SearchAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},getEntry:function(c){var d=null;if(c>=0){d=$(this.listRegion.childNodes[c])}return d},getOption:function(d){var f=null;var e=this.idFieldName;this.searchDatas.each(function(a){if(a[e]==d){f=a;throw $break}});return f},render:function(){if(this.getSearchDataCallback!==null){this.getSearchDataCallback(function(b){this.searchDatas=b;this.doRender()}.bind(this))}else{this.doRender()}},getMoreLists:function(){var m=this.searchDatas,l=null,j=new StringBuilder(),k=0;for(var h=0,g=m.length;h<g;h++){l=m[h];j.append(this.createListItem(l));k++;this.searchIndex=h}this.entryCount+=k;return j.toString()},renderList:function(c,d){this.listRegion.innerHTML=d},onClickText:function(){this.render()},createListItem:function(d){var c=this.itemTemplate.evaluate(d);c=c.replace("<em >被查询 0 次</em>","");return c}});var MiniCart2016=Class.create();Object.extend(MiniCart2016.prototype,{server:{getCartList:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","GetMiniCartList",[true],b,"/Service/Trade.p","get","60000")},removeCartItem:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","RemoveCartItemsBySkus",[d],c,"/Service/Trade.p","get","60000")}},options:{container:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var d=Builder.node("i",{className:"icocart"});Event.observe(d,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});var c=Builder.node("b",{className:"numcart",id:"emGoodsCount",style:"display:none;"},[0]);Event.observe(c,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});this.headPanel.appendChild(d);this.headPanel.appendChild(c);this.bodyPanel=Builder.node("div",{className:"headtip headcart-tip",style:"display:none;"});this.bodyPanel.appendChild(this.getNoDataElement());this.headPanel.appendChild(this.bodyPanel)},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.bodyPanel,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this)});this.deleteRegionClickHandler=this.deleteRegionClick.bind(this);this.bodyPanel.observe("click",this.deleteRegionClickHandler)},render:function(){this.server.getCartList(function(c){if(c&&c.value){this.clearBodyPanel();var d=c.value.count;if(d>0){$("emGoodsCount").innerHTML=d;$("emGoodsCount").show()}else{$("emGoodsCount").hide()}if(d>0){this.bodyPanel.innerHTML=c.value.html}else{this.bodyPanel.appendChild(this.getNoDataElement())}}}.bind(this))},deleteRegionClick:function(k){var j=Event.element(k);var m=j.readAttribute("method");while(!m&&j!=document.body){j=j.up();m=j.readAttribute("method")}if(!m){return}var h=j.readAttribute("actid");var o=j.readAttribute("sku").split("|");var n="";for(var l=0;l<o.length;l++){if(n.length>0){n+=","}n+=o[l]+"|"+h+"|false"}this.server.removeCartItem(n,function(a){if(a&&a.value&&a.value.success){this.render()}}.bind(this))},destroyEvent:function(){this.onHeadPanelOverHandler&&Event.stopObserving(this.headPanel,"mouseover",this.onHeadPanelOverHandler);this.onHeadPanelOutHandler&&Event.stopObserving(this.headPanel,"mouseout",this.onHeadPanelOutHandler)},destroyPanel:function(){this.goodsListPanel=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},getNoDataElement:function(){return Builder.node("p",{className:"tips"},["您的购物车还是空的，赶快选购哦。"])},clearBodyPanel:function(){this.bodyPanel.update("")},onHeadPanelOver:function(b){},onHeadPanelOut:function(b){}});var AppDownloadMenu=Class.create();function AppDownloadQRcodeJsonp(b){document.getElementById("qrcodeimg").innerHTML=('<img src="'+b.imageUrl+'" alt="扫描二维码下载APP" />')}Object.extend(AppDownloadMenu.prototype,{server:{getQcode:function(b){return Mtime.Component.Ajax.crossDomainCallBack("http://www.mtime.com","","",[true],b,"/api/download-app?callback=AppDownloadQRcodeJsonp","get","60000")}},options:{container:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var b=Builder.node("i",{className:"line"});this.appMenuRegion=Builder.node("a",{href:"javascript:void(0)",className:"headqr",onclick:"headTrackClick('M16_HeadNav_Qrcode_Btn')",pan:"M16_HeadNav_Qrcode_Btn"},[Builder.node("i",{}),Builder.node("em",{className:"ico-app"}),Builder.node("span",{},["App下载"]),Builder.node("b",{})]);this.appContentRegion=Builder.node("div",{className:"headtip qrcode-tip",style:"display:none;"},[Builder.node("a",{href:"http://feature.mtime.com/mobile/",target:"_blank",onclick:"headTrackClick('M16_HeadNav_Qrcode_Down')",pan:"M16_HeadNav_Qrcode_Down"},[Builder.node("i",{className:"qrcode",id:"qrcodeimg"})]),]);this.headPanel.appendChild(b);this.headPanel.appendChild(this.appMenuRegion);this.headPanel.appendChild(this.appContentRegion)},render:function(){this.server.getQcode(function(b){}.bind(this))},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.appContentRegion,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this),outTimeout:1})},onHeadPanelOver:function(){if(!this.appMenuRegion.hasClassName("cur")){this.appMenuRegion.addClassName("cur")}},onHeadPanelOut:function(){if(this.appMenuRegion.hasClassName("cur")){this.appMenuRegion.removeClassName("cur")}},destroyEvent:function(){},destroyPanel:function(){this.appContentRegion=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()}});var headTrackClick=function(c){var d="M16_HeadNav";if(typeof tracker!="undefined"){tracker.trackClick(d,c)}};var topMenu=null;var manager=null;function initializeManager(b){topMenu=new TopMenu2016(b)}function initializeManager2016(b){topMenu=new TopMenu2016(b)}function reinitializeManager(){topMenu.close();topMenu.initializeUser()}var StaticManager=Class.create();StaticManager.prototype={options:{mainNavigaionType:-1,subNavigaionType:-1,isMini:false,isChannelFooter:false,is2011MiniFooter:false,showTopSearch:true,showTopSearchInChannel:false,useNewNavigation:true},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},server:{createSubscriber:function(d,c){return Mtime.Component.Ajax.request(siteChannelServiceUrl,"Mtime.Channel.Pages.DatabaseService","CreateSubscriber",[d],c,"/service/Database.mcs","get","20000")}},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load();this.render()},initializeField:function(){},initializeDOM:function(){this.topRegion=$("top");this.bottomRegion=$("bottom")},destroyDOM:function(){this.topRegion=null;this.bottomRegion=null;this.iptEMail=this.btnSubscribe=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.btnSubscribe){this.btnSubscribe.stopObserving("click",this.onClickBtnSubscribeHandler)}if(this.iptEMailTextbox){this.iptEMailTextbox.close()}},load:function(){if(document.documentElement.clientWidth<=1024){$(document.documentElement).addClassName("scroll1024")}},render:function(){this.renderManager();this.renderHeader();this.renderNavigatorBar();this.renderFooter()},renderHeader:function(){},renderManager:function(){if(this.useNewNavigation){if(typeof initializeManager2016!=="function"){$loadJs("/js/2014/topmenu.js",function(){initializeManager2016({})}.bind(this))}else{initializeManager2016({})}}else{initializeManager({})}},renderNavigatorBar:function(){},renderFooter:function(){if(this.bottomRegion){if(this.isMini){this.renderMiniFooter()}else{this.renderMtimeFooter()}}},renderMtimeFooter:function(){var b=['<div class="footout">','<span class="topline"></span>','<div class="footinner clearfix">','<div class="fotlogo">',"<dl>",'<dt><a href="http://www.mtime.com" title="Mtime时光网">Mtime时光网</a></dt>','<dd class="clearfix"><a href="http://jobs.mtime.com/">加入我们</a><a href="http://feature.mtime.com/help/contact.htm" class="ml30">联系我们</a></dd>','<dd class="clearfix"><a href="http://group.mtime.com/help/">站务论坛</a><a href="http://my.mtime.com/reportError/" class="ml30">问题反馈</a></dd>','<dd class="clearfix"><a href="http://feature.mtime.com/help/rules.htm">社区准则</a><a href="http://www.mtime.com/sitemap.htm" class="ml30">网站地图</a></dd>','<dd class="clearfix"><a href="http://feature.mtime.com/help/privacy.htm">隐私政策</a><a href="http://en.mtime.com/" class="ml30">English</a></dd>',"</dl>",'<i class="line"></i>',"</div>",'<div class="fotmap">','<dl style="width:42px;">',"<dt>栏目</dt>",'<dd><a href="http://news.mtime.com/">新闻</a></dd>','<dd><a href="http://theater.mtime.com/">影院</a></dd>','<dd><a href="http://mall.mtime.com">商城</a></dd>','<dd><a href="http://www.mtime.com/community/">社区</a></dd>',"</dl>",'<dl style="width:185px;">',"<dt>推荐</dt>",'<dd><a href="http://movie.mtime.com/recent/">观影指南</a><a href="http://movie.mtime.com/boxoffice/" class="ml30">电影票房</a></dd>','<dd><a href="http://news.mtime.com/conversation/">时光对话</a><a href="http://video.mtime.com/trailer/" class="ml30">新片预告</a></dd>','<dd><a href="http://movie.mtime.com/all/list/index.html">特色榜单</a><a href="http://my.mtime.com/app/quiz/" class="ml30">电影猜猜猜</a></dd>','<dd><a href="http://news.mtime.com/fun/">全球拾趣</a><a href="http://my.mtime.com/app/card/" class="ml30">卡片大富翁</a></dd>',"</dl>","<dl>","<dt>关注我们</dt>",'<dd><a href="http://weibo.com/movietime?topnav=1&wvr=5&topsug=1" target="_blank" class="sina" title="新浪">新浪</a></dd>','<dd><a id="aWeiXinPicButton" href="javascript:void(0)" class="weixin" title="微信">微信</a></dd>','<dd><a href="http://www.mtime.com/rss/" target="_blank" class="rss" title="RSS">RSS</a></dd>',"</dl>",'<i class="line"></i>','<div id="divWeiXinPicContainer" class="my_layer none"> <em class="l_arrow">&nbsp;</em>','<div class="inner p15" style="width:195px;">',"<i></i>","<p>扫描二维码，微信实时关注时光网</p>","</div>","</div>","</div>",'<div class="fotweek">',"<dl>",(window.topMenuValues&&window.topMenuValues.footer)?topMenuValues.footer:"",'<dd class="input"><input id="iptEMail" type="text" value="邮箱地址" class="c_a5" /><a id="btnSubscribe" href="javascript:void(0)">订阅</a></dd>',"</dl>","</div>",'<div class="fothr">',"<dl>","<dt><strong>手机购票</strong> 方便 实惠</dt>",'<dd><a href="http://feature.mtime.com/mobile/" target="_blank"><i></i></a></dd>',"<dd>扫描二维码 下载客户端</dd>","</dl>","</div>","</div>","</div>"].concat(this.getMiniFooterHTMLArray());this.bottomRegion.innerHTML=b.join("");this.iptEMail=$("iptEMail");this.btnSubscribe=$("btnSubscribe");this.iptEMailTextbox=new Textbox({text:this.iptEMail,watermarkText:"邮箱地址",onKeypressCallback:this.onEnter.bind(this)});this.onClickBtnSubscribeHandler=this.orderWeekly.bindAsEventListener(this);this.btnSubscribe.observe("click",this.onClickBtnSubscribeHandler);this.aWeiXinPicButton=$("aWeiXinPicButton");this.divWeiXinPicContainer=$("divWeiXinPicContainer");this.divWeiXinPicContainer.hide();this.divWeiXinPicContainer.removeClassName("none");this.onWeiXinPicButtonHandler=this.clickWeiXinPicButton.bindAsEventListener(this);this.aWeiXinPicButton.observe("click",this.onWeiXinPicButtonHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},renderMiniFooter:function(){this.bottomRegion.innerHTML=this.getMiniFooterHTMLArray().join("")},getMiniFooterHTMLArray:function(){var b=['<div class="db_foot">',"<p>",'<span class="mr12">北京动艺时光网络科技有限公司</span>Copyright 2006-',new Date().getFullYear()," Mtime.com Inc. All rights reserved.<br>",'<a href="http://feature.mtime.com/help/icp.htm" target="_blank" class="mr12 ml12">京ICP证050715号</a> ','<a href="http://feature.mtime.com/help/videolicence.htm" target="_blank" class="mr12">网络视听许可证0108265号</a>','<a href="http://feature.mtime.com/help/network.htm" target="_blank" class="mr12">网络文化经营许可证</a>','<a href="http://feature.mtime.com/help/tvlicence.htm" target="_blank" class="mr12">广播电视节目制作经营许可证(京)字第1435号</a>',"<span>京公网安备：110105000744号</span>","</p>",'<div class="credible"><a href="http://feature.mtime.com/help/credible.htm" target="_blank" title="可信网站" class="credibler"></a><a href="http://feature.mtime.com/help/goodfaith.htm" target="_blank" title="诚信网站" class="goodfaith"></a></div>',"</div>"];return b},orderWeekly:function(){var b=$F(this.iptEMail);b=b.trim();if(b.length>0){if(!Validator.validateEmail(b)){$alert("请输入合法的邮箱地址！");this.iptEMail.focus();return}else{this.server.createSubscriber(b,this.onCreateSubScriberCallBack.bind(this))}}},onCreateSubScriberCallBack:function(){var b=orderResult;if(b&&b.value&&b.value.success){$alert("您已成功订阅周刊，您的邮箱将会定期收到最新一期的周刊。");this.iptEMail.value="请输入邮箱地址"}else{$alert("订阅周刊失败，请重试或联系管理员。")}},onEnter:function(b){switch(b.keyCode){case Event.KEY_RETURN:this.orderWeekly();Event.stop(b);break;default:break}},clickWeiXinPicButton:function(b){this.divWeiXinPicContainer.show()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.divWeiXinPicContainer,e,f)&&!Position.within(this.aWeiXinPicButton,e,f)){if(this.divWeiXinPicContainer.visible()){this.divWeiXinPicContainer.hide()}}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}};function f_navigationBarSearch(){var d=$("navSearchValueInput").value.Trim();var c=$F("navSearchTypeSelect");if(d!==""){window.open("/search/"+(c=="all"?"":c)+"?"+encodeURI(d),"_blank")}}var MessageDialog=Class.create();MessageDialog.prototype={MAX_COMMENT_COUNT:140,MAX_COMMENT_DESCRIPTION:"消息字数不应该大于{0}字",options:{toUserId:0,type:0},server:{load:function(d,c){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.MessageOperation","LoadForSendMessage2",[d],c,"/Utility/MessageOperation.m?Ajax_CallBack=true","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.VCodeOperation","RefreshVcode2",[],b,"/Utility/VCodeOperation.m?Ajax_CallBack=true","get","10000")},send:function(p,q,o,l,r,s,m,n,k){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.MessageOperation","SendMessage2",[p,q,o,l,r,s,m,n],k,"/Utility/MessageOperation.m?Ajax_CallBack=true","post","20000")},getUserJoinedGroups:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","GetUserJoinedGroups2",[],b,"/database/databaseService.m?Ajax_CallBack=true","get","20000")}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.server.load(this.toUserId,function(a){a=loadForSendMessageResult;if(a&&a.value){this.initializeData(a.value);if(!this.isLogin){$alert(String.format('很抱歉，你<a href="{0}">登录</a>后才能发送消息！',this.signInUrl),function(){this.close()}.bind(this))}else{if(this.isOwner){$alert("很抱歉，你不能给自己发送消息！",function(){this.close()}.bind(this))}else{if(this.isFriend&&this.type===1){$alert("你们已经是好友！",function(){this.close()}.bind(this))}else{if(this.messageConfig.FriendRequest&&this.type===1){$alert(String.format('<a href="{1}" target="_blank">{0}</a>不接收好友邀请消息！',this.toUserNickname,this.toUserHomeUrl),function(){this.close()}.bind(this))}else{if(this.messageConfig.InviteJoinGroup&&this.type===2){$alert(String.format('<a href="{1}" target="_blank">{0}</a>不接收群组邀请消息！',this.toUserNickname,this.toUserHomeUrl),function(){this.close()}.bind(this))}else{if(this.messageConfig.SendMessage&&!this.isFriend&&this.type==0){$alert(String.format('<a href="{1}" target="_blank">{0}</a>仅接收好友消息！',this.toUserNickname,this.toUserHomeUrl),function(){this.close()}.bind(this))}else{this.initializeControl();this.initializeEvent();this.render()}}}}}}}else{$alert("该用户不存在或被屏蔽，你不能给他发送消息！",function(){this.close()}.bind(this))}}.bind(this))},initializeField:function(){},initializeDOM:function(){},destroyDOM:function(){},initializeData:function(b){this.toUserNickname=b.toUserNickname;this.toUserHomeUrl=b.toUserHomeUrl;this.toUserAvatarSrc=b.toUserAvatarSrc;this.isLogin=b.isLogin;this.signInUrl=b.signInUrl;this.isOwner=b.isOwner;this.isFriend=b.isFriend;this.vcodeId=b.vcodeId;this.vcodeSrc=b.vcodeSrc;this.messageConfig=b.messageConfig},initializeControl:function(){this.dialog=new Dialog({windowStyle:"width:445px",content:Builder.node("div",[Builder.node("p",{id:"hint",className:"tl ml20 mtb10 c_red",style:"display:none;"}),Builder.node("div",{className:"table"},[Builder.node("div",{className:"t_r"},[Builder.node("div",{className:"td w52 pl15 pr15"},[Builder.node("a",{href:this.toUserHomeUrl,target:"_blank"},[Builder.node("img",{src:this.toUserAvatarSrc,className:"td",alt:this.toUserNickname})]),Builder.node("p",{className:"tc"},[Builder.node("a",{href:this.toUserHomeUrl,target:"_blank"},[this.toUserNickname])])]),Builder.node("div",{className:"td",style:"width:auto;"},[Builder.node("ul",{id:"layoutRegion"},[Builder.node("li",{className:"pb6"},[Builder.node("input",{id:"titleText",type:"text",className:"input_tx"})]),Builder.node("li",{className:"pb6"},[Builder.node("textarea",{id:"contentText",className:"bor_a5",style:"width: 330px; height: 60px;",cols:"50",rows:"4"})]),Builder.node("li",{className:"pb6",style:this.isFriend?"display:none":""},[Builder.node("input",{id:"vcodeText",type:"text",className:"input_tx v_m"}),Builder.node("img",{id:"vcodeImage",src:this.vcodeSrc,alt:"",className:"v_m ml6"}),Builder.node("a",{id:"refreshVcodeButton",href:"#",onclick:"return false;",className:"ml12"},["刷新"])]),Builder.node("li",{className:"pb6 c_a5"},["字数：",Builder.node("span",{id:"wordCountText"},["0"]),"/"+this.MAX_COMMENT_COUNT])])])])])]),buttonRegionClass:"mt15 tc pl15 pb15",buttons:[{title:"发送消息",buttonStyle:"btn_square_hover mr15",callback:this.onClickSendMessage.bind(this)},{title:"取 消",onmouseover:"this.className='btn_square_hover'",onmouseout:"this.className='btn_square'",buttonStyle:"btn_square",callback:function(b){if(this.cancelCallback){this.cancelCallback(b)}b.close()}.bind(this)}],readyCallback:this.onDialogReady.bind(this),closeCallback:this.onDialogClose.bind(this)})},onDialogReady:function(b){this.hint=b.getEl("hint");this.titleText=b.getEl("titleText");this.layoutRegion=b.getEl("layoutRegion");this.contentText=b.getEl("contentText");this.wordCountText=b.getEl("wordCountText");this.onKeyupContentTextHandler=this.onKeyupContentText.bind(this);this.contentText.observe("keyup",this.onKeyupContentTextHandler);this.vcodeText=b.getEl("vcodeText");this.vcodeImage=b.getEl("vcodeImage");this.refreshVcodeButton=b.getEl("refreshVcodeButton");this.onClickRefreshButtonHandler=this.onClickRefreshButton.bind(this);this.refreshVcodeButton.observe("click",this.onClickRefreshButtonHandler);this.vcodeImage.observe("click",this.onClickRefreshButtonHandler);if(this.type==1){this.titleText.value="加为好友";this.contentText.value="Hi，我想把你加为好友";this.onKeyupContentText()}if(this.type==2){$loadJs("/js/08/searchBox.js",function(){this.server.getUserJoinedGroups(function(a){var a=databaseServiceGetUserJoinedGroupsResult;if(a&&a.value){this.groups=a.value.List;if(this.groups.length>0){this.titleText.value="加入群组邀请";this.contentText.value="HI，欢迎加入我的群组！";this.onKeyupContentText();this.addGroupRegion(b)}else{$alert("你还未加入任何群组",function(){this.close()}.bind(this))}}}.bind(this))}.bind(this))}},addGroupRegion:function(b){this.layoutRegion.appendChild(Builder.node("li",{className:"pb6"},["请选择群组",Builder.node("p",{className:"mtb10"},[Builder.node("input",{id:"searchGroupText",type:"text",className:"mr5 input_tx gray",size:"30",value:"请输入群组名称进行搜索"})]),Builder.node("div",{className:"mt5 p6 bor_a5"},[Builder.node("ul",{id:"groupRegion",style:"height: 138px; overflow: auto; position:relative; zoom:1;",className:"lh18"})])]));this.searchGroupText=b.getEl("searchGroupText");this.groupRegion=b.getEl("groupRegion");this.groupSearchBox=new SearchBox({textId:this.searchGroupText.id,textWatermarkText:"请输入群组名称进行搜索",resultRegionId:this.groupRegion.id,itemTemplate:new Template('<li><input type="radio" value="#{Id}" name="groupList" title="#{Title}" #{IsChecked} #{IsDisabled} /><label for="#{Id}">#{Title}</label></li>'),searchDatas:this.groups,onClickResultRegion:null})},onDialogClose:function(b){this.refreshVcodeButton.stopObserving("click",this.onClickRefreshButtonHandler);this.vcodeImage.stopObserving("click",this.onClickRefreshButtonHandler);this.hint=null;this.titleText=null;this.wordCountText=null;this.contentText=null;this.vcodeText=null;this.vcodeImage=null;this.refreshVcodeButton=null;this.layoutRegion=null;if(this.searchGroupText){this.searchGroupText=null;this.groupRegion=null;this.groupSearchBox.close()}this.close()},onKeyupContentText:function(){var b=this.contentText.value.length;if(b>this.MAX_COMMENT_COUNT){this.contentText.value=this.contentText._value;return false}else{this.contentText._value=this.contentText.value}this.wordCountText.innerHTML=b},onClickSendMessage:function(){var l=this.titleText.value;var g=this.contentText.value;var m=this.vcodeText.value;if(l.length===0){this.setHint("请输入标题");return}if(g.length===0){this.setHint("请输入内容");return}if(g.length>this.MAX_COMMENT_COUNT){this.setHint(String.format(this.MAX_COMMENT_DESCRIPTION,this.MAX_COMMENT_COUNT));return}if(!this.isFriend&&m.length===0){this.setHint("请输入验证码");return}var h=0,j="";if(this.type===2){var k=this.getSelectedGroup();if(k===null){this.setHint("请选择群组");return}h=k.id;j=k.title}this.server.send(this.type,this.toUserId,l,g,m,this.vcodeId,h,j,this.onClickSendMessageCallback.bind(this))},onClickSendMessageCallback:function(c){c=sendMessageResult;if(c&&c.value){var d=c.value;if(!d.vcodeValid){this.onClickRefreshButton();this.setHint("验证码不正确，请重新输入");return}if(d.result!==1){switch(d.result){case 0:this.setHint("很抱歉，请先登录");return;case 2:this.setHint("未知错误，请稍候重试");return;case 3:this.setHint("很抱歉，该用户只接收好友消息");return;case 4:this.setHint("很抱歉，该用户不接收好友邀请消息");return;case 5:this.setHint("你们已经是好友");return;case 8:this.setHint("你已经发送过邀请，请耐心等待对方接受");return;case 9:this.setHint("对方在等待你的确认，请检查你的收件箱");return;case 10:this.setHint("对方已经拒绝了你的好友邀请");return;case 14:this.setHint("对不起，消息内容含有非法字符，请修改内容后再发送");return}}this.close()}},destroyControl:function(){if(this.dialog){this.dialog.close()}},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},render:function(){},onClickRefreshButton:function(){this.server.refreshVcode(function(b){b=refreshVcodeResult;if(b&&b.value){this.vcodeId=b.value.id;this.vcodeSrc=b.value.src;this.vcodeImage.src=this.vcodeSrc}}.bind(this))},setHint:function(b){this.hint.innerHTML=b;this.hint.show()},getSelectedGroup:function(){var l=this.groupRegion.descendants();if(l&&l.length>0){var k=null;for(var h=0,g=l.length;h<g;h++){k=l[h];if(k.checked){var j=k.value;var m=k.readAttribute("title");if(j.length>0&&m.length>0){return{id:j,title:m}}}}}return null},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}};var UserAvatar=Class.create();UserAvatar.prototype={options:{userId:0,avatarRegion:null,showMenuButton:null,menuRegion:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load();this.render()},initializeField:function(){this.outTimer=null},initializeDOM:function(){this.avatarRegion=$(this.avatarRegion);this.showMenuButton=$(this.showMenuButton);this.menuRegion=$(this.menuRegion)},destroyDOM:function(){},initializeEvent:function(){this.onOverAvatarHandler=this.onOverAvatar.bindAsEventListener(this);this.avatarRegion.observe("mouseover",this.onOverAvatarHandler);this.onOutAvatarHandler=this.onOutAvatar.bindAsEventListener(this);this.avatarRegion.observe("mouseout",this.onOutAvatarHandler);this.onClickAvatarHandler=this.onClickAvatar.bindAsEventListener(this);this.avatarRegion.observe("click",this.onClickAvatarHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.avatarRegion.stopObserving("mouseover",this.onOverAvatarHandler);this.avatarRegion.stopObserving("mouseout",this.onOutAvatarHandler);this.avatarRegion.stopObserving("click",this.onClickAvatarHandler)},load:function(){},render:function(){},onOverAvatar:function(b){this.handleOutTimer();if(!this.showMenuButton.visible()){this.avatarRegion.makePositioned();this.showMenuButton.show()}},handleOutTimer:function(b){if(this.outTimer!=null){clearTimeout(this.outTimer);this.outTimer=null}},onOutAvatar:function(b){this.outTimer=FunctionExt.defer(function(){this.hide()},0.01,this)},onClickAvatar:function(f){var e=Event.element(f);if(e==this.showMenuButton){if(!this.menuRegion.visible()){this.showMenuRegion()}else{this.hideMenuRegion()}}else{var d=e.readAttribute("action");if(d){switch(d){case"message":new MessageDialog({toUserId:this.userId});break}}}},hide:function(){this.showMenuButton.hide();this.hideMenuRegion();this.avatarRegion.undoPositioned()},showMenuRegion:function(){this.menuRegion.show();this.showMenuButton.className="profile_up"},hideMenuRegion:function(){this.menuRegion.hide();this.showMenuButton.className="profile_down"},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}};var UsersAvatars={avatars:[],close:function(){this.avatars.each(function(b){b.close()})},register:function(b){if(typeof Card==="undefined"){$loadJs("/js/2011/weibo/interactionPack.js",function(){this.registerInternal(b)}.bind(this))}else{this.registerInternal(b)}},registerInternal:function(h){if(typeof h==="undefined"){h="layout_contain"}if(Mtime.isArray(h)){for(var g=0,f=h.length;g<f;g++){avatarElement=$(h[g]);if(avatarElement&&!avatarElement.isAvatar){avatarElement.isAvatar=1;var e=new Card({mytimeContentRegion:avatarElement});this.avatars.push(e)}}}else{avatarElement=$(h);if(avatarElement&&!avatarElement.isAvatar){avatarElement.isAvatar=1;var e=new Card({mytimeContentRegion:avatarElement});this.avatars.push(e)}}Event.observe(window,"unload",this.close.bind(this))}};var RecommendToFriend=Class.create();RecommendToFriend.prototype={server:{refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","RefreshVcode10",[],b,"/database/databaseService.m?Ajax_CallBack=true","get","20000")},recommend:function(j,m,k,l,g,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","RecommendToFriend2",[j,m,k,l,g],h,"/database/databaseService.m?Ajax_CallBack=true","post","20000")},anonymousRecommend:function(q,n,o,s,p,r,t,u,l,m){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.DatabaseService","AnonymousRecommendToFriend2",[q,n,o,s,p,r,t,u,l],m,"/database/databaseService.m?Ajax_CallBack=true","post","20000")}},MAX_EMAIL_COUNT:10,MAX_CONTENT_COUNT:500,options:{isLogin:false,signInUrl:"",id:0,title:"",recommendType:1,recommendButton:"",associateRelatedId:0,okCallback:null,cancelCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.render()},initializeField:function(){},initializeDOM:function(){this.recommendButton=$(this.recommendButton)},destroyDOM:function(){this.recommendButton=null},initializeEvent:function(){if(this.recommendButton){this.onClickRecommendButtonHandler=this.onClickRecommendButton.bind(this);this.recommendButton.observe("click",this.onClickRecommendButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.recommendButton){this.recommendButton.stopObserving("click",this.onClickRecommendButtonHandler)}},initializeControl:function(){},destroyControl:function(){},render:function(){},show:function(){this.onClickRecommendButton()},onClickRecommendButton:function(){if(!this.isLogin){this.server.refreshVcode(function(){var b=refreshVcodeResult;if(b&&b.value){this.vcodeId=b.value.id;this.vcodeSrc=b.value.src;this.showRecommendDialog()}}.bind(this))}else{this.showRecommendDialog()}},showRecommendDialog:function(){this.dialog=new Dialog({windowClassName:"w330",content:Builder.node("div",{className:"ml20 mr20"},[Builder.node("p",{id:"recommendHint",className:"tl ml20 mtb10 c_red",style:"display:none;"}),"请输入几个朋友的邮箱",Builder.node("div",{id:"friendEmailRegion",style:"height: 115px; overflow: auto; position:relative; zoom:1;",className:"mt5"},[this.buildEmptyEmailNode(),this.buildEmptyEmailNode(),this.buildEmptyEmailNode(),this.buildEmptyEmailNode()]),Builder.node("p",{className:"mt10"},["附上你想说的话："]),Builder.node("textarea",{id:"recommendContentText",className:"block bor_a5 w265 c_666",style:"height: 45px;",cols:"41",rows:"3"},[this.getRecommendContent()]),this.buildAnonymousUserNode()]),buttonRegionClass:"mtb10 tc",buttons:[{title:"好了，推荐",buttonStyle:"btn_square_hover mr15",callback:this.onConfirmRecommend.bind(this)},{title:"取 消",buttonStyle:"btn_square",onmouseover:"this.className='btn_square_hover';",onmouseout:"this.className='btn_square';",callback:function(b){if(this.cancelCallback){this.cancelCallback(b)}b.close()}.bind(this)}],readyCallback:this.onDialogReady.bind(this),closeCallback:this.onDialogClose.bind(this)})},onDialogReady:function(b){this.hint=b.getEl("recommendHint");this.friendEmailRegion=b.getEl("friendEmailRegion");this.recommendContentText=b.getEl("recommendContentText");this.onClickFriendEmailRegionHandler=this.onClickFriendEmailRegion.bindAsEventListener(this);this.friendEmailRegion.observe("click",this.onClickFriendEmailRegionHandler);if(!this.isLogin){this.nicknameText=b.getEl("nicknameText");this.emailText=b.getEl("emailText");this.vcodeText=b.getEl("vcodeText");this.vcodeImage=b.getEl("vcodeImage");this.refreshVcodeButton=b.getEl("refreshVcodeButton");this.onClickRefreshVcodeHandler=this.onClickRefreshVcode.bind(this);this.vcodeImage.observe("click",this.onClickRefreshVcodeHandler);this.refreshVcodeButton.observe("click",this.onClickRefreshVcodeHandler)}},onDialogClose:function(b){this.friendEmailRegion.stopObserving("click",this.onClickFriendEmailRegionHandler);this.hint=null;this.friendEmailRegion=null;this.recommendContentText=null;if(!this.isLogin){this.vcodeImage.stopObserving("click",this.onClickRefreshVcodeHandler);this.refreshVcodeButton.stopObserving("click",this.onClickRefreshVcodeHandler);this.nicknameText=null;this.emailText=null;this.vcodeText=null;this.vcodeImage=null;this.refreshVcodeButton=null}},onConfirmRecommend:function(){var l=true;var h=this.getEmails();if(h.length===0){l=false;this.setHint("请输入朋友的Email地址")}else{if(!this.validEmails(h)){l=false;this.setHint("Email地址的格式不对，请检查")}}var k=this.recommendContentText.value.trim();if(k.length===0){l=false;this.setHint("请附上你想说的话")}else{if(k.bytelength()>(this.MAX_CONTENT_COUNT*2)){l=false;this.setHint(String.Format("对不起，你给朋友说的话不能超过{0}字",this.MAX_CONTENT_COUNT))}}if(!this.isLogin){var j=this.nicknameText.value;if(j.length===0){l=false;this.setHint("请输入你的名字")}var g=this.emailText.value;if(g.length===0){l=false;this.setHint("请输入你的邮箱")}else{if(!Validator.validateEmail(g)){l=false;this.setHint("你的邮箱的格式不对，请检查")}}var m=this.vcodeText.value;if(m.length===0){l=false;this.setHint("请输入验证码")}}if(l){if(!this.isLogin){this.server.anonymousRecommend(j,g,h.join("|"),this.recommendType,this.id,k,m,this.vcodeId,this.associateRelatedId,this.onConfirmRecommendCallback.bind(this))}else{this.server.recommend(h.join("|"),this.recommendType,this.id,k,this.associateRelatedId,this.onConfirmRecommendCallback.bind(this))}}},onConfirmRecommendCallback:function(){var d=recommendToFriendResult;if(d&&d.value){if(this.okCallback){this.okCallback(true)}this.dialog.close()}else{var c=d.value;switch(c){case -1:this.setHint("验证码错误，请重新输入");this.onClickRefreshVcode();break;case -2:this.setHint("推荐用户错误，请检查");break;case -3:this.setHint("收件人错误，请检查");break;case -4:this.setHint("关联对象错误，请检查");break;default:this.setHint("推荐失败，请稍候重试");break}}},onClickFriendEmailRegion:function(g){var h=10;var f=Event.element(g);if(f.tagName&&f.tagName.toLowerCase()=="input"){var e=this.friendEmailRegion.getElementsByTagName("input");if(e.length<this.MAX_EMAIL_COUNT){if(e[e.length-1]==f){this.friendEmailRegion.appendChild(this.buildEmptyEmailNode())}}}},getEmails:function(){var h=[];var f=this.friendEmailRegion.getElementsByTagName("input");if(f.length>0){for(var k=0,g=f.length;k<g;k++){var j=f[k];if(j.value.trim().length>0){h.push(j.value.trim())}}}return h.uniq()},validEmails:function(g){for(var h=0,e=g.length;h<e;h++){var f=g[h];if(!Validator.validateEmail(f)){return false}}return true},onClickRefreshVcode:function(){this.server.refreshVcode(function(b){if(b&&b.value){this.vcodeId=b.value.id;this.vcodeSrc=b.value.src;this.vcodeImage.setAttribute("src",b.value.src)}}.bind(this))},buildEmptyEmailNode:function(){return Builder.node("p",{className:"mb6"},[Builder.node("input",{type:"text",className:"bor_a5 w265"})])},buildAnonymousUserNode:function(){if(!this.isLogin){return Builder.node("div",[Builder.node("p",{className:"mt10"},[Builder.node("label",{htmlfor:"nicknameText"},["你的名字："])]),Builder.node("p",[Builder.node("input",{type:"text",id:"nicknameText",className:"input_tx w185"})]),Builder.node("p",{className:"mt10"},[Builder.node("label",{htmlfor:"emailText"},["你的邮箱地址："])]),Builder.node("p",[Builder.node("input",{type:"text",id:"emailText",className:"input_tx w185"})]),Builder.node("p",{className:"mt10"},[Builder.node("label",{htmlfor:"vcodeText"},["验证码："])]),Builder.node("p",[Builder.node("input",{type:"text",className:"input_tx",id:"vcodeText"}),Builder.node("img",{id:"vcodeImage",src:this.vcodeSrc,className:"v_m mlr10"}),Builder.node("a",{id:"refreshVcodeButton",href:"#",onclick:"return false;"},["刷新"])])])}else{return Builder.node("div")}},getRecommendContent:function(){switch(this.recommendType){case 0:return String.Format("“{0}”的主页很出色，推荐你来看看，和TA交个朋友。",this.title);break;case 1:return String.Format("《{0}》这部影片不错，你可以看看它的相关资料和影评。",this.title);break;case 2:return String.Format("“{0}”是我很喜欢的电影人，这里有他的介绍，一起来看看吧。",this.title);break;case 5:return String.Format("《{0}》的这张图片不错，推荐你来看看。",this.title);break;case 6:return String.Format("“{0}”的这张图片不错，推荐你来看看。",this.title);break;case 13:return String.Format("“{0}”的资料在这儿，推荐你来看看。",this.title);break;case 14:return String.Format("这儿有“{0}”的详细上映信息和影院介绍，快来看看吧。",this.title);break}return""},setHint:function(b){this.hint.innerHTML=b;this.hint.show()},closed:false,close:function(){if(!this.closed){if(this.dialog){this.dialog.close()}this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}};var BlogHeader=Class.create();Object.extend(BlogHeader.prototype,{options:{container:null,ownerId:"",ownerName:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},server:{saveTitle:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","ModifyTitle",[d],c,applicationUrl+"/service/blog.mb","get","20000")},saveDescription:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","ModifyDescription",[d],c,applicationUrl+"/service/blog.mb","get","20000")},setUsername:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","SetUsername",[d],c,applicationUrl+"/service/blog.mb","get","20000")},saveCustomNavigation:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","SaveCustomNavigation",[d],c,applicationUrl+"/service/blog.mb","get","20000")},getCustomNavigation:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetCustomNavigation",[d],c,applicationUrl+"/service/blog.mb","get","20000")}},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.initializeControl()},initializeDOM:function(){this.container=$(this.container);this.titleElement=this.container.down("h1");var f=this.container.down(".myurl").immediateDescendants();this.descriptionElement=f[0];this.urlElement=f[1];if(this.ownerId==this.ownerName&&this.ownerName==parseInt(this.ownerName,10)&&this.ownerName.length>5){var e=document.createElement("a");e.onclick="return false;";e.href="#";e.title="修改我的博客地址";e.innerHTML="修改我的博客地址";e.className="ml12";this.urlElement.appendChild(e);this.setUsernameButton=Element.extend(e)}var d=Builder.node("div",{style:"position: absolute; right: 10px; bottom: 5px; z-index: 10;"},[Builder.node("a",{id:"customNavigationButton",title:"修改导航",onclick:"return false;",href:"#"},["修改导航"]),Builder.node("span",[" | "]),Builder.node("a",{id:"customStyleButton",title:"个性化我的博客",onclick:"return false;",href:"#"},["个性化我的博客"])]);this.container.appendChild(d);this.customStyleButton=$("customStyleButton");this.customNavigationButton=$("customNavigationButton");this.customNavigationRegion=$("customNavigationRegion");this.subNavigationRegion=$("subNavigationRegion")},destroyDOM:function(){this.container=null;this.titleElement=null;this.descriptionElement=null;this.urlElement=null;this.customStyleButton=null;this.customNavigationButton=null;this.customNavigationRegion=null;this.subNavigationRegion=null},initializeEvent:function(){if(this.setUsernameButton){this.onClickSetUsernameButtonHandler=this.onClickSetUsernameButton.bindAsEventListener(this);this.setUsernameButton.observe("click",this.onClickSetUsernameButtonHandler)}this.onClickCustomStyleButtonHandler=this.onClickCustomStyleButton.bindAsEventListener(this);this.customStyleButton.observe("click",this.onClickCustomStyleButtonHandler);this.onClickCustomNavigationButtonHandler=this.onClickCustomNavigationButton.bindAsEventListener(this);this.customNavigationButton.observe("click",this.onClickCustomNavigationButtonHandler);this.onClickCustomNavigationRegionHandler=this.onClickCustomNavigationRegion.bindAsEventListener(this);this.customNavigationRegion.observe("click",this.onClickCustomNavigationRegionHandler)},destroyEvent:function(){if(this.setUsernameButton){this.setUsernameButton.stopObserving("click",this.onClickSetUsernameButtonHandler)}this.customStyleButton.stopObserving("click",this.onClickCustomStyleButtonHandler);this.customNavigationButton.stopObserving("click",this.onClickCustomNavigationButtonHandler);this.customNavigationRegion.stopObserving("click",this.onClickCustomNavigationRegionHandler)},initializeControl:function(){this.titleInPlaceEditor=new InPlaceEditor({element:this.titleElement,textSize:60,textClassName:"blog_txt",watermark:"点击这里，为自己的博客添加标题",okText:"保存",okClassName:"btn_blue2 ml12 mr12",cancelText:"取消",cancelClassName:"btn_gray2",hoverClassName:"blogname",onSaveCallback:this.onSaveTitleCallback.bind(this)});this.descriptionInPlaceEditor=new InPlaceEditor({element:this.descriptionElement,textSize:80,textClassName:"blog_txt",watermark:"点击这里，为自己的博客添加描述",okText:"保存",okClassName:"btn_blue2 ml12 mr12",cancelText:"取消",cancelClassName:"btn_gray2",hoverClassName:"blogname",onSaveCallback:this.onSaveDescriptionCallback.bind(this)})},destroyControl:function(){if(this.titleInPlaceEditor){this.titleInPlaceEditor.close()}if(this.descriptionInPlaceEditor){this.descriptionInPlaceEditor.close()}},load:function(){},onSaveTitleCallback:function(b){this.server.saveTitle(b,function(a){if(!a||!a.value){$alert("保存失败，请稍后重试!")}}.bind(this))},onSaveDescriptionCallback:function(b){this.server.saveDescription(b,function(a){if(!a||!a.value){$alert("保存失败，请稍后重试!")}}.bind(this))},onClickSetUsernameButton:function(){new Dialog({windowStyle:"width: 335px;",title:"修改博客地址",content:Builder.node("div",{className:"p12"},[Builder.node("div",["http://i.mtime.com/",Builder.node("input",{id:"usernameText",type:"text",className:"blog_txt",size:"18",maxlength:"15"})]),Builder.node("div",{id:"hint",style:"display:none;"},[Builder.node("p",{className:"bold"},["输入有误！"]),"正确的格式为：5-15位的字母或数字，需要以字母开头，不区分大小写"])]),buttonRegionClass:"pl12 pr12 tl mb12",buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:this.onSetUsernameCallback.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(b){if(this.cancelCallback){this.cancelCallback(b)}b.close()}.bind(this)}],readyCallback:this.onSetUsernameDialogReady.bind(this),closeCallback:this.onSetUsernameDialogClose.bind(this)})},onSetUsernameDialogReady:function(b){this.usernameText=b.getEl("usernameText");this.hint=b.getEl("hint")},onSetUsernameDialogClose:function(b){this.usernameText=null;this.hint=null},onSetUsernameCallback:function(d){var f=this.usernameText.value;if(f.length>0){var e=new RegExp("^[a-z][a-z0-9]{4,14}$","i").test(f);if(e){this.hint.hide();$confirm(String.format('<p class="mt10">请核对下面的博客地址，这将是你的永久博客地址（不能再次修改）</p><p class="mt5 bold blue2">http://i.mtime.com/{0}/</p>',f),function(){this.server.setUsername(f,function(a){if(a&&a.value){if(a.value.success){var c=this.urlElement.down();var b=c.href.replace(this.ownerId,f);c.href=b;c.innerHTML=b;this.setUsernameButton.hide();d.close()}else{$alert("抱歉，此地址已被别人使用，请尝试其他地址")}}else{$alert("连接失败，请稍后重试！")}}.bind(this))}.bind(this))}else{this.hint.show()}}},onClickCustomStyleButton:function(){if(manager){manager.show("个性化","开始")}},onClickCustomNavigationButton:function(){var l=this.subNavigationRegion.getElementsBySelector("a").pluck("innerHTML");var m=["个人资料","日志","相册","电影","好友","专辑","影评","微影评","群组","收藏","想看","留言","我参与"];var k=[0,7,8,12,11,19,22,21,3,10,23,9,5];var g=new StringBuilder();g.append("<ul>");for(i=0,count=m.length;i<count;i++){var h=l.include(m[i])?' checked="checked"':"";var j=(i<3)?'disabled="disabled"':"";if(i!=4){g.append(String.format('<li><input type="checkbox" id="chk{4}" name="customCheckBox"{0}{1} value="{2}"><label for="chk{4}">{3}</label></li>',h,j,k[i],m[i],i))}else{g.append(String.format('<li class="none"><input type="checkbox" id="chk{4}" name="customCheckBox"{0}{1} value="{2}"><label for="chk{4}">{3}</label></li>',h,j,k[i],m[i],i))}}g.append("</ul>");g.append('<div class="save_btn">');g.append('<input type="button" value="保 存" class="btn_square" method="save">&nbsp;');g.append('<input type="button" value="取 消" class="btn_square" method="cancel">');g.append("</div>");this.customNavigationRegion.innerHTML=g.toString();this.customNavigationRegion.show()},onClickCustomNavigationRegion:function(h){var g=Event.element(h);if(g){var k=g.readAttribute("method");if(k){var f=this.customNavigationRegion.getElementsBySelector('input[type="checkbox"]');switch(k){case"save":var j=f.findAll(function(a){return a.checked}).pluck("value");this.server.saveCustomNavigation(j,function(a){if(a&&a.value&&a.value.success){this.subNavigationRegion.innerHTML=a.value.subNavigationHTML;this.customNavigationRegion.hide()}}.bind(this));break;case"cancel":this.customNavigationRegion.hide();break;default:break}}}},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var BlogApplication=Class.create();Object.extend(BlogApplication.prototype,{name:"BlogApplication",server:{del:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","Delete",[d],c,applicationUrl+"/service/Blog.mb","post","20000")},substitutionData:function(d,c){Mtime.Component.Ajax.request(siteBlogUrl,"Mtime.Blog.Pages.UserService","GetSubstitutionData",[d],c,"/service/user.mb","get","20000")}},options:{},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeServerData();this.initializeDOM();this.initializeEvent();this.load();this.initializeControl();this.render()},initializeField:function(){},initializeServerData:function(){this.ownerId=blogVariables.ownerId;this.ownerName=blogVariables.ownerName;this.ownerNickname=blogVariables.ownerNickname;this.visitorId=blogVariables.visitorId;this.isFriend=blogVariables.isFriend;this.isOwner=this.ownerId==this.visitorId},initializeDOM:function(){this.headRegion=$("blogHeadRegion")},destroyDOM:function(){this.headRegion=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){},initializeControl:function(){if(this.headRegion&&this.isOwner){this.header=new BlogHeader({container:this.headRegion,ownerId:this.ownerId,ownerName:this.ownerName})}this.navigation=new BlogNavigation({owner:{ownerId:this.ownerId,ownerName:this.ownerName,ownerNickname:this.ownerNickname,visitorId:this.visitorId,isFriend:this.isFriend,isOwner:this.isOwner}});this.userDataModule=new UserDataModule({ownerId:this.ownerId})},destroyControl:function(){if(this.header){this.header.close()}if(this.navigation){this.navigation.close()}if(this.recommendToFriend){this.recommendToFriend.close()}},load:function(){stat.viewUser(this.ownerId)},render:function(){},getHash:function(){var b=document.location.hash;if(b===null||b==undefined){return""}else{if(b===""){return""}else{if(b.length===1&&b.charAt(0)==="#"){return""}else{if(b.length>1&&b.charAt(0)==="#"){return b.substring(1)}else{return b}}}}},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var BlogNavigation=Class.create();Object.extend(BlogNavigation.prototype,{options:{owner:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},server:{getCustomNavigation:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.BlogService","GetCustomNavigation",[d],c,applicationUrl+"/service/blog.mb","get","20000")}},initialize:function(b){this.setOptions(b);this.initializeDOM();this.load();this.render()},initializeDOM:function(){this.ownerRegion=$("ownerRegion");this.subNavigationRegion=$("subNavigationRegion");this.positionNavRegion=$("positionNavRegion")},destroyDOM:function(){},load:function(){},render:function(){var s=this.getPathToken().toLowerCase();if(s.length===0){s="home"}this.renderOwnerMenuNode();this.subNavRegion=this.subNavigationRegion.down("div.custom_nav");var q=this.subNavRegion.down().immediateDescendants(),p=[];for(var m=0,l=q.length;m<l;++m){var o=q[m].readAttribute("rel");if(o&&o==s){q[m].className="on"}}this.subNavMenus=p;var r=this.owner.isOwner?"我的博客":this.owner.ownerNickname+"的博客";var n="";if(s==="home"){n=String.format("<span>{0}</span>",r)}else{var k=applicationUrl+"/"+this.owner.ownerName+"/";n=String.format('<a href="{1}" title="{0}">{0}</a>&gt;&gt;<span>{2}</span>',r,k,this.getPositionTitle(s))}this.positionNavRegion.innerHTML=n},renderOwnerMenuNode:function(){var d=this.owner.isOwner?"我的博客":this.owner.ownerNickname+"的博客";var f=applicationUrl+"/"+this.owner.ownerName+"/";var e=String.format('<span class="before">&nbsp;</span><a href="{0}" title="{1}">{1}</a>',f,d);this.ownerRegion.innerHTML=e},getPathToken:function(){var j=["comment","watching"];var f=location.pathname.toLowerCase();if(f.length>0){if(f.startsWith(applicationUrl)){f=f.substring(applicationUrl.length+1);f=f.substring(f.indexOf("/")+1)}var k=f.indexOf("/");if(k>0){var g=f.split("/");var h=g[1];if(h&&j.include(h)){return h}else{return g[0]}}}return f},getPositionTitle:function(d){var c="";switch(d){case"blog":c="日志";break;case"album":case"photo":c="相册";break;case"favorite":c="收藏";break;case"friend":c="好友";break;case"group":c="群组";break;case"join":c="我参与";break;case"profile":c="个人资料";break;case"word":c="留言";break;case"list":c="专辑";break;case"card":c="卡片大富翁";break;case"feed":c="动态";break;case"rating":case"movie":c="电影";break;case"tag":c="标签";break;case"short_comment":c="微影评";break;case"comment":c="影评";break;case"watching":c="想看";break;default:break}return c},getSubNav:function(c){var d=["movie","comment","watching"];d.each(function(a){if(c.include(a)){return a}});return""},close:function(){this.destroyDOM()}});var InPlaceEditor=Class.create();Object.extend(InPlaceEditor.prototype,{options:{element:null,textSize:75,rows:1,textClassName:"ml9",watermark:"",okText:"保存",okClassName:"",cancelText:"取消",cancelClassName:"",hoverClassName:"txt04",onSaveCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.initializeControl();this.load()},initializeDOM:function(){this.element=$(this.element)},destroyDOM:function(){this.element=null},initializeEvent:function(){this.onclickListener=this.enterEditMode.bindAsEventListener(this);this.mouseoverListener=this.enterHover.bindAsEventListener(this);this.mouseoutListener=this.leaveHover.bindAsEventListener(this);Event.observe(this.element,"click",this.onclickListener);Event.observe(this.element,"mouseover",this.mouseoverListener);Event.observe(this.element,"mouseout",this.mouseoutListener)},destroyEvent:function(){Event.stopObserving(this.element,"click",this.onclickListener);Event.stopObserving(this.element,"mouseover",this.mouseoverListener);Event.stopObserving(this.element,"mouseout",this.mouseoutListener)},initializeControl:function(){},destroyControl:function(){},load:function(){this.setWatermarkText()},setWatermarkText:function(){var b=this.getText();if(b.length===0){this.setText(this.watermark)}},enterEditMode:function(b){if(this.saving){return}if(this.editing){return}this.editing=true;this.element.hide();this.editRegion=this.createEditRegion();this.element.parentNode.insertBefore(this.editRegion,this.element);if(b){Event.stop(b)}},enterHover:function(){if(!this.element.hasClassName(this.hoverClassName)){this.element.addClassName(this.hoverClassName)}},leaveHover:function(){if(this.element.hasClassName(this.hoverClassName)){this.element.removeClassName(this.hoverClassName)}},onClickOk:function(){var b=this.getEditText();this.setText(b);this.onSaveCallback.bind(this)(b,this.element);this.leaveEditMode()},onClickCancel:function(){this.leaveEditMode()},leaveEditMode:function(){this.removeEditRegion();this.leaveHover();this.element.show();this.setWatermarkText();this.editing=false;this.saving=false;this.oldInnerHTML=null},createEditRegion:function(){var g=document.createElement("div");var j=this.getText(),k=null;if(this.rows===1){k=document.createElement("input");k.type="text";k.value=j;k.size=this.textSize;k.className=this.textClassName}else{k=document.createElement("textarea");k.value=this.convertHTMLLineBreaks(j);k.rows=this.rows;k.size=this.textSize;k.className=this.textClassName}g.appendChild(k);this.textField=k;var h=document.createElement("input");h.type="button";h.onclick=this.onClickOk.bind(this);h.value=this.okText;h.className=this.okClassName;g.appendChild(h);var f=document.createElement("input");f.type="button";f.value=this.cancelText;f.onclick=this.onClickCancel.bind(this);f.className=this.cancelClassName;g.appendChild(f);return g},removeEditRegion:function(){if(this.editRegion){if(this.editRegion.parentNode){this.editRegion.parentNode.removeChild(this.editRegion)}this.editRegion=null;this.textField=null}},createEditField:function(){return textField},setText:function(b){this.element.innerHTML=this.convertToHTMLLineBreaks(b)},getText:function(){var b=this.element.innerHTML;if(this.watermark.toLowerCase()==b.toLowerCase()){return""}return b},getEditText:function(){return this.textField.value},convertHTMLLineBreaks:function(b){return b.replace(/<br>/gi,"\n").replace(/<br\/>/gi,"\n").replace(/<br([^>]+)>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p>/gi,"")},convertToHTMLLineBreaks:function(b){return b.replace(/\n/gi,"<br/>")},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var ReplyDialogBox=Class.create();Object.extend(Object.extend(ReplyDialogBox.prototype,DialogBox.prototype),{addDOM:function(){var c="";switch(this.positionType){case 0:c="directiontl";break;case 1:c="directiontr";break;case 2:c="directionbl";break;case 3:c="directionbr";break;default:c="directiontl";break}var d="";if(this.width&&this.width.length!==0){d="width:"+this.width}this.windowElement=Builder.node("div",{id:this.id,className:"reply_box",style:("display:none;"+d)},[Builder.node("div",{className:c}),Builder.node("div",{className:"member_air"},[Builder.node("div",{className:"ma_head"},[Builder.node("div",{className:"ma_head_left"},[]),Builder.node("div",{className:"ma_head_right"},[]),Builder.node("div",{className:"clear"})]),Builder.node("div",{className:"ma_body"},[this.content!==""?(typeof this.content==="string"?Builder.build(this.content):this.content):"",Builder.node("div",{id:this.buttonRegionId,className:"mt6"},[])]),Builder.node("div",{className:"ma_foot"},[Builder.node("div",{className:"ma_foot_left"},[]),Builder.node("div",{className:"ma_foot_right"},[]),Builder.node("div",{className:"clear"})])])]);this.initializeWindowElement()}});var HTMLObject=Class.create();Object.extend(HTMLObject.prototype,{options:{container:"",imageWidth:200},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvents()},initializeDOM:function(){this.container=$(this.container)},destroyDOM:function(){this.container=null},initializeEvents:function(){if(this.container){var k=this.container;var q=k.getElementsByTagName("img");for(var o=0,l=q.length;o<l;o++){var p=$(q[o]);p.hide()}this.containerSize=this.container.getDimensions();this.containerPos=Position.cumulativeOffset(this.container);for(var o=0,l=q.length;o<l;o++){var p=$(q[o]);p.show()}for(var o=0,l=q.length;o<l;o++){var p=$(q[o]);var s=this.onImageScale.bind(this,p);p.observe("load",s);this.onImageScale(p);var r=this.onImageError.bind(this,p);p.observe("error",r)}var n=k.getElementsByTagName("embed");if(n&&n.length>0){for(var o=0,l=n.length;o<l;o++){var m=$(n[o]);m.setAttribute("autostart",0)}}}},destroyEvents:function(){},render:function(){},getImageSize:function(g){var h=g.runtimeStyle;var j={width:h.width,height:h.height};h.width=h.height="auto";var k=g.width;var f=g.height;h.width=j.width;h.height=j.height;return{width:k,height:f}},onImageScale:function(d){if(!d._scale){if(d.width>this.imageWidth){d._scale=1;var e=Position.cumulativeOffset(d),f=0;if(e[0]<this.containerPos[0]){f=this.containerSize.width-20}else{f=this.containerPos[0]+this.containerSize.width-e[0]-40}if(d.width>f){d.height=f*d.height/d.width;d.width=f}}}},onImageError:function(b){if(!b._error){b._error=1;b.onerror=null;b.src=b.src}},close:function(){this.destroyEvents();this.destroyDOM()}});var Pager=Class.create();Pager.prototype={threshold:7,maxThreshold:10,options:{pageRegionId:"",pageIndex:1,pageSize:10,totalRecord:1,linkName:"Comments",callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent()},initializeDOM:function(){this.pageRegion=$(this.pageRegionId)},initializeEvent:function(){this.onClickPageRegionHander=this.onClickPageRegion.bindAsEventListener(this);this.pageRegion.observe("click",this.onClickPageRegionHander)},removeEvent:function(){this.pageRegion.stopObserving("click",this.onClickPageRegionHander)},render:function(s,y){this.pageIndex=parseInt(s,10);if(typeof y!=="undefined"){this.totalRecord=y}var x=this.threshold,o=this.maxThreshold,s=this.pageIndex,t=this.pageSize,y=this.totalRecord,r=Math.ceil(parseFloat(y/t));if(r>1){var q=new StringBuilder();q.append('<div class="pagenav tc" onclick="return false;">');if(s==1){q.append('<a href="#'+this.linkName+'" class="mr10 false" onclick="return false;">上一页</a>')}else{var v=s-1;q.append('<a href="#'+this.linkName+'" class="mr10 next" pageIndex="'+v+'" onclick="return false;">上一页</a>')}var w=0,n=r,u=-1;if(r<=o){w=1;n=r}else{if(s<x&&r>o){w=1;n=x;u=0}else{if(s>(r-x+1)){w=r-x+1;n=r;u=1}else{if(s>=x&&s<=(r-x+1)){w=s-2;n=s+2;u=2}}}}q.append(this._createPageNumberHTML(w,n,r,u,s));if(s==r){q.append('<a href="#'+this.linkName+'" class="mr10 false" onclick="return false;">下一页</a>')}else{var p=s+1;q.append('<a href="#'+this.linkName+'" class="mr10 next" pageIndex="'+p+'" onclick="return false;">下一页</a>')}q.append("</div>");this.pageRegion.update(q.toString())}else{this.pageRegion.update("")}},_createPageNumberHTML:function(s,k,o,r,p){var q=new StringBuilder(),m="",l="";switch(r){case 0:l=this._createBehindHTML(o);break;case 1:m=this._createFrontHTML();break;case 2:m=this._createFrontHTML();l=this._createBehindHTML(o);break;default:break}q.append(m);for(var n=s;n<=k;n++){if(p==n){q.append('<a href="#'+this.linkName+'" class="on" onclick="return false;">');q.append(n);q.append("</a>")}else{q.append('<a href="#'+this.linkName+'" class="num" onclick="return false;" pageIndex="'+n+'">');q.append(n);q.append("</a>")}}q.append(l);return q.toString()},_createBehindHTML:function(d){var c=new StringBuilder();c.append("<span>...</span>");c.append('<a class="num" href="#'+this.linkName+'" onclick="return false;" pageIndex="'+(d-1)+'">');c.append(d-1);c.append("</a>");c.append('<a class="num" href="#'+this.linkName+'" onclick="return false;" pageIndex="'+d+'">');c.append(d);c.append("</a>");return c.toString()},_createFrontHTML:function(){var b=new StringBuilder();b.append('<a class="num" href="#'+this.linkName+'" onclick="return false;" pageIndex="1">');b.append(1);b.append("</a>");b.append('<a class="num" href="#'+this.linkName+'" onclick="return false;" pageIndex="2">');b.append(2);b.append("</a>");b.append("<span>...</span>");return b.toString()},onClickPageRegion:function(e){var d=Event.element(e);var f=d.readAttribute("pageIndex");if(f&&f>0){this.callback(f,this)}},scrollToTop:function(b){setTimeout(function(){b.scrollIntoView()}.bind(this),100)},close:function(){this.removeEvent();this.pageRegion.update("");this.pageRegion=null}};var UserDataModule=Class.create();Object.extend(UserDataModule.prototype,{server:{getBloggerSimpleInfo:function(d,c){return Mtime.Component.Ajax.callBack("Mtime.Blog.Pages.UserService","GetBloggerSimpleInfo",[d],c,applicationUrl+"/service/user.mb","get","20000")}},options:{ownerId:0},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.load()},initializeDOM:function(){this.ownerAgeRegion=$("ownerAgeRegion");this.actionRegion=$("actionRegion")},destroyDOM:function(){this.ownerAgeRegion=null;this.completePercentRegion=null;this.actionRegion=null},initializeEvent:function(){if(this.actionRegion){this.onClickActionRegionHandler=this.onClickActionRegion.bindAsEventListener(this);this.actionRegion.observe("click",this.onClickActionRegionHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.actionRegion){this.actionRegion.stopObserving("click",this.onClickActionRegionHandler)}},load:function(){var b=this.ownerId===blogVariables.visitorId;if(this.ownerAgeRegion){if(this.ownerAgeRegion.innerHTML==""){this.server.getBloggerSimpleInfo(this.ownerId,function(a){if(a&&a.value){if(a.value.age){this.ownerAgeRegion.innerHTML=this.getAgeRegionHTML(a.value.age)}}}.bind(this))}}},getAgeRegionHTML:function(b){return String.format("{0}岁&nbsp;",b)},onClickActionRegion:function(e){var d=Event.element(e);if(d){var f=d.readAttribute("method");switch(f){case"message":new MessageDialog({toUserId:this.ownerId});break;case"friend":new MessageDialog({toUserId:this.ownerId,type:1});break;default:break}}},close:function(){this.destroyEvent();this.destroyDOM()}});