var Follow=Class.create();Object.extend(Object.extend(Follow.prototype),{server:{Follow:function(c,a,b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","Follow",[c],b,"/Service/Twitter.msi","get","20000",a)},UnFollow:function(b,a){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UnFollow",[b],a,"/Service/Twitter.msi","get","20000")},RemoveFromBlackList:function(b,a){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","RemoveFromBlackList",[b],a,"/Service/Twitter.msi","get","20000")}},options:{container:"",ischange:false,iscard:false,isuser:false,callback:null},setOptions:function(a){Object.extend(Object.extend(this,this.options),a)},initialize:function(a){this.setOptions(a);this.initializeDom();this.initializeEvent()},initializeDom:function(){this.container=$(this.container)},destroyDOM:function(){this.container=null;this.collectBoxId=null},initializeEvent:function(){this.clickRegionHandler=this.onClick.bind(this);this.container.observe("click",this.clickRegionHandler);Event.observe(window,"unload",this.close.bind(this))},onClick:function(c){var a=Event.element(c);var d=a.readAttribute("method");switch(d){case"aFollow":this.fTwitterId=a.readAttribute("ftwitterid");var b='<p class="bold">确定不再关注？</p>';this.closeFollow(a,b,"c");break;case"bFollow":this.fTwitterId=a.readAttribute("ftwitterid");var b='<p class="bold">确定取消关注？</p>';this.closeFollow(a,b,"d");break;case"cFollow":case"dFollow":this.fTwitterId=a.readAttribute("ftwitterid");this.server.Follow(this.fTwitterId,a,function(g){if(g&&g.value){switch(g.value){case -7:if(typeof Weibo!="undefined"&&typeof(Weibo.UserLoginDialog)!="undefined"){var h=new Weibo.UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2011/weibo/popupDialog.js"],function(){var i=new Weibo.UserLoginDialog({callback:function(){location.reload()}})})}break;case -1:$alert("不能关注自己!");break;case -4:$alert("关注失败，关注人数已达上限!");break;case -5:$alert("由于该用户的隐私设置，您无法关注他/她!");break;case -3:case -2:$alert("关注失败，该用户已不存在!");break;case -6:$alert("该会员已被你拉入黑名单");break;case 0:$alert("关注失败!");break;case 1:this.nickname=a.readAttribute("nickname");if(this.ischange){if(d==="cFollow"){this.builderNode("a");this.followId=a.up("a",0);if(typeof(this.followId)==="undefined"){this.followId=a}}else{if(d==="dFollow"){this.builderNode("b");this.followId=a.up("span",0)}}this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();if(Mtime.browser.gecko&&d==="cFollow"){var e;if(this.iscard){e=Builder.node("span",{className:"my_relation"})}else{e=Builder.node("span",{className:"my_relation fr mt9 mr9"})}e.innerHTML='<span class="ico_focus mr6 c_000"><cite>已关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="aFollow">取消</cite></a>';var f=this.followId.up();f.insertBefore(e,this.followId);this.followId.remove()}else{this.followId.replace(this.followTemplate)}}this.callback&&this.callback(this.followId,false,"follow");if(this.isuser){if(typeof Weibo!="undefined"&&typeof(Weibo.FollowSuccDialog)!="undefined"){var h=new Weibo.FollowSuccDialog({user:{id:this.fTwitterId,name:this.nickname}})}else{$loadJs(["/js/2011/weibo/popupDialog.js"],function(){var i=new Weibo.FollowSuccDialog({user:{id:this.fTwitterId,name:this.nickname}})}.bind(this))}}break}}}.bind(this));break;case"eFollow":this.fTwitterId=a.readAttribute("ftwitterid");var b='<p class="bold">确定解除黑名单？</p>';this.followId=a.up("span",0);if(this.collectBox!=null){this.collectBox.close()}this.collectBox=new DialogBox({element:a,content:b,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(e){this.server.RemoveFromBlackList(this.fTwitterId,function(f){this.callback&&this.callback("",false);if(f&&f.value){if(this.ischange){this.nickname=a.readAttribute("nickname");this.builderNode("c");this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();this.followId.replace(this.followTemplate)}}}.bind(this));e.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(e){if(this.ischange){this.callback&&this.callback("",false)}e.close()}.bind(this)}]});break}},destroyEvent:function(){this.container.stopObserving("click",this.clickRegionHandler)},closeFollow:function(b,a,c){this.followId=b.up("span",0);if(this.collectBox!=null){this.collectBox.close()}if(browser.ie){b.up("a",0).style.position="static"}this.collectBox=new DialogBox({element:b,content:a,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(d){this.server.UnFollow(this.fTwitterId,function(e){if(e&&e.value){this.callback&&this.callback(this.followId,false,"unfollow");if(this.ischange){this.nickname=b.readAttribute("nickname");this.builderNode(c);this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();this.followId.replace(this.followTemplate)}}}.bind(this));d.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(d){if(this.ischange){this.callback&&this.callback("",false)}d.close()}.bind(this)}]})},builderNode:function(a){switch(a){case"a":if(this.iscard){this.followTemplate='<span class="my_relation fr mt9 mr9"><span class="ico_focus mr6 c_000"><cite>已关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="aFollow">取消</cite></a></span>'}else{this.followTemplate='<span class="my_relation"><span class="ico_focus mr6 c_000"><cite>已关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="aFollow">取消</cite></a></span>'}break;case"b":if(this.iscard){this.followTemplate='<span class="my_relation fr mt9 mr9"><span class="ico_ecfocus mr6 c_000"><cite>相互关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="bFollow">取消</cite></a></span>'}else{this.followTemplate='<span class="my_relation"><span class="ico_ecfocus mr6 c_000"><cite>相互关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="bFollow">取消</cite></a></span>'}break;case"c":if(this.iscard){this.followTemplate='<a class="my_relation_adds fr mt9 mr9" href="#" onclick="return false" ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow" ><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow">加关注</cite></a>'}else{this.followTemplate='<a class="my_relation_adds cc" href="#" onclick="return false" ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow" ><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow">加关注</cite></a>'}break;case"d":if(this.iscard){this.followTemplate='<span class="my_relation fr mt9 mr9"><span class="mr6 c_000"><cite>粉丝</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">加关注</cite></a></span>'}else{this.followTemplate='<span class="my_relation"><span class="mr6 c_000"><cite>粉丝</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">加关注</cite></a></span>'}break;case"e":if(this.iscard){this.followTemplate='<span class="my_relation fr mt9 mr9"><span class="mr6 c_000"><cite>已加入黑名单</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">解除</cite></a></span>'}else{this.followTemplate='<span class="my_relation"><span class="mr6 c_000"><cite>已加入黑名单</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">解除</cite></a></span>'}break}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});